This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
messages/
  de/
    common.json
    software.json
  en/
    common.json
    software.json
public/
  images/
    avatar.png
    avatar.webp
    profile.webp
  favicon-dark.svg
  favicon-light.svg
src/
  app/
    (payload)/
      admin/
        [[...segments]]/
          page.tsx
        importMap.ts
      api/
        [...slug]/
          route.ts
      layout.tsx
    [locale]/
      [slug]/
        page.tsx
      imprint/
        layout.tsx
        page.tsx
      privacy_policy/
        layout.tsx
        page.tsx
      resume/
        page.tsx
      layout.tsx
      page.tsx
      utility-layout.tsx
    globals.css
    robots.ts
    sitemap.ts
  components/
    layout/
      Footer.tsx
      LanguageToggle.tsx
      MobileHeader.tsx
      SoftwareHeader.tsx
      ThemeToggle.tsx
      UtilityHeader.tsx
    resume/
      PrintButton.tsx
      ResumeAutoPrint.tsx
      ResumeHeader.tsx
      ResumeItem.tsx
    sections/
      AnimatedProjectCard.tsx
      ContactSection.tsx
      HeroSection.tsx
      ProjectsSection.tsx
      ResumeCTASection.tsx
      SkillsGrid.tsx
      SkillsSection.tsx
    ui/
      alert.tsx
      aspect-ratio.tsx
      avatar.tsx
      BackToTopButton.tsx
      badge.tsx
      button.tsx
      card.tsx
      checkbox.tsx
      collapsible.tsx
      dialog.tsx
      dropdown-menu.tsx
      input.tsx
      label.tsx
      navigation-menu.tsx
      popover.tsx
      radio-group.tsx
      separator.tsx
      sheet.tsx
      slider.tsx
      switch.tsx
      tabs.tsx
      textarea.tsx
      visually-hidden.tsx
    AnimatedGreeting.tsx
    AnimatedGrid.tsx
    GalleryLightbox.tsx
    LongTextRenderer.tsx
    ProficiencyBar.tsx
    ProficiencyDots.tsx
    ProficiencyLegend.tsx
    ProjectGallery.tsx
    ScrollIndicator.tsx
    SkillIcon.tsx
    Theme-Provider.tsx
  context/
    AlternateLinksProvider.tsx
  data/
    resume.json
  hooks/
    useResumeDownload.ts
  i18n/
    navigation.ts
    request.ts
    routing.ts
  lib/
    payload-helpers.ts
    payload-types-shared.ts
    payload.ts
    strapi.ts
    utils.ts
  payload/
    collections/
      Media.ts
      SkillCategories.ts
      Skills.ts
      SoftwareProjects.ts
      Users.ts
    components/
      Login.tsx
      TwoFactorAuth.tsx
    endpoints/
      2fa.ts
    utils/
      2fa.ts
  types/
    resume.ts
strapi/
  src/
    admin/
      app.example.tsx
      tsconfig.json
      vite.config.example.ts
    api/
      album/
        content-types/
          album/
            lifecycles.ts
            schema.json
        controllers/
          album.ts
        routes/
          album.ts
        services/
          album.ts
      auth/
        controllers/
          auth.js
        routes/
          auth.js
      skill/
        content-types/
          skill/
            schema.json
        controllers/
          skill.ts
        routes/
          skill.ts
        services/
          skill.ts
      skill-category/
        content-types/
          skill-category/
            schema.json
        controllers/
          skill-category.ts
        routes/
          skill-category.ts
        services/
          skill-category.ts
      software-project/
        content-types/
          software-project/
            schema.json
        controllers/
          software-project.ts
        routes/
          software-project.ts
        services/
          software-project.ts
      testimonial/
        content-types/
          testimonial/
            lifecycles.ts
            schema.json
        controllers/
          testimonial.ts
        routes/
          testimonial.ts
        services/
          testimonial.ts
      .gitkeep
    extensions/
      .gitkeep
    utils/
      emailTemplates.ts
    index.ts
.env.example
.gitignore
components.json
eslint.config.mjs
i18n.ts
middleware.ts
next.config.ts
package.json
payload.config.ts
payload.db
payload.importmap.ts
postcss.config.js
Readme.md
tailwind.config.js
tsconfig.json
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="src/app/(payload)/admin/[[...segments]]/page.tsx">
/* THIS FILE WAS GENERATED AUTOMATICALLY BY PAYLOAD. */
import config from '@payload-config'
import { RootPage, generatePageMetadata } from '@payloadcms/next/views'
import { importMap } from '../../../../../payload.importmap'

type Args = {
  params: Promise<{
    segments: string[]
  }>
  searchParams: Promise<{
    [key: string]: string | string[]
  }>
}

export const generateMetadata = ({ params, searchParams }: Args) =>
  generatePageMetadata({ config, params, searchParams })

const Page = ({ params, searchParams }: Args) => RootPage({ config, params, searchParams, importMap })

export default Page
</file>

<file path="src/app/(payload)/admin/importMap.ts">
import type { ImportMap } from 'payload'

export const importMap: ImportMap = {
  // Add your imports here
}
</file>

<file path="src/app/(payload)/api/[...slug]/route.ts">
/* THIS FILE WAS GENERATED AUTOMATICALLY BY PAYLOAD. */
import config from '@payload-config'
import { REST_DELETE, REST_GET, REST_PATCH, REST_POST } from '@payloadcms/next/routes'

export const GET = REST_GET(config)
export const POST = REST_POST(config)
export const PATCH = REST_PATCH(config)
export const DELETE = REST_DELETE(config)
</file>

<file path="src/app/(payload)/layout.tsx">
/* THIS FILE WAS GENERATED AUTOMATICALLY BY PAYLOAD. */
import config from '@payload-config'
import '@payloadcms/next/css'
import { RootLayout } from '@payloadcms/next/layouts'
import React from 'react'
import type { ServerFunctionClient } from 'payload'

import { importMap } from '../../../payload.importmap'

// Server action to handle Payload server functions using the local API
const serverFunction: ServerFunctionClient = async (args) => {
  'use server'
  
  const { getPayload } = await import('payload')
  const payload = await getPayload({ config: await config })
  
  // Use Payload's built-in function handling
  // @ts-expect-error - Payload internals
  return payload.functions?.[args.name]?.(args)
}

type Args = {
  children: React.ReactNode
}

const Layout = ({ children }: Args) => (
  <RootLayout config={config} importMap={importMap} serverFunction={serverFunction}>
    {children}
  </RootLayout>
)

export default Layout
</file>

<file path="src/lib/payload-helpers.ts">
// Client-safe helper functions for Payload CMS
// These don't import any Payload modules and can be used in client components

import type { StrapiImage } from './payload-types-shared'

/**
 * Generate media URL from Payload image object
 * This is a client-safe version that just constructs URLs
 */
export function getMediaUrl(image: StrapiImage | string | null | undefined): string | null {
  if (!image) return null
  
  // If it's a string, assume it's already a URL or path
  if (typeof image === 'string') {
    // If it starts with http, return as-is
    if (image.startsWith('http')) return image
    // Otherwise, prepend the media path
    return `/api/media${image.startsWith('/') ? '' : '/'}${image}`
  }
  
  // If it's an object with a url property
  if (image.url) {
    if (image.url.startsWith('http')) return image.url
    return `/api/media${image.url.startsWith('/') ? '' : '/'}${image.url}`
  }
  
  return null
}
</file>

<file path="src/lib/payload-types-shared.ts">
// Shared types for Payload CMS
// This file contains only type definitions and can be safely imported by both client and server components

export interface StrapiImage {
  id: number | string;
  url: string;
  alternativeText: string | null;
  width: number;
  height: number;
  size: number | null;
}

export interface Skill {
  id: number | string;
  name: string;
  iconClassName: string;
  level: number;
  url: string;
  svgIcon?: {
    url: string;
    alternativeText?: string;
  };
}

export interface SkillCategory {
  id: number | string;
  name: string;
  order: number;
  skills: Skill[];
}

export interface SoftwareProject {
  id: number | string;
  slug: string;
  title: string;
  description: string;
  longDescription?: unknown; // RichText - Lexical editor output
  projectType: string;
  developedAt?: string;
  liveUrl?: string;
  repoUrl?: string;
  tags: string[];
  coverImage: StrapiImage | null;
  gallery: StrapiImage[] | null;
  localizations?: Array<{
    id: number |string;
    slug: string;
    locale: string;
  }>;
}
</file>

<file path="src/lib/payload.ts">
import 'server-only'
import { getPayload } from 'payload'
import configPromise from '@payload-config'
import { cache } from 'react'

// Helper to get Payload client
export const getPayloadClient = async () => {
  return await getPayload({ config: configPromise })
}

// Re-export types from shared file
export type { StrapiImage, Skill, SkillCategory, SoftwareProject } from './payload-types-shared'

// Import types for internal use
import type { SoftwareProject, SkillCategory } from './payload-types-shared'

// Fetch functions matching the Strapi interface

export const fetchSoftwareProjects = cache(async (locale: string = 'en') => {
  const payload = await getPayloadClient()
  const { docs } = await payload.find({
    collection: 'software-projects',
    locale: locale as 'en' | 'de' | undefined,
    depth: 2,
    sort: '-developedAt',
  })
  return docs as unknown as SoftwareProject[]
})

export const fetchSkillCategories = cache(async (locale: string = 'en') => {
  const payload = await getPayloadClient()
  const { docs } = await payload.find({
    collection: 'skill-categories',
    locale: locale as 'en' | 'de' | undefined,
    depth: 2,
    sort: 'order',
  })
  return docs as unknown as SkillCategory[]
})

export const fetchSoftwareProjectBySlug = cache(async (slug: string, locale: string = 'en') => {
  const payload = await getPayloadClient()
  const { docs } = await payload.find({
    collection: 'software-projects',
    where: {
      slug: {
        equals: slug,
      },
    },
    locale: locale as 'en' | 'de' | undefined,
    depth: 2,
  })
  return (docs[0] as unknown as SoftwareProject) || null
})

export const fetchAllProjectSlugs = cache(async (locale: string = 'en') => {
  const payload = await getPayloadClient()
  const { docs } = await payload.find({
    collection: 'software-projects',
    locale: locale as 'en' | 'de' | undefined,
    depth: 0,
    select: {
      slug: true,
    },
  })
  return docs.map((doc) => ({ slug: doc.slug }))
})


export const getTechDetailsMap = cache(async () => {
  const payload = await getPayloadClient()
  const { docs: allSkills } = await payload.find({
    collection: 'skills',
    pagination: false,
  })

  const techDetailsMap: {
    [key: string]: { iconClassName: string | null; url: string | null }
  } = {}

  if (Array.isArray(allSkills)) {
    for (const skill of allSkills) {
      if (skill.name) {
        techDetailsMap[skill.name.toLowerCase()] = {
          iconClassName: skill.iconClassName || null,
          url: skill.url || null,
        }
      }
    }
  }
  return techDetailsMap
})
</file>

<file path="src/payload/collections/Media.ts">
import type { CollectionConfig } from 'payload'

export const Media: CollectionConfig = {
  slug: 'media',
  access: {
    read: () => true,
  },
  fields: [
    {
      name: 'alt',
      type: 'text',
      required: true,
    },
  ],
  upload: true,
}
</file>

<file path="src/payload/collections/SkillCategories.ts">
import type { CollectionConfig } from 'payload'

export const SkillCategories: CollectionConfig = {
  slug: 'skill-categories',
  admin: {
    useAsTitle: 'name',
  },
  fields: [
    {
      name: 'name',
      type: 'text',
      required: true,
      localized: true,
    },
    {
      name: 'order',
      type: 'number',
      required: true,
      defaultValue: 0,
      localized: true,
    },
    {
      name: 'skills',
      type: 'relationship',
      relationTo: 'skills',
      hasMany: true,
    },
  ],
}
</file>

<file path="src/payload/collections/Skills.ts">
import type { CollectionConfig } from 'payload'

export const Skills: CollectionConfig = {
  slug: 'skills',
  admin: {
    useAsTitle: 'name',
  },
  fields: [
    {
      name: 'name',
      type: 'text',
      required: true,
      localized: true,
    },
    {
      name: 'iconClassName',
      type: 'text',
      localized: true,
    },
    {
      name: 'level',
      type: 'number',
      required: true,
      min: 1,
      max: 5,
      localized: true,
    },
    {
      name: 'url',
      type: 'text',
      localized: true,
    },
    {
      name: 'skill_category',
      type: 'relationship',
      relationTo: 'skill-categories',
    },
    {
      name: 'svgIcon',
      type: 'upload',
      relationTo: 'media',
    },
  ],
}
</file>

<file path="src/payload/collections/SoftwareProjects.ts">
import type { CollectionConfig } from 'payload'

export const SoftwareProjects: CollectionConfig = {
  slug: 'software-projects',
  admin: {
    useAsTitle: 'title',
  },
  fields: [
    {
      name: 'title',
      type: 'text',
      required: true,
      localized: true,
    },
    {
      name: 'slug',
      type: 'text',
      required: true,
      unique: true,
    },
    {
      name: 'description',
      type: 'textarea',
      required: true,
      localized: true,
    },
    {
      name: 'longDescription',
      type: 'richText',
      localized: true,
    },
    {
      name: 'projectType',
      type: 'text',
      required: true,
      localized: true,
    },
    {
      name: 'developedAt',
      type: 'date',
      localized: true,
    },
    {
      name: 'liveUrl',
      type: 'text',
      localized: true,
    },
    {
      name: 'repoUrl',
      type: 'text',
      localized: true,
    },
    {
      name: 'tags',
      type: 'json',
      localized: true,
    },
    {
      name: 'coverImage',
      type: 'upload',
      relationTo: 'media',
      localized: true,
    },
    {
      name: 'gallery',
      type: 'upload',
      relationTo: 'media',
      hasMany: true,
      localized: true,
    },
  ],
}
</file>

<file path="src/payload/collections/Users.ts">
import type { CollectionConfig } from 'payload'

import { 
  setup2FAHandler, 
  enable2FAHandler, 
  verify2FAHandler, 
  disable2FAHandler, 
  regenerateBackupCodesHandler,
  loginInitHandler
} from '../endpoints/2fa'

export const Users: CollectionConfig = {
  slug: 'users',
  admin: {
    useAsTitle: 'email',
    components: {
      views: {
        edit: {
          twoFactorAuth: {
            Component: '@/payload/components/TwoFactorAuth#TwoFactorAuth',
            tab: {
              label: 'Two-Factor Auth',
            },
          },
        },
      },
    },
  },
  auth: true,
  endpoints: [
    {
      path: '/2fa/login-init',
      method: 'post',
      handler: loginInitHandler,
    },
    {
      path: '/2fa/setup',
      method: 'post',
      handler: setup2FAHandler,
    },
    {
      path: '/2fa/enable',
      method: 'post',
      handler: enable2FAHandler,
    },
    {
      path: '/2fa/verify',
      method: 'post',
      handler: verify2FAHandler,
    },
    {
      path: '/2fa/disable',
      method: 'post',
      handler: disable2FAHandler,
    },
    {
      path: '/2fa/regenerate-backup-codes',
      method: 'post',
      handler: regenerateBackupCodesHandler,
    },
  ],
  fields: [
    // Email added by default
    {
      name: 'twoFactorEnabled',
      type: 'checkbox',
      label: 'Two-Factor Authentication Enabled',
      defaultValue: false,
      admin: {
        readOnly: true,
        description: '2FA status for this user',
      },
    },
    {
      name: 'twoFactorSecret',
      type: 'text',
      label: 'Two-Factor Secret',
      admin: {
        hidden: true,
      },
      // This will store the encrypted TOTP secret
    },
    {
      name: 'twoFactorBackupCodes',
      type: 'array',
      label: 'Backup Codes',
      admin: {
        hidden: true,
      },
      fields: [
        {
          name: 'code',
          type: 'text',
          required: true,
        },
        {
          name: 'used',
          type: 'checkbox',
          defaultValue: false,
        },
      ],
    },
    {
      name: 'twoFactorEnrolledAt',
      type: 'date',
      label: 'Two-Factor Enrolled At',
      admin: {
        readOnly: true,
        description: 'When the user enrolled in 2FA',
      },
    },
  ],
}
</file>

<file path="src/payload/components/Login.tsx">
'use client'

import React, { useState } from 'react'
import { useSearchParams } from 'next/navigation'

export const Login: React.FC = () => {
  const searchParams = useSearchParams()
  const redirect = searchParams.get('redirect') || '/admin'
  
  const [email, setEmail] = useState('')
  const [password, setPassword] = useState('')
  const [code, setCode] = useState('')
  const [show2FA, setShow2FA] = useState(false)
  const [error, setError] = useState<string | null>(null)
  const [loading, setLoading] = useState(false)

  const handleLogin = async (e: React.FormEvent) => {
    e.preventDefault()
    setLoading(true)
    setError(null)

    try {
      if (show2FA) {
        // Verify 2FA
        const response = await fetch('/api/users/2fa/verify', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          credentials: 'include', // Include cookies in request
          body: JSON.stringify({ email, code }),
        })

        const data = await response.json()

        if (!response.ok) {
          throw new Error(data.error || 'Invalid 2FA code')
        }

        // Use full page redirect to ensure auth state is updated
        window.location.href = redirect
      } else {
        // Initial login attempt
        const response = await fetch('/api/users/2fa/login-init', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include', // Include cookies in request/response
          body: JSON.stringify({ email, password }),
        })
        
        const data = await response.json()
        
        if (!response.ok) {
          throw new Error(data.error || 'Login failed')
        }
        
        if (data.twoFactorRequired) {
          setShow2FA(true)
          setLoading(false) // Reset loading for 2FA input
        } else {
          // Use full page redirect to ensure auth state is updated
          // Don't reset loading here - the page will navigate away
          window.location.href = redirect
        }
      }
    } catch (err) {
      setError(err instanceof Error ? err.message : 'An error occurred')
      setLoading(false)
    }
  }

  const inputStyle: React.CSSProperties = {
    width: '100%',
    padding: '10px 12px',
    fontSize: '14px',
    borderRadius: '4px',
    border: '1px solid var(--theme-border-color)',
    backgroundColor: 'var(--theme-bg-input)',
    color: 'var(--theme-text)',
    outline: 'none',
  }

  const buttonStyle: React.CSSProperties = {
    width: '100%',
    padding: '12px',
    fontSize: '14px',
    fontWeight: 600,
    borderRadius: '4px',
    border: 'none',
    backgroundColor: loading ? '#666' : '#0070f3',
    color: 'white',
    cursor: loading ? 'not-allowed' : 'pointer',
    opacity: loading ? 0.6 : 1,
    transition: 'all 0.2s ease',
  }

  return (
    <div style={{
      display: 'flex',
      alignItems: 'center',
      justifyContent: 'center',
      minHeight: '100vh',
      backgroundColor: 'var(--theme-bg-html)',
      color: 'var(--theme-text)',
    }}>
      <div style={{
        width: '100%',
        maxWidth: '450px',
        padding: '40px',
        backgroundColor: 'var(--theme-bg-card)',
        borderRadius: '8px',
        boxShadow: '0 2px 10px rgba(0,0,0,0.1)',
        border: '1px solid var(--theme-border-color)',
      }}>
        <h2 style={{ marginBottom: '20px', textAlign: 'center' }}>
          {show2FA ? 'Two-Factor Authentication' : 'Login'}
        </h2>
        
        {error && (
          <div style={{
            padding: '10px',
            marginBottom: '20px',
            backgroundColor: 'rgba(255, 0, 0, 0.1)',
            color: 'red',
            borderRadius: '4px',
            fontSize: '14px',
          }}>
            {error}
          </div>
        )}
        
        <form onSubmit={handleLogin}>
          {!show2FA ? (
            <>
              <div style={{ marginBottom: '20px' }}>
                <label style={{ display: 'block', marginBottom: '8px', fontSize: '14px' }}>Email</label>
                <input 
                  type="email"
                  value={email} 
                  onChange={(e) => setEmail(e.target.value)} 
                  required
                  style={inputStyle}
                />
              </div>
              <div style={{ marginBottom: '20px' }}>
                <label style={{ display: 'block', marginBottom: '8px', fontSize: '14px' }}>Password</label>
                <input 
                  type="password" 
                  value={password} 
                  onChange={(e) => setPassword(e.target.value)} 
                  required
                  style={inputStyle}
                />
              </div>
            </>
          ) : (
            <div style={{ marginBottom: '20px' }}>
              <label style={{ display: 'block', marginBottom: '8px', fontSize: '14px' }}>Authentication Code</label>
              <input 
                type="text"
                value={code} 
                onChange={(e) => setCode(e.target.value)} 
                placeholder="000000"
                required
                style={inputStyle}
              />
              <p style={{ fontSize: '12px', marginTop: '8px', color: '#666' }}>
                Enter the 6-digit code from your authenticator app.
              </p>
            </div>
          )}
          
          <button 
            type="submit" 
            disabled={loading}
            style={buttonStyle}
          >
            {loading ? 'Loading...' : (show2FA ? 'Verify' : 'Login')}
          </button>
        </form>
      </div>
    </div>
  )
}
</file>

<file path="src/payload/components/TwoFactorAuth.tsx">
'use client'

import React, { useState } from 'react'
import { useAuth } from '@payloadcms/ui'

export const TwoFactorAuth: React.FC = () => {
  const { user } = useAuth()
  const [loading, setLoading] = useState(false)
  const [error, setError] = useState<string | null>(null)
  const [success, setSuccess] = useState<string | null>(null)
  
  // Setup state
  const [qrCode, setQrCode] = useState<string | null>(null)
  const [secret, setSecret] = useState<string | null>(null)
  const [backupCodes, setBackupCodes] = useState<string[]>([])
  const [verificationCode, setVerificationCode] = useState('')
  
  // Disable state
  const [showDisableConfirm, setShowDisableConfirm] = useState(false)
  const [disablePassword, setDisablePassword] = useState('')
  
  // Regenerate backup codes state
  const [showRegenerateConfirm, setShowRegenerateConfirm] = useState(false)
  const [regeneratePassword, setRegeneratePassword] = useState('')
  const [newBackupCodes, setNewBackupCodes] = useState<string[]>([])

  const is2FAEnabled = user?.twoFactorEnabled || false

  const handleSetup2FA = async () => {
    setLoading(true)
    setError(null)
    setSuccess(null)

    try {
      const response = await fetch('/api/users/2fa/setup', {
        method: 'POST',
        credentials: 'include',
        headers: {
          'Content-Type': 'application/json',
        },
      })

      const data = await response.json()

      if (!response.ok) {
        throw new Error(data.error || 'Failed to setup 2FA')
      }

      setQrCode(data.qrCode)
      setSecret(data.secret)
      setBackupCodes(data.backupCodes)
      setSuccess('2FA setup initiated. Scan the QR code with your authenticator app.')
    } catch (err) {
      setError(err instanceof Error ? err.message : 'An error occurred')
    } finally {
      setLoading(false)
    }
  }

  const handleEnable2FA = async () => {
    if (!verificationCode || verificationCode.length !== 6) {
      setError('Please enter a valid 6-digit code')
      return
    }

    setLoading(true)
    setError(null)
    setSuccess(null)

    try {
      const response = await fetch('/api/users/2fa/enable', {
        method: 'POST',
        credentials: 'include',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ code: verificationCode }),
      })

      const data = await response.json()

      if (!response.ok) {
        throw new Error(data.error || 'Failed to enable 2FA')
      }

      setSuccess('2FA has been enabled successfully! Please save your backup codes.')
      setVerificationCode('')
      
      // Reload page to update user state
      setTimeout(() => {
        window.location.reload()
      }, 2000)
    } catch (err) {
      setError(err instanceof Error ? err.message : 'An error occurred')
    } finally {
      setLoading(false)
    }
  }

  const handleDisable2FA = async () => {
    if (!disablePassword) {
      setError('Please enter your password')
      return
    }

    setLoading(true)
    setError(null)
    setSuccess(null)

    try {
      const response = await fetch('/api/users/2fa/disable', {
        method: 'POST',
        credentials: 'include',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ password: disablePassword }),
      })

      const data = await response.json()

      if (!response.ok) {
        throw new Error(data.error || 'Failed to disable 2FA')
      }

      setSuccess('2FA has been disabled successfully!')
      setDisablePassword('')
      setShowDisableConfirm(false)
      
      // Reload page to update user state
      setTimeout(() => {
        window.location.reload()
      }, 2000)
    } catch (err) {
      setError(err instanceof Error ? err.message : 'An error occurred')
    } finally {
      setLoading(false)
    }
  }

  const handleRegenerateBackupCodes = async () => {
    if (!regeneratePassword) {
      setError('Please enter your password')
      return
    }

    setLoading(true)
    setError(null)
    setSuccess(null)

    try {
      const response = await fetch('/api/users/2fa/regenerate-backup-codes', {
        method: 'POST',
        credentials: 'include',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ password: regeneratePassword }),
      })

      const data = await response.json()

      if (!response.ok) {
        throw new Error(data.error || 'Failed to regenerate backup codes')
      }

      setNewBackupCodes(data.backupCodes)
      setSuccess('New backup codes generated successfully! Please save them.')
      setRegeneratePassword('')
      setShowRegenerateConfirm(false)
    } catch (err) {
      setError(err instanceof Error ? err.message : 'An error occurred')
    } finally {
      setLoading(false)
    }
  }

  const copyToClipboard = (text: string) => {
    navigator.clipboard.writeText(text)
    setSuccess('Copied to clipboard!')
    setTimeout(() => setSuccess(null), 2000)
  }

  const downloadBackupCodes = (codes: string[]) => {
    const text = codes.join('\n')
    const blob = new Blob([text], { type: 'text/plain' })
    const url = URL.createObjectURL(blob)
    const a = document.createElement('a')
    a.href = url
    a.download = '2fa-backup-codes.txt'
    a.click()
    URL.revokeObjectURL(url)
  }

  return (
    <div style={{ padding: '20px', maxWidth: '800px' }}>
      <h2 style={{ marginBottom: '20px', fontSize: '24px', fontWeight: 'bold' }}>
        Two-Factor Authentication
      </h2>

      {error && (
        <div style={{ 
          padding: '12px', 
          marginBottom: '20px', 
          backgroundColor: '#fee', 
          border: '1px solid #fcc',
          borderRadius: '4px',
          color: '#c00'
        }}>
          {error}
        </div>
      )}

      {success && (
        <div style={{ 
          padding: '12px', 
          marginBottom: '20px', 
          backgroundColor: '#efe', 
          border: '1px solid #cfc',
          borderRadius: '4px',
          color: '#060'
        }}>
          {success}
        </div>
      )}

      {!is2FAEnabled ? (
        <div>
          <p style={{ marginBottom: '20px' }}>
            Two-factor authentication adds an extra layer of security to your account.
            You&apos;ll need to enter a code from your authenticator app when logging in.
          </p>

          {!qrCode ? (
            <button
              onClick={handleSetup2FA}
              disabled={loading}
              style={{
                padding: '10px 20px',
                backgroundColor: '#0070f3',
                color: 'white',
                border: 'none',
                borderRadius: '4px',
                cursor: loading ? 'not-allowed' : 'pointer',
                fontSize: '16px',
              }}
            >
              {loading ? 'Setting up...' : 'Enable Two-Factor Authentication'}
            </button>
          ) : (
            <div>
              <h3 style={{ marginBottom: '16px', fontSize: '18px', fontWeight: '600' }}>
                Step 1: Scan QR Code
              </h3>
              <p style={{ marginBottom: '12px' }}>
                Scan this QR code with your authenticator app (Google Authenticator, Authy, etc.):
              </p>
              
              <div style={{ marginBottom: '20px', textAlign: 'center' }}>
                {/* eslint-disable-next-line @next/next/no-img-element */}
                <img src={qrCode} alt="2FA QR Code" style={{ maxWidth: '300px' }} />
              </div>

              <p style={{ marginBottom: '8px' }}>Or enter this key manually:</p>
              <div style={{ 
                padding: '12px', 
                backgroundColor: '#f5f5f5', 
                borderRadius: '4px',
                fontFamily: 'monospace',
                marginBottom: '20px',
                display: 'flex',
                justifyContent: 'space-between',
                alignItems: 'center'
              }}>
                <code>{secret}</code>
                <button
                  onClick={() => copyToClipboard(secret || '')}
                  style={{
                    padding: '6px 12px',
                    backgroundColor: '#666',
                    color: 'white',
                    border: 'none',
                    borderRadius: '4px',
                    cursor: 'pointer',
                    fontSize: '14px',
                  }}
                >
                  Copy
                </button>
              </div>

              <h3 style={{ marginTop: '32px', marginBottom: '16px', fontSize: '18px', fontWeight: '600' }}>
                Step 2: Save Backup Codes
              </h3>
              <p style={{ marginBottom: '12px' }}>
                Save these backup codes in a secure place. You can use them to access your account if you lose your phone:
              </p>
              
              <div style={{ 
                padding: '16px', 
                backgroundColor: '#f5f5f5', 
                borderRadius: '4px',
                marginBottom: '12px'
              }}>
                <div style={{ 
                  display: 'grid', 
                  gridTemplateColumns: 'repeat(2, 1fr)', 
                  gap: '8px',
                  fontFamily: 'monospace'
                }}>
                  {backupCodes.map((code, index) => (
                    <div key={index}>{code}</div>
                  ))}
                </div>
              </div>

              <button
                onClick={() => downloadBackupCodes(backupCodes)}
                style={{
                  padding: '8px 16px',
                  backgroundColor: '#666',
                  color: 'white',
                  border: 'none',
                  borderRadius: '4px',
                  cursor: 'pointer',
                  fontSize: '14px',
                  marginBottom: '32px',
                }}
              >
                Download Backup Codes
              </button>

              <h3 style={{ marginBottom: '16px', fontSize: '18px', fontWeight: '600' }}>
                Step 3: Verify Setup
              </h3>
              <p style={{ marginBottom: '12px' }}>
                You&apos;ll need to enter a code from your authenticator app when logging in.
              </p>

              <div style={{ display: 'flex', gap: '12px', marginBottom: '20px' }}>
                <input
                  type="text"
                  value={verificationCode}
                  onChange={(e) => setVerificationCode(e.target.value.replace(/\D/g, '').slice(0, 6))}
                  placeholder="000000"
                  maxLength={6}
                  style={{
                    padding: '10px',
                    fontSize: '18px',
                    border: '1px solid #ccc',
                    borderRadius: '4px',
                    width: '150px',
                    fontFamily: 'monospace',
                    letterSpacing: '4px',
                  }}
                />
                <button
                  onClick={handleEnable2FA}
                  disabled={loading || verificationCode.length !== 6}
                  style={{
                    padding: '10px 20px',
                    backgroundColor: verificationCode.length === 6 ? '#0070f3' : '#ccc',
                    color: 'white',
                    border: 'none',
                    borderRadius: '4px',
                    cursor: verificationCode.length === 6 && !loading ? 'pointer' : 'not-allowed',
                    fontSize: '16px',
                  }}
                >
                  {loading ? 'Verifying...' : 'Complete Setup'}
                </button>
              </div>
            </div>
          )}
        </div>
      ) : (
        <div>
          <div style={{ 
            padding: '16px', 
            backgroundColor: '#efe', 
            border: '1px solid #cfc',
            borderRadius: '4px',
            marginBottom: '32px'
          }}>
            <p style={{ fontWeight: '600', color: '#060' }}>
              âœ“ Two-factor authentication is enabled
            </p>
            <p style={{ fontSize: '14px', marginTop: '4px', color: '#060' }}>
              Your account is protected with 2FA
            </p>
          </div>

          {/* Regenerate Backup Codes Section */}
          <div style={{ marginBottom: '32px' }}>
            <h3 style={{ marginBottom: '12px', fontSize: '18px', fontWeight: '600' }}>
              Backup Codes
            </h3>
            
            {!showRegenerateConfirm ? (
              <button
                onClick={() => setShowRegenerateConfirm(true)}
                style={{
                  padding: '10px 20px',
                  backgroundColor: '#666',
                  color: 'white',
                  border: 'none',
                  borderRadius: '4px',
                  cursor: 'pointer',
                  fontSize: '16px',
                }}
              >
                Regenerate Backup Codes
              </button>
            ) : (
              <div>
                <p style={{ marginBottom: '12px' }}>
                  Enter your password to regenerate backup codes. This will invalidate your old codes.
                </p>
                <div style={{ display: 'flex', gap: '12px' }}>
                  <input
                    type="password"
                    value={regeneratePassword}
                    onChange={(e) => setRegeneratePassword(e.target.value)}
                    placeholder="Enter your password"
                    style={{
                      padding: '10px',
                      fontSize: '16px',
                      border: '1px solid #ccc',
                      borderRadius: '4px',
                      flex: 1,
                    }}
                  />
                  <button
                    onClick={handleRegenerateBackupCodes}
                    disabled={loading || !regeneratePassword}
                    style={{
                      padding: '10px 20px',
                      backgroundColor: regeneratePassword ? '#0070f3' : '#ccc',
                      color: 'white',
                      border: 'none',
                      borderRadius: '4px',
                      cursor: regeneratePassword && !loading ? 'pointer' : 'not-allowed',
                      fontSize: '16px',
                    }}
                  >
                    {loading ? 'Regenerating...' : 'Confirm'}
                  </button>
                  <button
                    onClick={() => {
                      setShowRegenerateConfirm(false)
                      setRegeneratePassword('')
                    }}
                    style={{
                      padding: '10px 20px',
                      backgroundColor: '#ccc',
                      color: '#333',
                      border: 'none',
                      borderRadius: '4px',
                      cursor: 'pointer',
                      fontSize: '16px',
                    }}
                  >
                    Cancel
                  </button>
                </div>
              </div>
            )}

            {newBackupCodes.length > 0 && (
              <div style={{ marginTop: '20px' }}>
                <h4 style={{ marginBottom: '12px', fontSize: '16px', fontWeight: '600' }}>
                  New Backup Codes
                </h4>
                <div style={{ 
                  padding: '16px', 
                  backgroundColor: '#f5f5f5', 
                  borderRadius: '4px',
                  marginBottom: '12px'
                }}>
                  <div style={{ 
                    display: 'grid', 
                    gridTemplateColumns: 'repeat(2, 1fr)', 
                    gap: '8px',
                    fontFamily: 'monospace'
                  }}>
                    {newBackupCodes.map((code, index) => (
                      <div key={index}>{code}</div>
                    ))}
                  </div>
                </div>
                <button
                  onClick={() => downloadBackupCodes(newBackupCodes)}
                  style={{
                    padding: '8px 16px',
                    backgroundColor: '#666',
                    color: 'white',
                    border: 'none',
                    borderRadius: '4px',
                    cursor: 'pointer',
                    fontSize: '14px',
                  }}
                >
                  Download Backup Codes
                </button>
              </div>
            )}
          </div>

          {/* Disable 2FA Section */}
          <div>
            <h3 style={{ marginBottom: '12px', fontSize: '18px', fontWeight: '600' }}>
              Disable Two-Factor Authentication
            </h3>
            
            {!showDisableConfirm ? (
              <button
                onClick={() => setShowDisableConfirm(true)}
                style={{
                  padding: '10px 20px',
                  backgroundColor: '#dc3545',
                  color: 'white',
                  border: 'none',
                  borderRadius: '4px',
                  cursor: 'pointer',
                  fontSize: '16px',
                }}
              >
                Disable 2FA
              </button>
            ) : (
              <div>
                <p style={{ marginBottom: '12px', color: '#c00' }}>
                  <strong>Warning:</strong> Disabling 2FA will make your account less secure.
                </p>
                <p style={{ marginBottom: '12px' }}>
                  Enter your password to confirm:
                </p>
                <div style={{ display: 'flex', gap: '12px' }}>
                  <input
                    type="password"
                    value={disablePassword}
                    onChange={(e) => setDisablePassword(e.target.value)}
                    placeholder="Enter your password"
                    style={{
                      padding: '10px',
                      fontSize: '16px',
                      border: '1px solid #ccc',
                      borderRadius: '4px',
                      flex: 1,
                    }}
                  />
                  <button
                    onClick={handleDisable2FA}
                    disabled={loading || !disablePassword}
                    style={{
                      padding: '10px 20px',
                      backgroundColor: disablePassword ? '#dc3545' : '#ccc',
                      color: 'white',
                      border: 'none',
                      borderRadius: '4px',
                      cursor: disablePassword && !loading ? 'pointer' : 'not-allowed',
                      fontSize: '16px',
                    }}
                  >
                    {loading ? 'Disabling...' : 'Disable 2FA'}
                  </button>
                  <button
                    onClick={() => {
                      setShowDisableConfirm(false)
                      setDisablePassword('')
                    }}
                    style={{
                      padding: '10px 20px',
                      backgroundColor: '#ccc',
                      color: '#333',
                      border: 'none',
                      borderRadius: '4px',
                      cursor: 'pointer',
                      fontSize: '16px',
                    }}
                  >
                    Cancel
                  </button>
                </div>
              </div>
            )}
          </div>
        </div>
      )}
    </div>
  )
}
</file>

<file path="src/payload/endpoints/2fa.ts">
import type { PayloadRequest } from 'payload'
import { generateTOTPSecret, generateQRCode, generateBackupCodes, hashBackupCode, encryptSecret, verifyTOTP } from '../utils/2fa'

/**
 * POST /api/users/2fa/setup
 * Generate TOTP secret and QR code for 2FA enrollment
 */
export const setup2FAHandler = async (req: PayloadRequest): Promise<Response> => {
  const { payload, user } = req
  console.log('setup2FAHandler called', { user: user?.email })

  // Check if user is authenticated
  if (!user || !user.email) {
    console.log('setup2FAHandler: Unauthorized')
    return Response.json({ error: 'Unauthorized' }, { status: 401 })
  }

  try {
    // Check if 2FA is already enabled
    if (user.twoFactorEnabled) {
      console.log('setup2FAHandler: 2FA already enabled')
      return Response.json({ error: '2FA is already enabled for this account' }, { status: 400 })
    }

    // Generate TOTP secret
    console.log('setup2FAHandler: Generating secret')
    const secret = generateTOTPSecret()
    
    // Generate QR code
    console.log('setup2FAHandler: Generating QR code')
    const qrCode = await generateQRCode(user.email, secret)
    
    // Generate backup codes
    console.log('setup2FAHandler: Generating backup codes')
    const backupCodes = generateBackupCodes(10)
    
    // Hash backup codes for storage
    const hashedBackupCodes = backupCodes.map(code => ({
      code: hashBackupCode(code),
      used: false,
    }))

    // Store encrypted secret and hashed backup codes (but don't enable 2FA yet)
    // User must verify TOTP code first before 2FA is fully enabled
    console.log('setup2FAHandler: Updating user')
    await payload.update({
      collection: 'users',
      id: user.id,
      data: {
        twoFactorSecret: encryptSecret(secret),
        twoFactorBackupCodes: hashedBackupCodes,
      },
    })

    console.log('setup2FAHandler: Success')
    // Return QR code and backup codes to user
    // The backup codes are shown only once during setup
    return Response.json({
      qrCode,
      secret, // For manual entry
      backupCodes, // Unhashed codes for user to save
    }, { status: 200 })
  } catch (error) {
    console.error('2FA setup error:', error)
    return Response.json({ error: 'Failed to setup 2FA' }, { status: 500 })
  }
}

/**
 * POST /api/users/2fa/enable
 * Verify TOTP code and enable 2FA
 */
export const enable2FAHandler = async (req: PayloadRequest): Promise<Response> => {
  const { payload, user } = req
  console.log('enable2FAHandler called', { user: user?.email })

  if (!user) {
    console.log('enable2FAHandler: Unauthorized')
    return Response.json({ error: 'Unauthorized' }, { status: 401 })
  }

  // Try to get data from req.data (Payload) or parse json (Web API)
  let data = req.data
  if (!data && req.json) {
    try {
      data = await req.json()
      console.log('enable2FAHandler: Parsed JSON body', data)
    } catch (e) {
      console.log('enable2FAHandler: Failed to parse JSON body', e)
    }
  } else {
    console.log('enable2FAHandler: Using req.data', data)
  }

  const { code } = data || {}
  console.log('enable2FAHandler: Verification code received', { code })

  if (!code) {
    console.log('enable2FAHandler: Code missing')
    return Response.json({ error: 'Verification code is required' }, { status: 400 })
  }

  try {
    // Get user's secret
    console.log('enable2FAHandler: Fetching user doc', { id: user.id })
    const userDoc = await payload.findByID({
      collection: 'users',
      id: user.id,
    })

    if (!userDoc.twoFactorSecret) {
      console.log('enable2FAHandler: Secret missing on user doc')
      return Response.json({ error: '2FA setup not initiated. Please call /api/users/2fa/setup first' }, { status: 400 })
    }

    // Verify the TOTP code
    const { decryptSecret } = await import('../utils/2fa')
    const secret = decryptSecret(userDoc.twoFactorSecret)
    console.log('enable2FAHandler: Verifying TOTP')
    const isValid = verifyTOTP(code, secret)
    console.log('enable2FAHandler: Verification result', { isValid })

    if (!isValid) {
      return Response.json({ error: 'Invalid verification code' }, { status: 400 })
    }

    // Enable 2FA
    console.log('enable2FAHandler: Enabling 2FA')
    await payload.update({
      collection: 'users',
      id: user.id,
      data: {
        twoFactorEnabled: true,
        twoFactorEnrolledAt: new Date().toISOString(),
      },
    })

    console.log('enable2FAHandler: Success')
    return Response.json({
      success: true,
      message: '2FA has been enabled successfully',
    }, { status: 200 })
  } catch (error) {
    console.error('2FA enable error:', error)
    return Response.json({ error: 'Failed to enable 2FA' }, { status: 500 })
  }
}

/**
 * POST /api/users/2fa/verify
 * Verify TOTP code during login
 */
export const verify2FAHandler = async (req: PayloadRequest): Promise<Response> => {
  const { payload } = req
  
  // Try to get data from req.data (Payload) or parse json (Web API)
  let data = req.data
  if (!data && req.json) {
    try {
      data = await req.json()
    } catch (e) {
      console.log('verify2FAHandler: Failed to parse JSON body', e)
    }
  }

  const { email, code } = data || {}
  console.log('verify2FAHandler called', { email })

  if (!email || !code) {
    console.log('verify2FAHandler: Missing email or code')
    return Response.json({ error: 'Email and code are required' }, { status: 400 })
  }

  try {
    // Find user by email
    console.log('verify2FAHandler: Finding user')
    const users = await payload.find({
      collection: 'users',
      where: {
        email: {
          equals: email,
        },
      },
    })

    if (!users.docs || users.docs.length === 0) {
      console.log('verify2FAHandler: User not found')
      return Response.json({ error: 'Invalid credentials' }, { status: 401 })
    }

    const user = users.docs[0]

    if (!user.twoFactorEnabled || !user.twoFactorSecret) {
      console.log('verify2FAHandler: 2FA not enabled for user')
      return Response.json({ error: '2FA is not enabled for this account' }, { status: 400 })
    }

    // Decrypt secret and verify TOTP
    const { decryptSecret, verifyBackupCode } = await import('../utils/2fa')
    const secret = decryptSecret(user.twoFactorSecret)
    
    console.log('verify2FAHandler: Verifying code')
    let isValid = verifyTOTP(code, secret)
    let usedBackupCode = false

    // If TOTP fails, check if it's a backup code
    if (!isValid && user.twoFactorBackupCodes) {
      console.log('verify2FAHandler: Checking backup codes')
      for (const backupCode of user.twoFactorBackupCodes) {
        if (!backupCode.used && verifyBackupCode(code, backupCode.code)) {
          isValid = true
          usedBackupCode = true
          
          // Mark backup code as used
          const updatedBackupCodes = user.twoFactorBackupCodes.map((bc: Record<string, unknown>) =>
            bc.code === backupCode.code ? { ...bc, used: true } : bc
          )
          
          await payload.update({
            collection: 'users',
            id: user.id,
            data: {
              twoFactorBackupCodes: updatedBackupCodes,
            },
          })
          break
        }
      }
    }

    if (!isValid) {
      console.log('verify2FAHandler: Invalid code')
      return Response.json({ error: 'Invalid verification code' }, { status: 401 })
    }

    // Get stored password for this user
    const pendingLogin = pendingLogins.get(email)
    
    if (!pendingLogin) {
      console.log('verify2FAHandler: No pending login found')
      return Response.json({ error: 'Session expired. Please login again.' }, { status: 401 })
    }

    // Create proper Payload session using payload.login and capture the result
    console.log('verify2FAHandler: Creating Payload session')
    const loginResult = await payload.login({
      collection: 'users',
      data: {
        email: email,
        password: pendingLogin.password,
      },
      req,
    })

    // Clean up stored password
    pendingLogins.delete(email)

    console.log('verify2FAHandler: Success, session created')
    // Build response with Set-Cookie header if token is present
    const headers: Record<string, string> = { 'Content-Type': 'application/json' }
    if (loginResult?.token) {
      // Payload uses 'payload-token' cookie by default
      headers['Set-Cookie'] = `payload-token=${loginResult.token}; Path=/; HttpOnly; SameSite=Lax;`
    }
    return new Response(JSON.stringify({
      success: true,
      user: { id: user.id, email: user.email },
      usedBackupCode,
    }), { status: 200, headers })
  } catch (error) {
    console.error('2FA verification error:', error)
    return Response.json({ error: 'Failed to verify 2FA code' }, { status: 500 })
  }
}

/**
 * POST /api/users/2fa/disable
 * Disable 2FA for the current user
 */
export const disable2FAHandler = async (req: PayloadRequest): Promise<Response> => {
  const { payload, user } = req
  console.log('disable2FAHandler called', { user: user?.email })

  if (!user || !user.email) {
    console.log('disable2FAHandler: Unauthorized')
    return Response.json({ error: 'Unauthorized' }, { status: 401 })
  }

  // Try to get data from req.data (Payload) or parse json (Web API)
  let data = req.data
  if (!data && req.json) {
    try {
      data = await req.json()
      console.log('disable2FAHandler: Parsed JSON body')
    } catch (e) {
      console.log('disable2FAHandler: Failed to parse JSON body', e)
    }
  }

  const { password } = data || {}

  if (!password) {
    console.log('disable2FAHandler: Password missing')
    return Response.json({ error: 'Password confirmation is required' }, { status: 400 })
  }

  try {
    // Verify password
    console.log('disable2FAHandler: Verifying password')
    const isValidPassword = await payload.login({
      collection: 'users',
      data: {
        email: user.email,
        password,
      },
    })

    if (!isValidPassword) {
      console.log('disable2FAHandler: Invalid password')
      return Response.json({ error: 'Invalid password' }, { status: 401 })
    }

    // Disable 2FA and clear all related fields
    console.log('disable2FAHandler: Disabling 2FA')
    await payload.update({
      collection: 'users',
      id: user.id,
      data: {
        twoFactorEnabled: false,
        twoFactorSecret: null,
        twoFactorBackupCodes: [],
        twoFactorEnrolledAt: null,
      },
    })

    console.log('disable2FAHandler: Success')
    return Response.json({
      success: true,
      message: '2FA has been disabled successfully',
    }, { status: 200 })
  } catch (error) {
    console.error('2FA disable error:', error)
    return Response.json({ error: 'Failed to disable 2FA' }, { status: 500 })
  }
}

// Temporary storage for passwords during 2FA flow (in-memory, not persistent)
const pendingLogins = new Map<string, { password: string, timestamp: number }>()

// Clean up old pending logins every 5 minutes
setInterval(() => {
  const fiveMinutesAgo = Date.now() - 5 * 60 * 1000
  for (const [email, data] of pendingLogins.entries()) {
    if (data.timestamp < fiveMinutesAgo) {
      pendingLogins.delete(email)
    }
  }
}, 5 * 60 * 1000)

/**
 * POST /api/users/2fa/login-init
 * Initialize login: verify credentials and check if 2FA is required
 */
export const loginInitHandler = async (req: PayloadRequest): Promise<Response> => {
  const { payload } = req
  
  // Try to get data from req.data (Payload) or parse json (Web API)
  let data = req.data
  if (!data && req.json) {
    try {
      data = await req.json()
    } catch (e) {
      console.log('loginInitHandler: Failed to parse JSON body', e)
    }
  }

  const { email, password } = data || {}

  if (!email || !password) {
    return Response.json({ error: 'Email and password are required' }, { status: 400 })
  }

  try {
    // Find user by email to check if 2FA is enabled (before attempting login)
    const users = await payload.find({
      collection: 'users',
      where: {
        email: {
          equals: email,
        },
      },
      depth: 0,
    })

    if (!users.docs || users.docs.length === 0) {
      return Response.json({ error: 'Invalid credentials' }, { status: 401 })
    }

    const user = users.docs[0]

    // Check if 2FA is enabled BEFORE logging in
    if (user.twoFactorEnabled) {
      // For 2FA users: verify password without creating a session cookie
      // We do this by calling login without passing the req (which has the response)
      try {
        await payload.login({
          collection: 'users',
          data: {
            email,
            password,
          },
          // Don't pass req here - this prevents session cookie from being set
        })
      } catch (_error) {
        // Password is invalid
        return Response.json({ error: 'Invalid credentials' }, { status: 401 })
      }
      
      // Password is valid, store it temporarily for 2FA verification step
      pendingLogins.set(email, {
        password,
        timestamp: Date.now(),
      })
      
      // Return 2FA required, session will be created after 2FA verification
      return Response.json({ 
        twoFactorRequired: true,
      }, { status: 200 })
    }

    // No 2FA required, verify password and create session with cookies
    try {
      await payload.login({
        collection: 'users',
        data: {
          email,
          password,
        },
        req, // Pass req to set session cookies
      })
    } catch (_error) {
      return Response.json({ error: 'Invalid credentials' }, { status: 401 })
    }

    // User is logged in successfully
    return Response.json({ 
      twoFactorRequired: false,
      success: true,
    }, { status: 200 })

  } catch (error) {
    console.error('Login init error:', error)
    return Response.json({ error: 'Login failed' }, { status: 500 })
  }
}

/**
 * POST /api/users/2fa/regenerate-backup-codes
 * Regenerate backup codes for the current user
 */
export const regenerateBackupCodesHandler = async (req: PayloadRequest): Promise<Response> => {
  const { payload, user } = req
  console.log('regenerateBackupCodesHandler called', { user: user?.email })

  if (!user || !user.email) {
    return Response.json({ error: 'Unauthorized' }, { status: 401 })
  }

  if (!user.twoFactorEnabled) {
    return Response.json({ error: '2FA is not enabled' }, { status: 400 })
  }

  // Try to get data from req.data (Payload) or parse json (Web API)
  let data = req.data
  if (!data && req.json) {
    try {
      data = await req.json()
    } catch (e) {
      console.log('regenerateBackupCodesHandler: Failed to parse JSON body', e)
    }
  }

  const { password } = data || {}

  if (!password) {
    return Response.json({ error: 'Password confirmation is required' }, { status: 400 })
  }

  try {
    // Verify password
    const isValidPassword = await payload.login({
      collection: 'users',
      data: {
        email: user.email,
        password,
      },
    })

    if (!isValidPassword) {
      return Response.json({ error: 'Invalid password' }, { status: 401 })
    }

    // Generate new backup codes
    const backupCodes = generateBackupCodes(10)
    const hashedBackupCodes = backupCodes.map(code => ({
      code: hashBackupCode(code),
      used: false,
    }))

    // Update user with new backup codes
    await payload.update({
      collection: 'users',
      id: user.id,
      data: {
        twoFactorBackupCodes: hashedBackupCodes,
      },
    })

    return Response.json({
      success: true,
      backupCodes,
    }, { status: 200 })
  } catch (error) {
    console.error('Backup codes regeneration error:', error)
    return Response.json({ error: 'Failed to regenerate backup codes' }, { status: 500 })
  }
}
</file>

<file path="src/payload/utils/2fa.ts">
import { authenticator } from 'otplib'
import QRCode from 'qrcode'
import crypto from 'crypto'

/**
 * Generate a new TOTP secret for a user
 */
export function generateTOTPSecret(): string {
  return authenticator.generateSecret()
}

/**
 * Generate a QR code data URL for TOTP setup
 */
export async function generateQRCode(email: string, secret: string): Promise<string> {
  const appName = 'Portfolio Admin'
  const otpauth = authenticator.keyuri(email, appName, secret)
  
  try {
    const qrCodeDataURL = await QRCode.toDataURL(otpauth)
    return qrCodeDataURL
  } catch {
    throw new Error('Failed to generate QR code')
  }
}

/**
 * Verify a TOTP code against a secret
 */
export function verifyTOTP(token: string, secret: string): boolean {
  try {
    return authenticator.verify({ token, secret })
  } catch {
    return false
  }
}

/**
 * Generate backup codes for account recovery
 */
export function generateBackupCodes(count: number = 10): string[] {
  const codes: string[] = []
  
  for (let i = 0; i < count; i++) {
    // Generate random 8-character alphanumeric code
    const code = crypto.randomBytes(4).toString('hex').toUpperCase()
    codes.push(code)
  }
  
  return codes
}

/**
 * Hash a backup code for secure storage
 */
export function hashBackupCode(code: string): string {
  return crypto.createHash('sha256').update(code).digest('hex')
}

/**
 * Verify a backup code against a hashed code
 */
export function verifyBackupCode(code: string, hashedCode: string): boolean {
  const hashedInput = hashBackupCode(code)
  return hashedInput === hashedCode
}

/**
 * Encrypt the TOTP secret before storing in database
 */
export function encryptSecret(secret: string): string {
  // For production, use proper encryption with a key from environment variables
  // For now, we'll use base64 encoding (NOT SECURE FOR PRODUCTION)
  // TODO: Implement proper encryption with crypto.createCipheriv
  return Buffer.from(secret).toString('base64')
}

/**
 * Decrypt the TOTP secret from database
 */
export function decryptSecret(encryptedSecret: string): string {
  // For production, use proper decryption
  // For now, we'll use base64 decoding
  // TODO: Implement proper decryption with crypto.createDecipheriv
  return Buffer.from(encryptedSecret, 'base64').toString('utf-8')
}
</file>

<file path="strapi/src/admin/app.example.tsx">
import type { StrapiApp } from '@strapi/strapi/admin';

export default {
  config: {
    locales: [
      // 'ar',
      // 'fr',
      // 'cs',
      // 'de',
      // 'dk',
      // 'es',
      // 'he',
      // 'id',
      // 'it',
      // 'ja',
      // 'ko',
      // 'ms',
      // 'nl',
      // 'no',
      // 'pl',
      // 'pt-BR',
      // 'pt',
      // 'ru',
      // 'sk',
      // 'sv',
      // 'th',
      // 'tr',
      // 'uk',
      // 'vi',
      // 'zh-Hans',
      // 'zh',
    ],
  },
  bootstrap(app: StrapiApp) {
    console.log(app);
  },
};
</file>

<file path="strapi/src/admin/tsconfig.json">
{
  "compilerOptions": {
    "target": "ESNext",
    "module": "ESNext",
    "moduleResolution": "Bundler",
    "useDefineForClassFields": true,
    "lib": ["DOM", "DOM.Iterable", "ESNext"],
    "allowJs": false,
    "skipLibCheck": true,
    "esModuleInterop": true,
    "allowSyntheticDefaultImports": true,
    "strict": true,
    "forceConsistentCasingInFileNames": true,
    "resolveJsonModule": true,
    "noEmit": true,
    "jsx": "react-jsx"
  },
  "include": ["../plugins/**/admin/src/**/*", "./"],
  "exclude": ["node_modules/", "build/", "dist/", "**/*.test.ts"]
}
</file>

<file path="strapi/src/admin/vite.config.example.ts">
import { mergeConfig, type UserConfig } from 'vite';

export default (config: UserConfig) => {
  // Important: always return the modified config
  return mergeConfig(config, {
    resolve: {
      alias: {
        '@': '/src',
      },
    },
  });
};
</file>

<file path="strapi/src/api/album/content-types/album/lifecycles.ts">
// src/api/album/content-types/album/lifecycles.ts

// --- Helper function to generate a random alphanumeric string ---
const generateRandomToken = (length: number): string => {
  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
  let result = '';
  for (let i = 0; i < length; i++) {
    result += chars.charAt(Math.floor(Math.random() * chars.length));
  }
  return result;
};

/**
 * Generates a unique token and ensures it doesn't already exist in the database.
 * @returns {Promise<string>} A unique token.
 */
const generateUniqueApprovalToken = async (): Promise<string> => {
  let token: string;
  let isUnique = false;
  
  while (!isUnique) {
    // --- THIS IS THE DEFINITIVE CHANGE ---
    token = generateRandomToken(5); // Generate a 5-character token
    // ------------------------------------
    
    const existingAlbum = await strapi.db.query('api::album.album').findOne({
      where: { approvalToken: token },
      select: ['id'],
    });

    if (!existingAlbum) {
      isUnique = true;
    } else {
      strapi.log.warn(`Token collision detected: ${token}. Generating a new one.`);
    }
  }
  
  return token;
};

export default {
  /**
   * This hook runs before creating or updating an album.
   */
  async beforeUpdate(event) {
    const { data, where } = event.params;

    if (data.approvalRequired === true) {
      const existingAlbum = await strapi.entityService.findOne('api::album.album', where.id);

      if (existingAlbum && !existingAlbum.approvalToken) {
        data.approvalToken = await generateUniqueApprovalToken();
        strapi.log.info(`Generated new 5-character unique approval token for Album ID: ${where.id}`);
      }
    }
  },
};
</file>

<file path="strapi/src/api/album/content-types/album/schema.json">
{
  "kind": "collectionType",
  "collectionName": "albums",
  "info": {
    "singularName": "album",
    "pluralName": "albums",
    "displayName": "Photography Album"
  },
  "options": {
    "draftAndPublish": true
  },
  "pluginOptions": {
    "i18n": {
      "localized": true
    }
  },
  "attributes": {
    "title": {
      "type": "string",
      "pluginOptions": {
        "i18n": {
          "localized": true
        }
      },
      "required": true
    },
    "slug": {
      "type": "uid",
      "targetField": "title",
      "required": true
    },
    "coverImage": {
      "type": "media",
      "pluginOptions": {
        "i18n": {
          "localized": true
        }
      },
      "multiple": false,
      "required": false,
      "allowedTypes": [
        "images"
      ]
    },
    "images": {
      "type": "media",
      "pluginOptions": {
        "i18n": {
          "localized": true
        }
      },
      "multiple": true,
      "required": false,
      "allowedTypes": [
        "images"
      ]
    },
    "approvalRequired": {
      "type": "boolean",
      "pluginOptions": {
        "i18n": {
          "localized": false
        }
      },
      "required": true,
      "default": false
    },
    "approvalToken": {
      "type": "string",
      "private": true,
      "pluginOptions": {
        "i18n": {
          "localized": false
        }
      },
      "unique": true
    },
    "clientName": {
      "type": "string",
      "pluginOptions": {
        "i18n": {
          "localized": false
        }
      }
    },
    "clientEmail": {
      "type": "email",
      "pluginOptions": {
        "i18n": {
          "localized": false
        }
      }
    },
    "approvalStatus": {
      "type": "enumeration",
      "pluginOptions": {
        "i18n": {
          "localized": false
        }
      },
      "default": "Pending",
      "enum": [
        "Pending",
        "Submitted",
        "Approved"
      ]
    },
    "imageApprovals": {
      "type": "json",
      "pluginOptions": {
        "i18n": {
          "localized": false
        }
      }
    },
    "selectionMin": {
      "type": "integer",
      "pluginOptions": {
        "i18n": {
          "localized": false
        }
      }
    },
    "selectionMax": {
      "type": "integer",
      "pluginOptions": {
        "i18n": {
          "localized": false
        }
      }
    },
    "allowDownloads": {
      "type": "boolean",
      "pluginOptions": {
        "i18n": {
          "localized": false
        }
      },
      "default": false
    },
    "publicationConsent": {
      "type": "boolean",
      "pluginOptions": {
        "i18n": {
          "localized": false
        }
      },
      "default": false
    },
    "testimonials": {
      "type": "relation",
      "relation": "oneToMany",
      "target": "api::testimonial.testimonial",
      "mappedBy": "album"
    },
    "customer": {
      "type": "relation",
      "relation": "oneToOne",
      "target": "plugin::users-permissions.user"
    }
  }
}
</file>

<file path="strapi/src/api/album/controllers/album.ts">
// src/api/album/controllers/album.ts

import { factories } from "@strapi/strapi";
import { clientConfirmationTemplates } from "../../../utils/emailTemplates";

// Helper function to create a URL-safe string
const sanitizeFilename = (str: string): string => {
  if (!str) return "";
  return str
    .toLowerCase()
    .replace(/\s+/g, "-")
    .replace(/[^\w\-.]+/g, "")
    .replace(/\-\-+/g, "-")
    .replace(/^-+/, "")
    .replace(/-+$/, "");
};

export default factories.createCoreController(
  "api::album.album",
  ({ strapi }) => ({
    /**
     * CUSTOM: Find albums for the currently logged-in user.
     */
    /**
     * Custom controller to fetch albums for the currently authenticated user.
     */
    async findMe(ctx) {
      // The user object is injected by the auth middleware
      const user = ctx.state.customer;

      if (!user) {
        return ctx.unauthorized("You must be logged in to view your albums.");
      }

      strapi.log.info(`Fetching albums for user ID: ${user.id}`);

      const entities = await strapi.entityService.findMany("api::album.album", {
        filters: { customer: { id: user.id } },
        populate: ["images", "coverImage", "testimonials"],
      });

      if (!entities) {
        return ctx.notFound("No albums found for this user.");
      }

      const sanitizedEntities = await this.sanitizeOutput(entities, ctx);
      return this.transformResponse(sanitizedEntities);
    },

    /**
     * CUSTOM: Find a single album, ensuring it belongs to the logged-in user.
     */
    async findOne(ctx) {
      const { user } = ctx.state;
      const { id } = ctx.params;

      if (!user) {
        return ctx.unauthorized("You must be logged in to view this album.");
      }

      // Fetch the album and populate the customer relation
      const album = await strapi.db.query("api::album.album").findOne({
        where: { id },
        populate: ["customer"],
      });

      if (!album) {
        return ctx.notFound("Album not found.");
      }

      // Check if the album's customer ID matches the logged-in user's ID
      if (!album.customer || album.customer.id !== user.id) {
        return ctx.forbidden("You don't have permission to access this album.");
      }

      // Now that we've verified ownership, call the original findOne to get the sanitized data.
      const sanitizedEntity = await super.findOne(ctx);

      return sanitizedEntity;
    },

    /**
     * Custom controller to fetch a single album by its unique approvalToken.
     */
    async findOneByToken(ctx) {
      const { token } = ctx.params;
      strapi.log.info(`Attempting to find album by approval token: ${token}`);

      if (!token) {
        return ctx.badRequest("Token is required.");
      }

      // Populate the testimonials relation to check if one already exists
      const entity = await strapi.db.query("api::album.album").findOne({
        where: { approvalToken: token, approvalRequired: true },
        populate: ["images", "coverImage", "testimonials"],
      });

      if (!entity) {
        strapi.log.warn(`No album found for token: ${token}`);
        return ctx.notFound("Album not found or does not require approval.");
      }

      strapi.log.info(
        `Successfully found album "${entity.title}" (ID: ${entity.id}) for token.`
      );
      const sanitizedEntity = await this.sanitizeOutput(entity, ctx);
      return this.transformResponse(sanitizedEntity);
    },

    /**
     * Custom controller to handle the submission of client approvals.
     */
    async submitApproval(ctx) {
      const { token } = ctx.params;
      const { imageApprovals, consentGiven } = ctx.request.body;
      strapi.log.info(`Approval submission received for token: ${token}`);

      if (!token) {
        return ctx.badRequest("Token is required.");
      }

      const album = await strapi.db.query("api::album.album").findOne({
        where: { approvalToken: token, approvalRequired: true },
      });

      if (!album) {
        strapi.log.warn(`No album found for token during submission: ${token}`);
        return ctx.notFound("Album not found.");
      }

      if (
        album.approvalStatus === "Submitted" ||
        album.approvalStatus === "Approved"
      ) {
        strapi.log.warn(
          `Attempted to re-submit approval for already submitted album ID: ${album.id}`
        );
        return ctx.forbidden(
          "This gallery has already been submitted for approval."
        );
      }

      const selectedCount = imageApprovals.filter(
        (img) => img.approved === true
      ).length;

      if (album.selectionMin && selectedCount < album.selectionMin) {
        return ctx.badRequest(
          `A minimum of ${album.selectionMin} images is required.`
        );
      }

      if (album.selectionMax && selectedCount > album.selectionMax) {
        return ctx.badRequest(
          `A maximum of ${album.selectionMax} images can be selected.`
        );
      }

      if (selectedCount > 0 && !consentGiven) {
        return ctx.badRequest(
          "Consent is required to approve images for publication."
        );
      }

      try {
        strapi.log.info(`Updating album ID: ${album.id} with approval data.`);
        const updatedAlbum = await strapi.entityService.update(
          "api::album.album",
          album.id,
          {
            data: {
              imageApprovals: imageApprovals || [],
              publicationConsent: consentGiven || false,
              approvalStatus: "Submitted",
            },
          }
        );

        strapi.log.info(
          `âœ… Album ID: ${album.id} successfully updated to "Submitted" status.`
        );

        if (updatedAlbum.clientEmail) {
          strapi.log.info(
            `Client email found. Sending confirmation to: ${updatedAlbum.clientEmail}`
          );

          const photographerName =
            process.env.NEXT_PUBLIC_FULL_NAME || "Your Photographer";
          const templateFunction =
            clientConfirmationTemplates[updatedAlbum.locale] ||
            clientConfirmationTemplates.en;

          const emailContent = templateFunction({
            clientName: updatedAlbum.clientName || "Client",
            albumTitle: updatedAlbum.title,
            selectedCount,
            photographerName,
          });

          try {
            await strapi.plugin("email").service("email").send({
              to: updatedAlbum.clientEmail,
              subject: emailContent.subject,
              html: emailContent.html,
            });
            strapi.log.info(
              `âœ… Client confirmation email sent successfully in '${updatedAlbum.locale}'.`
            );
          } catch (err) {
            strapi.log.error("Failed to send client confirmation email:", err);
          }
        }

        return this.transformResponse(updatedAlbum);
      } catch (error) {
        strapi.log.error("Error during approval submission:", error);
        return ctx.internalServerError(
          "An error occurred during the submission process."
        );
      }
    },

    /**
     * Custom controller to get download links for approved images.
     */
    async downloadMyApprovedImages(ctx) {
      const { id: albumId } = ctx.params;
      const user = ctx.state.user;

      if (!user) {
        return ctx.unauthorized("You must be logged in.");
      }

      const album = await strapi.db.query("api::album.album").findOne({
        where: { id: albumId, user: { id: user.id } }, // CRITICAL: Ensures user owns this album
        populate: ["images"],
      });

      if (!album) {
        return ctx.notFound(
          "Album not found or you do not have permission to access it."
        );
      }

      // The rest of the logic is similar to your existing `getDownloadLinks`
      if (!album.allowDownloads || album.approvalStatus !== "Submitted") {
        return ctx.forbidden(
          "Downloads are not currently available for this gallery."
        );
      }

      const approvedImageIds = album.imageApprovals
        .filter((approval) => approval.approved)
        .map((approval) => approval.imageId);

      if (approvedImageIds.length === 0) {
        return ctx.badRequest("No images have been approved for download.");
      }

      const approvedImages = album.images.filter((img) =>
        approvedImageIds.includes(img.id)
      );
      const downloadLinks = approvedImages.map((img) => img.url);

      return this.transformResponse(downloadLinks);
    },
  })
);
</file>

<file path="strapi/src/api/album/routes/album.ts">
// src/api/album/routes/album.ts

export default {
  routes: [
    {
      method: "GET",
      path: "/albums",
      handler: "album.find",
    },
    {
      method: "GET",
      path: "/albums/:id",
      handler: "album.findOne",
    },
    {
      method: "GET",
      path: "/albums/approve/:token",
      handler: "album.findOneByToken",
      config: {
        auth: false,
      },
    },
    {
      method: "GET",
      path: "/albums/me", // The new route for authenticated users
      handler: "album.findMe",
      config: {
        auth: { scope: ["find"] }, // Requires authentication
      },
    },
    {
      method: "POST",
      path: "/albums/submit-approval/:token",
      handler: "album.submitApproval",
      config: {
        auth: false,
      },
    },
    {
      method: "GET",
      path: "/albums/:id/download",
      handler: "album.downloadMyApprovedImages",
      config: {
        auth: { scope: ["find"] },
      },
    },
  ],
};
</file>

<file path="strapi/src/api/album/services/album.ts">
/**
 * album service
 */

import { factories } from '@strapi/strapi';

export default factories.createCoreService('api::album.album');
</file>

<file path="strapi/src/api/auth/controllers/auth.js">
// src/api/auth/controllers/auth.js
"use strict";

const { sanitize } = require("@strapi/utils");

module.exports = {
  async googleCallback(ctx) {
    const { query } = ctx.request;

    // The 'grant' provider middleware should have already processed the request
    // and attached the JWT and user info to the query string.
    const jwt = query.jwt;
    const user = query.user;

    const validLocales = ["en", "de"];
    const defaultLocale = "en";
    let locale = query.locale || defaultLocale;

    // Sanitize the locale to ensure it's one of the valid ones
    if (!validLocales.includes(locale)) {
      strapi.log.warn(
        `[Google Callback] Invalid locale provided: "${locale}". Falling back to "${defaultLocale}".`
      );
      locale = defaultLocale;
    }

    strapi.log.info(`[Google Callback] Received callback. JWT found: ${!!jwt}`);

    // This is the absolute URL of your frontend application
    const frontendUrl = process.env.FRONTEND_URL;
    if (!frontendUrl) {
      strapi.log.error(
        "[Google Callback] FRONTEND_URL is not set in environment variables."
      );
      return ctx.internalServerError(
        "Application is not configured correctly."
      );
    }

    if (!jwt) {
      strapi.log.warn(
        "[Google Callback] No JWT found in the callback query. Redirecting to login with error."
      );
      // Redirect back to the frontend login page with an error
      return ctx.redirect(`${frontendUrl}/login?error=authentication_failed`);
    }

    try {
      // Construct the final redirect URL to your frontend's callback handler
      const redirectUrl = new URL(`${frontendUrl}/connect/google/callback`);
      redirectUrl.searchParams.set("access_token", jwt);

      strapi.log.info(
        `[Google Callback] Successfully prepared redirect to: ${redirectUrl.href}`
      );

      // Manually and explicitly redirect to the frontend
      ctx.redirect(redirectUrl.href);
    } catch (error) {
      strapi.log.error(
        "[Google Callback] Failed to construct redirect URL or perform redirect:",
        error
      );
      return ctx.internalServerError(
        "An unexpected error occurred during the login process."
      );
    }
  },
};
</file>

<file path="strapi/src/api/auth/routes/auth.js">
// src/api/auth/routes/auth.js
module.exports = {
  routes: [
    {
      method: "GET",
      path: "/connect/google/callback", // We are explicitly overriding this path
      handler: "auth.googleCallback",
      config: {
        auth: false, // This route must be public for Google to redirect to it
      },
    },
  ],
};
</file>

<file path="strapi/src/api/skill/content-types/skill/schema.json">
{
  "kind": "collectionType",
  "collectionName": "skills",
  "info": {
    "singularName": "skill",
    "pluralName": "skills",
    "displayName": "Skill"
  },
  "options": {
    "draftAndPublish": false
  },
  "pluginOptions": {
    "i18n": {
      "localized": true
    }
  },
  "attributes": {
    "name": {
      "type": "string",
      "pluginOptions": {
        "i18n": {
          "localized": true
        }
      },
      "required": true
    },
    "iconClassName": {
      "type": "string",
      "pluginOptions": {
        "i18n": {
          "localized": true
        }
      }
    },
    "level": {
      "type": "integer",
      "pluginOptions": {
        "i18n": {
          "localized": true
        }
      },
      "required": true,
      "min": 1,
      "max": 5
    },
    "url": {
      "type": "string",
      "pluginOptions": {
        "i18n": {
          "localized": true
        }
      }
    },
    "skill_category": {
      "type": "relation",
      "relation": "manyToOne",
      "target": "api::skill-category.skill-category",
      "inversedBy": "skills"
    },
    "svgIcon": {
      "type": "media",
      "pluginOptions": {
        "i18n": {
          "localized": false
        }
      },
      "multiple": false,
      "allowedTypes": [
        "images",
        "files"
      ]
    }
  }
}
</file>

<file path="strapi/src/api/skill/controllers/skill.ts">
/**
 * skill controller
 */

import { factories } from '@strapi/strapi'

export default factories.createCoreController('api::skill.skill');
</file>

<file path="strapi/src/api/skill/routes/skill.ts">
/**
 * skill router
 */

import { factories } from '@strapi/strapi';

export default factories.createCoreRouter('api::skill.skill');
</file>

<file path="strapi/src/api/skill/services/skill.ts">
/**
 * skill service
 */

import { factories } from '@strapi/strapi';

export default factories.createCoreService('api::skill.skill');
</file>

<file path="strapi/src/api/skill-category/content-types/skill-category/schema.json">
{
  "kind": "collectionType",
  "collectionName": "skill_categories",
  "info": {
    "singularName": "skill-category",
    "pluralName": "skill-categories",
    "displayName": "Skill Category"
  },
  "options": {
    "draftAndPublish": false
  },
  "pluginOptions": {
    "i18n": {
      "localized": true
    }
  },
  "attributes": {
    "name": {
      "type": "string",
      "pluginOptions": {
        "i18n": {
          "localized": true
        }
      },
      "required": true
    },
    "order": {
      "type": "integer",
      "pluginOptions": {
        "i18n": {
          "localized": true
        }
      },
      "required": true,
      "default": 0
    },
    "skills": {
      "type": "relation",
      "relation": "oneToMany",
      "target": "api::skill.skill",
      "mappedBy": "skill_category"
    }
  }
}
</file>

<file path="strapi/src/api/skill-category/controllers/skill-category.ts">
/**
 * skill-category controller
 */

import { factories } from '@strapi/strapi'

export default factories.createCoreController('api::skill-category.skill-category');
</file>

<file path="strapi/src/api/skill-category/routes/skill-category.ts">
/**
 * skill-category router
 */

import { factories } from '@strapi/strapi';

export default factories.createCoreRouter('api::skill-category.skill-category');
</file>

<file path="strapi/src/api/skill-category/services/skill-category.ts">
/**
 * skill-category service
 */

import { factories } from '@strapi/strapi';

export default factories.createCoreService('api::skill-category.skill-category');
</file>

<file path="strapi/src/api/software-project/content-types/software-project/schema.json">
{
  "kind": "collectionType",
  "collectionName": "software_projects",
  "info": {
    "singularName": "software-project",
    "pluralName": "software-projects",
    "displayName": "Software Project"
  },
  "options": {
    "draftAndPublish": true
  },
  "pluginOptions": {
    "i18n": {
      "localized": true
    }
  },
  "attributes": {
    "title": {
      "type": "string",
      "pluginOptions": {
        "i18n": {
          "localized": true
        }
      },
      "required": true
    },
    "slug": {
      "type": "uid",
      "targetField": "title",
      "required": true
    },
    "description": {
      "type": "text",
      "pluginOptions": {
        "i18n": {
          "localized": true
        }
      },
      "required": true
    },
    "longDescription": {
      "type": "richtext",
      "pluginOptions": {
        "i18n": {
          "localized": true
        }
      }
    },
    "projectType": {
      "type": "string",
      "pluginOptions": {
        "i18n": {
          "localized": true
        }
      },
      "required": true
    },
    "developedAt": {
      "type": "date",
      "pluginOptions": {
        "i18n": {
          "localized": true
        }
      }
    },
    "liveUrl": {
      "type": "string",
      "pluginOptions": {
        "i18n": {
          "localized": true
        }
      }
    },
    "repoUrl": {
      "type": "string",
      "pluginOptions": {
        "i18n": {
          "localized": true
        }
      }
    },
    "tags": {
      "type": "json",
      "pluginOptions": {
        "i18n": {
          "localized": true
        }
      }
    },
    "coverImage": {
      "type": "media",
      "pluginOptions": {
        "i18n": {
          "localized": true
        }
      },
      "multiple": false,
      "required": false,
      "allowedTypes": [
        "images"
      ]
    },
    "gallery": {
      "type": "media",
      "pluginOptions": {
        "i18n": {
          "localized": true
        }
      },
      "multiple": true,
      "allowedTypes": [
        "images"
      ]
    }
  }
}
</file>

<file path="strapi/src/api/software-project/controllers/software-project.ts">
/**
 * software-project controller
 */

import { factories } from '@strapi/strapi'

export default factories.createCoreController('api::software-project.software-project');
</file>

<file path="strapi/src/api/software-project/routes/software-project.ts">
/**
 * software-project router
 */

import { factories } from '@strapi/strapi';

export default factories.createCoreRouter('api::software-project.software-project');
</file>

<file path="strapi/src/api/software-project/services/software-project.ts">
/**
 * software-project service
 */

import { factories } from '@strapi/strapi';

export default factories.createCoreService('api::software-project.software-project');
</file>

<file path="strapi/src/api/testimonial/content-types/testimonial/lifecycles.ts">
// src/api/testimonial/content-types/testimonial/lifecycles.ts

export default {
  async afterCreate(event) {
    const { result } = event;

    // Check if the entry was created as a draft (publishedAt is null)
    if (result && result.publishedAt === null) {
      strapi.log.info(`New testimonial draft created (ID: ${result.id}). Sending notification...`);

      const adminUrl = process.env.STRAPI_ADMIN_URL || 'http://localhost:1337';
      const notificationEmail = process.env.ADMIN_NOTIFICATION_EMAIL;

      if (!notificationEmail) {
        strapi.log.warn('ADMIN_NOTIFICATION_EMAIL environment variable is not set. Cannot send notification.');
        return;
      }

      try {
        await strapi.plugin('email').service('email').send({
          to: notificationEmail,
          subject: `New Testimonial for Moderation: ${result.name}`,
          html: `
            <h1>New Testimonial Awaiting Approval</h1>
            <p>A new testimonial has been submitted by <strong>${result.name}</strong>.</p>
            <p><strong>Review:</strong> <em>"${result.quote}"</em></p>
            <p>Please review and publish it from the Strapi admin panel.</p>
            <a href="${adminUrl}/admin/content-manager/collection-types/api::testimonial.testimonial/${result.id}" style="display: inline-block; padding: 10px 20px; font-size: 16px; color: #fff; background-color: #4945FF; text-decoration: none; border-radius: 5px;">
              Moderate Now
            </a>
          `,
        });
        strapi.log.info(`âœ… Notification email sent successfully to ${notificationEmail}`);
      } catch (err) {
        strapi.log.error('Failed to send notification email:', err);
      }
    }
  },
};
</file>

<file path="strapi/src/api/testimonial/content-types/testimonial/schema.json">
{
  "kind": "collectionType",
  "collectionName": "testimonials",
  "info": {
    "singularName": "testimonial",
    "pluralName": "testimonials",
    "displayName": "Testimonial"
  },
  "options": {
    "draftAndPublish": true
  },
  "pluginOptions": {
    "i18n": {
      "localized": true
    }
  },
  "attributes": {
    "quote": {
      "type": "text",
      "pluginOptions": {
        "i18n": {
          "localized": true
        }
      },
      "required": true
    },
    "name": {
      "type": "string",
      "pluginOptions": {
        "i18n": {
          "localized": true
        }
      },
      "required": true
    },
    "event": {
      "type": "string",
      "pluginOptions": {
        "i18n": {
          "localized": true
        }
      }
    },
    "communication": {
      "type": "integer",
      "pluginOptions": {
        "i18n": {
          "localized": true
        }
      },
      "min": 1,
      "max": 5
    },
    "creativity": {
      "type": "integer",
      "pluginOptions": {
        "i18n": {
          "localized": true
        }
      },
      "min": 1,
      "max": 5
    },
    "professionalism": {
      "type": "integer",
      "pluginOptions": {
        "i18n": {
          "localized": true
        }
      },
      "min": 1,
      "max": 5
    },
    "value": {
      "type": "integer",
      "pluginOptions": {
        "i18n": {
          "localized": true
        }
      },
      "min": 1,
      "max": 5
    },
    "avatar": {
      "type": "media",
      "pluginOptions": {
        "i18n": {
          "localized": true
        }
      },
      "multiple": false,
      "required": false,
      "allowedTypes": [
        "images"
      ]
    },
    "album": {
      "type": "relation",
      "relation": "manyToOne",
      "target": "api::album.album",
      "inversedBy": "testimonials"
    }
  }
}
</file>

<file path="strapi/src/api/testimonial/controllers/testimonial.ts">
// src/api/testimonial/controllers/testimonial.ts
import { factories } from '@strapi/strapi';
import axios from 'axios';
import path from 'path';

interface KoaFile {
  filepath: string;
  originalFilename: string;
  mimetype: string;
  size: number;
}

const sanitizeFilename = (str: string): string => {
  if (!str) return '';
  return str.toLowerCase().replace(/\s+/g, '-').replace(/[^\w\-.]+/g, '').replace(/\-\-+/g, '-').replace(/^-+/, '').replace(/-+$/, '');
};

export default factories.createCoreController('api::testimonial.testimonial', ({ strapi }) => ({
  async create(ctx) {
    const isMultipart = ctx.is('multipart');
    strapi.log.info(`--- Intercepting POST /api/testimonials. Request type: ${isMultipart ? 'Multipart' : 'JSON'}`);

    if (!isMultipart) {
      strapi.log.info('Request is not multipart. Bypassing to default Strapi core controller.');
      return super.create(ctx);
    }

    strapi.log.info('--- Custom Testimonial Controller: Handling multipart form data ---');

    const getFolder = async (name: string) => {
      const folders = await strapi.entityService.findMany('plugin::upload.folder', { filters: { name } });
      if (folders.length > 0) {
        strapi.log.info(`Found existing folder "${name}" with ID: ${folders[0].id}`);
        return folders[0];
      }
      strapi.log.info(`Folder "${name}" not found. Creating it...`);
      return await strapi.service('plugin::upload.folder').create({ name });
    };

    try {
      const { body, files } = ctx.request;

      if (!body.data) return ctx.badRequest('Missing "data" field in request body.');
      
      const data = JSON.parse(body.data);
      const { albumId, ...testimonialPayload } = data; // Destructure albumId from the rest of the data
      const recaptchaToken = body.recaptcha;

      if (!recaptchaToken) return ctx.badRequest('reCAPTCHA token is missing.');

      strapi.log.info('Verifying reCAPTCHA token...');
      const secretKey = process.env.RECAPTCHA_SECRET_KEY;
      const response = await axios.post(`https://www.google.com/recaptcha/api/siteverify`, `secret=${secretKey}&response=${recaptchaToken}`);
      
      if (!response.data.success || response.data.score < 0.5) {
        strapi.log.warn(`reCAPTCHA verification failed:`, response.data);
        return ctx.forbidden('reCAPTCHA verification failed.');
      }
      strapi.log.info(`reCAPTCHA verification successful.`);
      
      let avatarId = null;

      if (files && files.avatar) {
        strapi.log.info('Avatar file found. Attempting upload...');
        const file = files.avatar as KoaFile;
        const testimonialsFolder = await getFolder('Testimonials');
        
        const timestamp = Date.now();
        const sanitizedName = sanitizeFilename(data.name);
        const sanitizedEvent = sanitizeFilename(data.event);
        const extension = path.extname(file.originalFilename);

        const filenameParts = [timestamp, sanitizedName];
        if (sanitizedEvent) filenameParts.push(sanitizedEvent);
        
        const uniqueFilename = `${filenameParts.join('-')}${extension}`;
        
        file.originalFilename = uniqueFilename;

        const uploadedFiles = await strapi.plugin('upload').service('upload').upload({
          data: { fileInfo: { folder: testimonialsFolder.id } },
          files: file,
        });
        
        if (uploadedFiles && uploadedFiles.length > 0) {
          avatarId = uploadedFiles[0].id;
          strapi.log.info(`âœ… Successfully uploaded avatar with new name: ${uniqueFilename}. File ID: ${avatarId}`);
        }
      } else {
        strapi.log.warn('No avatar file was found in the multipart request.');
      }

      const finalData = { 
        ...testimonialPayload, 
        publishedAt: null, 
        avatar: avatarId,
        album: albumId ? Number(albumId) : null, // Link to album if albumId exists
      };
      
      const result = await strapi.db.query('api::testimonial.testimonial').create({ data: finalData });
      
      if (!result) {
        strapi.log.error('Database query returned no result. Creation failed silently.');
        return ctx.internalServerError('Failed to create testimonial entry.');
      }

      strapi.log.info('âœ… Testimonial created as a draft. Result ID:', result.id);
      
      const sanitizedResult = await this.sanitizeOutput(result, ctx);
      return this.transformResponse(sanitizedResult);
    } catch (error) {
      strapi.log.error('Error in custom multipart testimonial controller:', error.details || error);
      return ctx.internalServerError('An error occurred during submission.', { error: error.details || error });
    }
  }
}));
</file>

<file path="strapi/src/api/testimonial/routes/testimonial.ts">
/**
 * testimonial router
 */

import { factories } from '@strapi/strapi';

export default factories.createCoreRouter('api::testimonial.testimonial');
</file>

<file path="strapi/src/api/testimonial/services/testimonial.ts">
/**
 * testimonial service
 */

import { factories } from '@strapi/strapi';

export default factories.createCoreService('api::testimonial.testimonial');
</file>

<file path="strapi/src/utils/emailTemplates.ts">
// src/utils/emailTemplates.ts

// --- Style & Color Palette (inspired by your globals.css) ---
// We define these as constants for easy management and consistency.
const colors = {
  background: '#f8fafc',    // Corresponds to your light mode background
  foreground: '#18181b',    // Corresponds to your light mode foreground
  primary: '#4945FF',       // A vibrant accent, like Strapi's brand color
  card: '#ffffff',
  border: '#e5e7eb',
  mutedForeground: '#64748b',
};

const fontStack = `Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"`;

// --- Base Template Wrapper ---
// This function wraps our content in a responsive, email-safe HTML structure.
const createBaseTemplate = (content: string): string => `
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
  </style>
</head>
<body style="margin: 0; padding: 0; background-color: ${colors.background}; font-family: ${fontStack};">
  <table border="0" cellpadding="0" cellspacing="0" width="100%">
    <tr>
      <td style="padding: 20px 0;">
        <table align="center" border="0" cellpadding="0" cellspacing="0" width="600" style="max-width: 600px; border-collapse: collapse; background-color: ${colors.card}; border: 1px solid ${colors.border}; border-radius: 8px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);">
          <tr>
            <td style="padding: 40px 30px;">
              ${content}
            </td>
          </tr>
        </table>
      </td>
    </tr>
  </table>
</body>
</html>
`;


// --- Client Confirmation Email ---
interface ClientEmailParams {
  clientName: string;
  albumTitle: string;
  selectedCount: number;
  photographerName: string;
}

export const clientConfirmationTemplates = {
  en: ({ clientName, albumTitle, selectedCount, photographerName }: ClientEmailParams) => {
    const subject = `âœ… Confirmation: We've Received Your Selections for "${albumTitle}"`;
    const body = `
      <h1 style="font-size: 24px; color: ${colors.foreground}; font-weight: 700;">Thank You, ${clientName}!</h1>
      <p style="font-size: 16px; color: ${colors.mutedForeground}; line-height: 1.5;">This is an automated confirmation that we have successfully received your image selections for the album: <strong>${albumTitle}</strong>.</p>
      <p style="font-size: 16px; color: ${colors.mutedForeground}; line-height: 1.5;">You selected <strong>${selectedCount}</strong> images.</p>
      <p style="font-size: 16px; color: ${colors.mutedForeground}; line-height: 1.5;">I will review your selections and comments shortly and be in touch with the next steps.</p>
      <br>
      <p style="font-size: 16px; color: ${colors.mutedForeground}; line-height: 1.5;">Best regards,<br>${photographerName}</p>
    `;
    return { subject, html: createBaseTemplate(body) };
  },
  de: ({ clientName, albumTitle, selectedCount, photographerName }: ClientEmailParams) => {
    const subject = `âœ… BestÃ¤tigung: Wir haben Ihre Auswahl fÃ¼r "${albumTitle}" erhalten`;
    const body = `
      <h1 style="font-size: 24px; color: ${colors.foreground}; font-weight: 700;">Vielen Dank, ${clientName}!</h1>
      <p style="font-size: 16px; color: ${colors.mutedForeground}; line-height: 1.5;">Dies ist eine automatische BestÃ¤tigung, dass wir Ihre Bildauswahl fÃ¼r das Album <strong>${albumTitle}</strong> erfolgreich erhalten haben.</p>
      <p style="font-size: 16px; color: ${colors.mutedForeground}; line-height: 1.5;">Sie haben <strong>${selectedCount}</strong> Bilder ausgewÃ¤hlt.</p>
      <p style="font-size: 16px; color: ${colors.mutedForeground}; line-height: 1.5;">Ich werde Ihre Auswahl und Kommentare in KÃ¼rze prÃ¼fen und mich mit den nÃ¤chsten Schritten bei Ihnen melden.</p>
      <br>
      <p style="font-size: 16px; color: ${colors.mutedForeground}; line-height: 1.5;">Mit freundlichen GrÃ¼ÃŸen,<br>${photographerName}</p>
    `;
    return { subject, html: createBaseTemplate(body) };
  },
};


// --- Admin Notification Email ---
interface AdminEmailParams {
  clientName: string;
  albumTitle: string;
  adminLink: string;
  quote?: string;
}

export const adminNotificationTemplates = {
  en: ({ clientName, albumTitle, adminLink, quote }: AdminEmailParams) => {
    const subject = `ðŸ“¥ New Client Approval Submitted: ${albumTitle}`;
    const testimonialHtml = quote 
      ? `<p style="font-size: 16px; color: ${colors.mutedForeground}; line-height: 1.5; border-left: 3px solid ${colors.border}; padding-left: 15px; font-style: italic;"><strong>Testimonial:</strong> "${quote}"</p>`
      : '';
    const body = `
      <h1 style="font-size: 24px; color: ${colors.foreground}; font-weight: 700;">New Approval Submission</h1>
      <p style="font-size: 16px; color: ${colors.mutedForeground}; line-height: 1.5;"><strong>${clientName}</strong> has submitted their image selections and feedback for the album: <strong>${albumTitle}</strong>.</p>
      ${testimonialHtml}
      <table border="0" cellpadding="0" cellspacing="0" style="margin: 24px 0;">
        <tr>
          <td>
            <a href="${adminLink}" target="_blank" style="display: inline-block; padding: 12px 24px; font-size: 16px; color: #ffffff; background-color: ${colors.primary}; text-decoration: none; border-radius: 5px; font-weight: bold;">
              View Approvals in Strapi
            </a>
          </td>
        </tr>
      </table>
    `;
    return { subject, html: createBaseTemplate(body) };
  },
  de: ({ clientName, albumTitle, adminLink, quote }: AdminEmailParams) => {
    const subject = `ðŸ“¥ Neue Kundengenehmigung: ${albumTitle}`;
    const testimonialHtml = quote
      ? `<p style="font-size: 16px; color: ${colors.mutedForeground}; line-height: 1.5; border-left: 3px solid ${colors.border}; padding-left: 15px; font-style: italic;"><strong>Testimonial:</strong> â€ž${quote}â€œ</p>`
      : '';
    const body = `
      <h1 style="font-size: 24px; color: ${colors.foreground}; font-weight: 700;">Neue Freigabe eingegangen</h1>
      <p style="font-size: 16px; color: ${colors.mutedForeground}; line-height: 1.5;"><strong>${clientName}</strong> hat die Bildauswahl und das Feedback fÃ¼r das Album <strong>${albumTitle}</strong> eingereicht.</p>
      ${testimonialHtml}
      <table border="0" cellpadding="0" cellspacing="0" style="margin: 24px 0;">
        <tr>
          <td>
            <a href="${adminLink}" target="_blank" style="display: inline-block; padding: 12px 24px; font-size: 16px; color: #ffffff; background-color: ${colors.primary}; text-decoration: none; border-radius: 5px; font-weight: bold;">
              Freigaben in Strapi ansehen
            </a>
          </td>
        </tr>
      </table>
    `;
    return { subject, html: createBaseTemplate(body) };
  },
};
</file>

<file path="strapi/src/index.ts">
// import type { Core } from '@strapi/strapi';

export default {
  /**
   * An asynchronous register function that runs before
   * your application is initialized.
   *
   * This gives you an opportunity to extend code.
   */
  register(/* { strapi }: { strapi: Core.Strapi } */) {},

  /**
   * An asynchronous bootstrap function that runs before
   * your application gets started.
   *
   * This gives you an opportunity to set up your data model,
   * run jobs, or perform some special logic.
   */
  bootstrap(/* { strapi }: { strapi: Core.Strapi } */) {},
};
</file>

<file path="payload.config.ts">
import { sqliteAdapter } from '@payloadcms/db-sqlite'
import { lexicalEditor } from '@payloadcms/richtext-lexical'
import path from 'path'
import { buildConfig } from 'payload'
import { fileURLToPath } from 'url'
import sharp from 'sharp'

import { Users } from './src/payload/collections/Users'
import { Media } from './src/payload/collections/Media'
import { SoftwareProjects } from './src/payload/collections/SoftwareProjects'
import { Skills } from './src/payload/collections/Skills'
import { SkillCategories } from './src/payload/collections/SkillCategories'


const filename = fileURLToPath(import.meta.url)
const dirname = path.dirname(filename)

export default buildConfig({
  admin: {
    user: Users.slug,
    importMap: {
      baseDir: path.resolve(dirname),
      importMapFile: path.resolve(dirname, 'payload.importmap.ts'),
    },
    components: {
      views: {
        account: {
          Component: '@/payload/components/TwoFactorAuth#TwoFactorAuth',
        },
        login: {
          Component: '@/payload/components/Login#Login',
        },
      },
    },
  },
  collections: [Users, Media, SoftwareProjects, Skills, SkillCategories],
  editor: lexicalEditor(),
  secret: process.env.PAYLOAD_SECRET || 'super-secret-key',
  typescript: {
    outputFile: path.resolve(dirname, 'payload-types.ts'),
  },
  db: sqliteAdapter({
    client: {
      url: process.env.DATABASE_URI || 'file:./payload.db',
    },
  }),
  localization: {
    locales: ['en', 'de'],
    defaultLocale: 'en',
    fallback: true,
  },
  endpoints: [],
  sharp,
  plugins: [
    // storage-adapter-placeholder
  ],
})
</file>

<file path="payload.importmap.ts">
import { TwoFactorAuth as TwoFactorAuth_c9729ba6b84d84583e224485fdf34456 } from '@/payload/components/TwoFactorAuth'
import { RscEntryLexicalCell as RscEntryLexicalCell_44fe37237e0ebf4470c9990d8cb7b07e } from '@payloadcms/richtext-lexical/rsc'
import { RscEntryLexicalField as RscEntryLexicalField_44fe37237e0ebf4470c9990d8cb7b07e } from '@payloadcms/richtext-lexical/rsc'
import { LexicalDiffComponent as LexicalDiffComponent_44fe37237e0ebf4470c9990d8cb7b07e } from '@payloadcms/richtext-lexical/rsc'
import { InlineToolbarFeatureClient as InlineToolbarFeatureClient_e70f5e05f09f93e00b997edb1ef0c864 } from '@payloadcms/richtext-lexical/client'
import { HorizontalRuleFeatureClient as HorizontalRuleFeatureClient_e70f5e05f09f93e00b997edb1ef0c864 } from '@payloadcms/richtext-lexical/client'
import { UploadFeatureClient as UploadFeatureClient_e70f5e05f09f93e00b997edb1ef0c864 } from '@payloadcms/richtext-lexical/client'
import { BlockquoteFeatureClient as BlockquoteFeatureClient_e70f5e05f09f93e00b997edb1ef0c864 } from '@payloadcms/richtext-lexical/client'
import { RelationshipFeatureClient as RelationshipFeatureClient_e70f5e05f09f93e00b997edb1ef0c864 } from '@payloadcms/richtext-lexical/client'
import { LinkFeatureClient as LinkFeatureClient_e70f5e05f09f93e00b997edb1ef0c864 } from '@payloadcms/richtext-lexical/client'
import { ChecklistFeatureClient as ChecklistFeatureClient_e70f5e05f09f93e00b997edb1ef0c864 } from '@payloadcms/richtext-lexical/client'
import { OrderedListFeatureClient as OrderedListFeatureClient_e70f5e05f09f93e00b997edb1ef0c864 } from '@payloadcms/richtext-lexical/client'
import { UnorderedListFeatureClient as UnorderedListFeatureClient_e70f5e05f09f93e00b997edb1ef0c864 } from '@payloadcms/richtext-lexical/client'
import { IndentFeatureClient as IndentFeatureClient_e70f5e05f09f93e00b997edb1ef0c864 } from '@payloadcms/richtext-lexical/client'
import { AlignFeatureClient as AlignFeatureClient_e70f5e05f09f93e00b997edb1ef0c864 } from '@payloadcms/richtext-lexical/client'
import { HeadingFeatureClient as HeadingFeatureClient_e70f5e05f09f93e00b997edb1ef0c864 } from '@payloadcms/richtext-lexical/client'
import { ParagraphFeatureClient as ParagraphFeatureClient_e70f5e05f09f93e00b997edb1ef0c864 } from '@payloadcms/richtext-lexical/client'
import { InlineCodeFeatureClient as InlineCodeFeatureClient_e70f5e05f09f93e00b997edb1ef0c864 } from '@payloadcms/richtext-lexical/client'
import { SuperscriptFeatureClient as SuperscriptFeatureClient_e70f5e05f09f93e00b997edb1ef0c864 } from '@payloadcms/richtext-lexical/client'
import { SubscriptFeatureClient as SubscriptFeatureClient_e70f5e05f09f93e00b997edb1ef0c864 } from '@payloadcms/richtext-lexical/client'
import { StrikethroughFeatureClient as StrikethroughFeatureClient_e70f5e05f09f93e00b997edb1ef0c864 } from '@payloadcms/richtext-lexical/client'
import { UnderlineFeatureClient as UnderlineFeatureClient_e70f5e05f09f93e00b997edb1ef0c864 } from '@payloadcms/richtext-lexical/client'
import { BoldFeatureClient as BoldFeatureClient_e70f5e05f09f93e00b997edb1ef0c864 } from '@payloadcms/richtext-lexical/client'
import { ItalicFeatureClient as ItalicFeatureClient_e70f5e05f09f93e00b997edb1ef0c864 } from '@payloadcms/richtext-lexical/client'

import { Login as Login_manual } from '@/payload/components/Login'

export const importMap = {
  "@/payload/components/Login#Login": Login_manual,
  "@/payload/components/TwoFactorAuth#TwoFactorAuth": TwoFactorAuth_c9729ba6b84d84583e224485fdf34456,
  "@payloadcms/richtext-lexical/rsc#RscEntryLexicalCell": RscEntryLexicalCell_44fe37237e0ebf4470c9990d8cb7b07e,
  "@payloadcms/richtext-lexical/rsc#RscEntryLexicalField": RscEntryLexicalField_44fe37237e0ebf4470c9990d8cb7b07e,
  "@payloadcms/richtext-lexical/rsc#LexicalDiffComponent": LexicalDiffComponent_44fe37237e0ebf4470c9990d8cb7b07e,
  "@payloadcms/richtext-lexical/client#InlineToolbarFeatureClient": InlineToolbarFeatureClient_e70f5e05f09f93e00b997edb1ef0c864,
  "@payloadcms/richtext-lexical/client#HorizontalRuleFeatureClient": HorizontalRuleFeatureClient_e70f5e05f09f93e00b997edb1ef0c864,
  "@payloadcms/richtext-lexical/client#UploadFeatureClient": UploadFeatureClient_e70f5e05f09f93e00b997edb1ef0c864,
  "@payloadcms/richtext-lexical/client#BlockquoteFeatureClient": BlockquoteFeatureClient_e70f5e05f09f93e00b997edb1ef0c864,
  "@payloadcms/richtext-lexical/client#RelationshipFeatureClient": RelationshipFeatureClient_e70f5e05f09f93e00b997edb1ef0c864,
  "@payloadcms/richtext-lexical/client#LinkFeatureClient": LinkFeatureClient_e70f5e05f09f93e00b997edb1ef0c864,
  "@payloadcms/richtext-lexical/client#ChecklistFeatureClient": ChecklistFeatureClient_e70f5e05f09f93e00b997edb1ef0c864,
  "@payloadcms/richtext-lexical/client#OrderedListFeatureClient": OrderedListFeatureClient_e70f5e05f09f93e00b997edb1ef0c864,
  "@payloadcms/richtext-lexical/client#UnorderedListFeatureClient": UnorderedListFeatureClient_e70f5e05f09f93e00b997edb1ef0c864,
  "@payloadcms/richtext-lexical/client#IndentFeatureClient": IndentFeatureClient_e70f5e05f09f93e00b997edb1ef0c864,
  "@payloadcms/richtext-lexical/client#AlignFeatureClient": AlignFeatureClient_e70f5e05f09f93e00b997edb1ef0c864,
  "@payloadcms/richtext-lexical/client#HeadingFeatureClient": HeadingFeatureClient_e70f5e05f09f93e00b997edb1ef0c864,
  "@payloadcms/richtext-lexical/client#ParagraphFeatureClient": ParagraphFeatureClient_e70f5e05f09f93e00b997edb1ef0c864,
  "@payloadcms/richtext-lexical/client#InlineCodeFeatureClient": InlineCodeFeatureClient_e70f5e05f09f93e00b997edb1ef0c864,
  "@payloadcms/richtext-lexical/client#SuperscriptFeatureClient": SuperscriptFeatureClient_e70f5e05f09f93e00b997edb1ef0c864,
  "@payloadcms/richtext-lexical/client#SubscriptFeatureClient": SubscriptFeatureClient_e70f5e05f09f93e00b997edb1ef0c864,
  "@payloadcms/richtext-lexical/client#StrikethroughFeatureClient": StrikethroughFeatureClient_e70f5e05f09f93e00b997edb1ef0c864,
  "@payloadcms/richtext-lexical/client#UnderlineFeatureClient": UnderlineFeatureClient_e70f5e05f09f93e00b997edb1ef0c864,
  "@payloadcms/richtext-lexical/client#BoldFeatureClient": BoldFeatureClient_e70f5e05f09f93e00b997edb1ef0c864,
  "@payloadcms/richtext-lexical/client#ItalicFeatureClient": ItalicFeatureClient_e70f5e05f09f93e00b997edb1ef0c864
}
</file>

<file path="public/favicon-dark.svg">
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="hsl(240, 10%, 98%)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
  <polyline points="4 17 10 11 4 5"></polyline>
  <line x1="12" y1="19" x2="20" y2="19"></line>
</svg>
</file>

<file path="public/favicon-light.svg">
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="hsl(240, 10%, 10%)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
  <polyline points="4 17 10 11 4 5"></polyline>
  <line x1="12" y1="19" x2="20" y2="19"></line>
</svg>
</file>

<file path="src/app/[locale]/imprint/layout.tsx">
import UtilityPageLayout from "../utility-layout";

// This file re-exports the shared layout.
// Next.js will automatically use this layout for the impressum page.
export default UtilityPageLayout;
</file>

<file path="src/app/[locale]/privacy_policy/layout.tsx">
import UtilityPageLayout from "../utility-layout";

// This file re-exports the shared layout.
// Next.js will automatically use this layout for the datenschutz page.
export default UtilityPageLayout;
</file>

<file path="src/app/[locale]/utility-layout.tsx">
import { UtilityHeader } from "@/components/layout/UtilityHeader";
import { Footer } from "@/components/layout/Footer";

// This layout wraps our simple utility pages like Imprint and Privacy Policy.
export default function UtilityPageLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <div className="relative flex min-h-dvh flex-col bg-background">
      <UtilityHeader />
      <main className="flex-1">{children}</main>
      <Footer />
    </div>
  );
}
</file>

<file path="src/components/resume/PrintButton.tsx">
// src/components/resume/PrintButton.tsx
"use client";

import { Button } from "@/components/ui/button";
import { Download } from "lucide-react";

interface PrintButtonProps {
  label: string;
  filename?: string;
}

export function PrintButton({ label, filename }: PrintButtonProps) {
  return (
    <Button
      variant="outline"
      onClick={() => {
        // Triggers the browser's print dialog (Save as PDF)
        if (typeof window !== "undefined") {
          const originalTitle = document.title;
          if (filename) {
            document.title = filename;
          }
          window.print();
          // Restore the original title after the print dialog closes (or immediately, as print() is blocking)
          if (filename) {
            document.title = originalTitle;
          }
        }
      }}
    >
      <Download className="mr-2 h-4 w-4" /> {label}
    </Button>
  );
}
</file>

<file path="src/components/resume/ResumeAutoPrint.tsx">
"use client";

import { useSearchParams, useRouter } from "next/navigation";
import { useEffect, useRef } from "react";

export function ResumeAutoPrint() {
  const searchParams = useSearchParams();
  const router = useRouter();
  const hasPrinted = useRef(false);

  useEffect(() => {
    const shouldPrint = searchParams.get("print") === "true";

    if (shouldPrint && !hasPrinted.current) {
      hasPrinted.current = true;
      
      // Small delay to ensure rendering is complete
      setTimeout(() => {
        window.print();
        
        // Optional: Remove the query param after printing
        // const newParams = new URLSearchParams(searchParams.toString());
        // newParams.delete("print");
        // router.replace(`?${newParams.toString()}`, { scroll: false });
      }, 500);
    }
  }, [searchParams, router]);

  return null;
}
</file>

<file path="src/components/resume/ResumeHeader.tsx">
import { ResumeData } from "@/types/resume";
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar";
import { Globe, Mail, MapPin, Phone } from "lucide-react";

export function ResumeHeader({ basics }: { basics: ResumeData["basics"] }) {
  return (
    <div className="flex flex-col-reverse items-center justify-between gap-8 md:flex-row md:items-start mb-8">
      <div className="flex flex-col items-center md:items-start space-y-2">
        <h1 className="text-4xl font-bold tracking-tight">{basics.name}</h1>
        <p className="text-xl text-muted-foreground">{basics.headline}</p>

        <div className="flex flex-wrap justify-center md:justify-start gap-x-4 gap-y-2 text-sm text-muted-foreground mt-2">
          <div className="flex items-center gap-1">
            <MapPin className="h-3 w-3" /> {basics.location}
          </div>
          {basics.email && (
            <a
              href={`mailto:${basics.email}`}
              className="flex items-center gap-1 hover:text-foreground"
            >
              <Mail className="h-3 w-3" /> {basics.email}
            </a>
          )}
          {basics.phone && (
            <div className="flex items-center gap-1">
              <Phone className="h-3 w-3" /> {basics.phone}
            </div>
          )}
          {basics.url.href && (
            <a
              href={basics.url.href}
              target="_blank"
              className="flex items-center gap-1 hover:text-foreground"
            >
              <Globe className="h-3 w-3" /> Portfolio
            </a>
          )}
        </div>
      </div>

      <Avatar className="h-32 w-32 border-2 border-muted">
        <AvatarImage src={basics.picture.url} className="object-cover" />
        <AvatarFallback>{basics.name[0]}</AvatarFallback>
      </Avatar>
    </div>
  );
}
</file>

<file path="src/components/resume/ResumeItem.tsx">
import { ResumeItem } from "@/types/resume";

interface Props {
  item: ResumeItem;
  type: "work" | "education";
}

export function ResumeEntry({ item, type }: Props) {
  if (!item.visible) return null;

  const title = type === "work" ? item.position : item.studyType;
  const organization = type === "work" ? item.company : item.institution;
  
  // For education, area is shown as description
  const description = type === "education" ? item.area : null;

  return (
    <div className="flex flex-col gap-0 break-inside-avoid">
      {item.date && (
        <div>
          <span className="text-sm opacity-60 font-mono">
            {item.date}
          </span>
        </div>
      )}
      <div>
        <h3 className="font-bold text-lg leading-tight">
          {item.url?.href ? (
            <a
              href={item.url.href}
              target="_blank"
              rel="noopener noreferrer"
              className="hover:underline"
            >
              {organization}
            </a>
          ) : (
            organization
          )}
        </h3>
      </div>
      <div>
        <span className="font-semibold opacity-80 leading-tight">{title}</span>
      </div>

      {/* Education Area (Description style) */}
      {description && (
        <div className="text-sm opacity-70 leading-relaxed">
          {description}
        </div>
      )}

      {/* Render HTML content safely since your JSON contains <p> tags */}
      {item.summary && (
        <div
          className="text-sm opacity-70 leading-relaxed [&>p]:mb-0 [&_em]:not-italic"
          dangerouslySetInnerHTML={{ __html: item.summary }}
        />
      )}
    </div>
  );
}
</file>

<file path="src/components/sections/AnimatedProjectCard.tsx">
// src/components/sections/software/AnimatedProjectCard.tsx
"use client";

import { useRef } from "react";
import { Link } from "@/i18n/navigation";
import Image from "next/image";
import { motion, useScroll, useMotionValueEvent } from "framer-motion";
import type { SoftwareProject } from "@/lib/payload-types-shared";
import { getMediaUrl } from "@/lib/payload-helpers";
import { ArrowRight } from "lucide-react";
import { cn } from "@/lib/utils";
import { useTranslations } from "next-intl";

interface AnimatedProjectCardProps {
  project: SoftwareProject;
  index: number;
  isActive: boolean;
  onScrollProgressChange: (progress: number) => void;
}

const AnimatedLink = motion(Link);

export function AnimatedProjectCard({
  project,
  index,
  isActive,
  onScrollProgressChange,
}: AnimatedProjectCardProps) {
  const t = useTranslations("software.SoftwareProjectsSection");
  const cardRef = useRef<HTMLAnchorElement>(null);

  const { scrollYProgress } = useScroll({
    target: cardRef,
    offset: ["start end", "end start"],
  });

  useMotionValueEvent(scrollYProgress, "change", (latest) => {
    onScrollProgressChange(latest);
  });

  const { title, description, coverImage, projectType, slug } = project;
  const imageUrl = getMediaUrl(coverImage) || "/placeholder.jpg";

  return (
    // UPDATED: The motion link handles its own animation, no staggered fade-in
    <AnimatedLink
      ref={cardRef}
      href={`/${slug}`}
      data-active={isActive}
      className={cn(
        "group flex flex-col md:flex-row min-h-[410px] rounded-xl overflow-hidden shadow-lg",
        "transition-colors duration-300 ease-in-out", // Use transition for colors
        "focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-4 focus-visible:ring-offset-background",
        "data-[active=true]:bg-foreground"
      )}
      animate={{ scale: isActive ? 1.02 : 1 }}
      transition={{ duration: 0.3, ease: "easeInOut" }} // Transition for the scale
      whileHover={{ scale: 1.02 }}
      whileFocus={{ scale: 1.02 }}
    >
      {/* The rest of the component remains the same */}
      <div
        className={cn(
          "h-64 md:h-auto md:w-1/2 p-8 md:p-16",
          index % 2 === 1 ? "md:order-last" : ""
        )}
      >
        <div className="relative w-full h-full">
          <Image
            src={imageUrl}
            alt={`Preview for ${title}`}
            fill
            sizes="(max-width: 768px) 100vw, 50vw"
            className="object-contain"
          />
        </div>
      </div>
      <div className="flex flex-col md:w-1/2 p-10 md:p-16">
        <div className="flex-grow">
          <p className="text-sm font-semibold text-muted-foreground tracking-wider uppercase transition-colors duration-500 group-data-[active=true]:text-background/70">
            {projectType}
          </p>
          <h3 className="text-3xl font-bold mt-2 text-foreground transition-colors duration-500 group-data-[active=true]:text-background">
            {title}
          </h3>
          <p className="mt-4 text-muted-foreground line-clamp-3 transition-colors duration-500 group-data-[active=true]:text-background/80">
            {description}
          </p>
        </div>
        <div className="flex items-center gap-2 text-sm font-semibold text-foreground transition-colors duration-500 group-data-[active=true]:text-background">
          <span>{t("button_details")}</span>
          <ArrowRight className="h-4 w-4 transition-transform duration-300 group-data-[active=true]:translate-x-1" />
        </div>
      </div>
    </AnimatedLink>
  );
}
</file>

<file path="src/components/sections/ContactSection.tsx">
"use client";

import React, { useState, useRef } from "react";
import { motion, useScroll, useMotionValueEvent } from "framer-motion";
import { useTranslations } from "next-intl";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Textarea } from "@/components/ui/textarea";
import { Github, Linkedin, Instagram, CheckCircle2 } from "lucide-react";
import { cn } from "@/lib/utils";

export function ContactSection() {
  const t = useTranslations("software.SoftwareContactSection");
  // ... state and handlers remain the same
  const [submissionStatus, setSubmissionStatus] = useState<
    "idle" | "submitting" | "success" | "error"
  >("idle");

  const sectionRef = useRef<HTMLDivElement>(null);
  const [isActive, setIsActive] = useState(false);

  const { scrollYProgress } = useScroll({
    target: sectionRef,
    offset: ["start end", "end start"],
  });

  useMotionValueEvent(scrollYProgress, "change", (latest) => {
    setIsActive(latest > 0.2 && latest < 0.8);
  });

  const handleSubmit = async (event: React.FormEvent<HTMLFormElement>) => {
    event.preventDefault();
    setSubmissionStatus("submitting");
    const formData = new FormData(event.currentTarget);
    try {
      const response = await fetch(
        `https://formspree.io/f/${process.env.NEXT_PUBLIC_FORMSPREE_ID}`,
        {
          method: "POST",
          body: formData,
          headers: { Accept: "application/json" },
        }
      );
      if (response.ok) {
        setSubmissionStatus("success");
      } else {
        setSubmissionStatus("error");
      }
    } catch (error) {
      console.error("Form submission error:", error);
      setSubmissionStatus("error");
    }
  };

  return (
    <section id="kontakt" ref={sectionRef}>
      <motion.div
        data-active={isActive}
        className={cn(
          "group rounded-xl p-8 md:p-12 transition-all duration-300",
          "data-[active=true]:bg-foreground data-[active=true]:shadow-2xl"
        )}
        animate={{ scale: isActive ? 1.02 : 1 }}
        transition={{ duration: 0.15 }}
      >
        <div className="grid grid-cols-1 items-center gap-12 md:grid-cols-2">
          {/* ... Left Column remains the same */}
          <motion.div
            initial={{ opacity: 0, x: -50 }}
            whileInView={{ opacity: 1, x: 0 }}
            viewport={{ once: true }}
            transition={{ duration: 0.5 }}
          >
            <h2 className="text-4xl font-bold tracking-tight transition-colors duration-300 group-data-[active=true]:text-background">
              {t("title")}
            </h2>
            <p className="mt-4 text-lg leading-8 text-muted-foreground transition-colors duration-300 group-data-[active=true]:text-background/80">
              {t("subtitle")}
            </p>
            <div className="mt-8 flex items-center justify-start gap-4">
              <p className="text-sm text-muted-foreground transition-colors duration-300 group-data-[active=true]:text-background/70">
                {t("socials_text")}
              </p>
              <a
                href={`https://github.com/${process.env.NEXT_PUBLIC_GITHUB_USERNAME}`}
                target="_blank"
                rel="noopener noreferrer"
                aria-label="GitHub"
              >
                <Github className="h-6 w-6 text-muted-foreground transition-colors hover:text-foreground group-data-[active=true]:text-background/70 group-data-[active=true]:hover:text-background" />
              </a>
              <a
                href={`https://linkedin.com/in/${process.env.NEXT_PUBLIC_LINKEDIN_USERNAME}`}
                target="_blank"
                rel="noopener noreferrer"
                aria-label="LinkedIn"
              >
                <Linkedin className="h-6 w-6 text-muted-foreground transition-colors hover:text-foreground group-data-[active=true]:text-background/70 group-data-[active=true]:hover:text-background" />
              </a>
              <a
                href={`https://instagram.com/${process.env.NEXT_PUBLIC_INSTAGRAM_USERNAME}`}
                target="_blank"
                rel="noopener noreferrer"
                aria-label="Instagram"
              >
                <Instagram className="h-6 w-6 text-muted-foreground transition-colors hover:text-foreground group-data-[active=true]:text-background/70 group-data-[active=true]:hover:text-background" />
              </a>
            </div>
          </motion.div>

          {/* Column 2: The Interactive Form */}
          <motion.div
            initial={{ opacity: 0, x: 50 }}
            whileInView={{ opacity: 1, x: 0 }}
            viewport={{ once: true }}
            transition={{ duration: 0.5, delay: 0.2 }}
          >
            {submissionStatus === "success" ? (
              // ... success message remains the same
              <div className="flex flex-col items-center justify-center rounded-lg border-2 border-foreground p-8 text-center h-[380px] transition-colors duration-300 group-data-[active=true]:border-background">
                <CheckCircle2 className="h-16 w-16 text-green-500 mb-4" />
                <h3 className="text-2xl font-bold transition-colors duration-300 group-data-[active=true]:text-background">
                  {t("success_title")}
                </h3>
                <p className="text-muted-foreground mt-2 transition-colors duration-300 group-data-[active=true]:text-background/80">
                  {t("success_message")}
                </p>
              </div>
            ) : (
              <form onSubmit={handleSubmit} className="space-y-4">
                <div className="grid w-full items-center gap-1.5">
                  <Label
                    htmlFor="name"
                    className="transition-colors duration-300 group-data-[active=true]:text-background"
                  >
                    {t("form_name")}
                  </Label>
                  <Input
                    type="text"
                    id="name"
                    name="name"
                    placeholder={t("form_name_placeholder")}
                    required
                    // --- THIS IS THE FIX ---
                    className="transition-colors duration-300 group-data-[active=true]:bg-transparent group-data-[active=true]:border-background group-data-[active=true]:text-background group-data-[active=true]:placeholder:text-background/50 group-data-[active=true]:focus-visible:ring-background"
                  />
                </div>
                <div className="grid w-full items-center gap-1.5">
                  <Label
                    htmlFor="email"
                    className="transition-colors duration-300 group-data-[active=true]:text-background"
                  >
                    {t("form_email")}
                  </Label>
                  <Input
                    type="email"
                    id="email"
                    name="email"
                    placeholder={t("form_email_placeholder")}
                    required
                    // --- THIS IS THE FIX ---
                    className="transition-colors duration-300 group-data-[active=true]:bg-transparent group-data-[active=true]:border-background group-data-[active=true]:text-background group-data-[active=true]:placeholder:text-background/50 group-data-[active=true]:focus-visible:ring-background"
                  />
                </div>
                <div className="grid w-full items-center gap-1.5">
                  <Label
                    htmlFor="message"
                    className="transition-colors duration-300 group-data-[active=true]:text-background"
                  >
                    {t("form_message")}
                  </Label>
                  <Textarea
                    id="message"
                    name="message"
                    placeholder={t("form_message_placeholder")}
                    required
                    // --- THIS IS THE FIX ---
                    className="min-h-[100px] transition-colors duration-300 group-data-[active=true]:bg-transparent group-data-[active=true]:border-background group-data-[active=true]:text-background group-data-[active=true]:placeholder:text-background/50 group-data-[active=true]:focus-visible:ring-background"
                  />
                </div>
                <Button
                  type="submit"
                  className="w-full group-data-[active=true]:bg-transparent group-data-[active=true]:text-background group-data-[active=true]:border-background group-data-[active=true]:hover:bg-background group-data-[active=true]:hover:text-foreground"
                  disabled={submissionStatus === "submitting"}
                >
                  {submissionStatus === "submitting"
                    ? t("form_submitting")
                    : t("form_submit")}
                </Button>
                {submissionStatus === "error" && (
                  <p className="text-sm text-red-500 text-center">
                    {t("error_message")}
                  </p>
                )}
              </form>
            )}
          </motion.div>
        </div>
      </motion.div>
    </section>
  );
}
</file>

<file path="src/components/sections/ProjectsSection.tsx">
// src/components/sections/software/ProjectsSection.tsx
"use client";

import { useState, useRef, useEffect } from "react";
import { useTranslations } from "next-intl";
import type { SoftwareProject } from "@/lib/payload-types-shared";
import { AnimatedProjectCard } from "./AnimatedProjectCard";

interface ProjectsSectionProps {
  projects: SoftwareProject[];
}

export function ProjectsSection({ projects }: ProjectsSectionProps) {
  const t = useTranslations("software.SoftwareProjectsSection");
  const [activeCardId, setActiveCardId] = useState<number | null>(null);

  const scrollProgressRef = useRef<Record<string, number>>({});
  const ticking = useRef(false);

  useEffect(() => {
    const handleScroll = () => {
      if (!ticking.current) {
        window.requestAnimationFrame(() => {
          const progressValues = scrollProgressRef.current;
          let closestId = null;
          let minDistance = Infinity;

          for (const id in progressValues) {
            const distance = Math.abs(progressValues[id] - 0.5);
            if (distance < minDistance) {
              minDistance = distance;
              closestId = parseInt(id, 10);
            }
          }

          if (activeCardId !== closestId) {
            setActiveCardId(closestId);
          }
          ticking.current = false;
        });
        ticking.current = true;
      }
    };

    window.addEventListener("scroll", handleScroll);
    handleScroll(); // Initial check on load
    return () => window.removeEventListener("scroll", handleScroll);
  }, [activeCardId]);

  if (!projects || projects.length === 0) {
    return null;
  }

  return (
    <section id="projekte">
      <div className="text-center mb-16">
        <h2 className="text-4xl font-bold tracking-tight">{t("title")}</h2>
        <p className="mt-4 max-w-3xl mx-auto text-lg text-muted-foreground">
          {t("subtitle")}
        </p>
      </div>

      {/* UPDATED: We use a simple div here as the wrapper */}
      <div className="grid grid-cols-1 gap-16">
        {projects.map((project, index) => (
          // The AnimatedProjectCard component itself will handle its own scaling
          <AnimatedProjectCard
            key={project.id}
            project={project}
            index={index}
            isActive={project.id === activeCardId}
            onScrollProgressChange={(progress) => {
              scrollProgressRef.current[String(project.id)] = progress;
            }}
          />
        ))}
      </div>
    </section>
  );
}
</file>

<file path="src/components/sections/ResumeCTASection.tsx">
"use client";

import { Button } from "@/components/ui/button";
import { FileText, Download } from "lucide-react";
import { useTranslations } from "next-intl";
import { motion, useScroll, useMotionValueEvent } from "framer-motion";
import { useRef, useState } from "react";
import { cn } from "@/lib/utils";
import { Link } from "@/i18n/navigation";
import { useResumeDownload } from "@/hooks/useResumeDownload";

export function ResumeCTASection() {
  const t = useTranslations("software.ResumeCTASection");
  const sectionRef = useRef<HTMLDivElement>(null);
  const [isActive, setIsActive] = useState(false);
  const { downloadResume } = useResumeDownload();

  const { scrollYProgress } = useScroll({
    target: sectionRef,
    offset: ["start center", "end center"],
  });

  useMotionValueEvent(scrollYProgress, "change", (latest) => {
    if (latest > 0 && latest < 1) {
      setIsActive(true);
    } else {
      setIsActive(false);
    }
  });

  return (
    <section
      id="resume-cta"
      className="w-full py-24 md:py-48 flex items-center justify-center"
    >
      <div
        ref={sectionRef}
        data-active={isActive}
        className={cn(
          "w-full max-w-5xl mx-auto rounded-3xl transition-colors duration-500 ease-in-out group py-16 px-4 md:px-12",
          "bg-muted/30",
          "data-[active=true]:bg-foreground"
        )}
      >
        <div className="flex flex-col items-center text-center space-y-6">
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            whileInView={{ opacity: 1, y: 0 }}
            viewport={{ once: true }}
            transition={{ duration: 0.5 }}
            className="space-y-4 max-w-3xl"
          >
            <div className={cn(
              "p-3 w-fit mx-auto rounded-full mb-4 transition-colors duration-500",
              "bg-primary/10",
              "group-data-[active=true]:bg-background/10"
            )}>
              <FileText className={cn(
                "h-8 w-8 transition-colors duration-500",
                "text-primary",
                "group-data-[active=true]:text-background"
              )} />
            </div>
            <h2 className={cn(
              "text-3xl font-bold tracking-tighter sm:text-4xl md:text-5xl transition-colors duration-500",
              "group-data-[active=true]:text-background"
            )}>
              {t("title")}
            </h2>
            <p className={cn(
              "mx-auto max-w-[700px] md:text-xl/relaxed lg:text-base/relaxed xl:text-xl/relaxed transition-colors duration-500",
              "text-muted-foreground",
              "group-data-[active=true]:text-background/80"
            )}>
              {t("description")}
            </p>
          </motion.div>
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            whileInView={{ opacity: 1, y: 0 }}
            viewport={{ once: true }}
            transition={{ duration: 0.5, delay: 0.2 }}
            className="flex flex-col sm:flex-row gap-4 min-[400px]:gap-6"
          >
            <Button asChild size="lg" className={cn(
              "gap-2 transition-all duration-500 border-2 border-transparent",
              // Active State (Dark Card): Transparent with White Border -> Hover: White Button
              "group-data-[active=true]:bg-transparent group-data-[active=true]:text-background group-data-[active=true]:border-background",
              "group-data-[active=true]:hover:bg-background group-data-[active=true]:hover:text-foreground"
            )}>
              <Link href="/resume">
                <FileText className="h-4 w-4" />
                {t("viewResume")}
              </Link>
            </Button>
            <Button 
              size="lg" 
              onClick={downloadResume}
              className={cn(
              "gap-2 transition-all duration-500 border-2 border-transparent cursor-pointer",
              // Active State (Dark Card): Transparent with White Border -> Hover: White Button
              "group-data-[active=true]:bg-transparent group-data-[active=true]:text-background group-data-[active=true]:border-background",
              "group-data-[active=true]:hover:bg-background group-data-[active=true]:hover:text-foreground"
            )}>
                <Download className="h-4 w-4" />
                {t("downloadPdf")}
            </Button>
          </motion.div>
        </div>
      </div>
    </section>
  );
}
</file>

<file path="src/components/sections/SkillsSection.tsx">
// src/components/sections/software/SkillsSection.tsx
"use client";

import { useState, useRef } from "react";
import { motion, useScroll, useMotionValueEvent } from "framer-motion";
import { useTranslations } from "next-intl";
import { SkillsGrid } from "./SkillsGrid";
import { ProficiencyLegend } from "@/components/ProficiencyLegend";
import { cn } from "@/lib/utils";

// --- Interfaces remain the same ---
interface Skill {
  name: string;
  iconClassName: string;
  level: number;
  url: string;
}
interface SkillCategory {
  category: string;
  skills: Skill[];
}
interface SkillsSectionProps {
  skills: SkillCategory[];
}

export function SkillsSection({ skills }: SkillsSectionProps) {
  const t = useTranslations("software.SoftwareSkillsSection");
  const sectionRef = useRef<HTMLDivElement>(null);
  const [isActive, setIsActive] = useState(false);

  const { scrollYProgress } = useScroll({
    target: sectionRef,
    offset: ["start end", "end start"],
  });

  useMotionValueEvent(scrollYProgress, "change", (latest) => {
    setIsActive(latest > 0.2 && latest < 0.8);
  });

  return (
    <section id="skills" ref={sectionRef}>
      {/* UPDATED: Adjusted margin-bottom from mb-12 to mb-8 */}
      <div className="text-center mb-8">
        <h2 className="text-4xl font-bold tracking-tight">{t("title")}</h2>
        <p className="mt-4 max-w-3xl mx-auto text-lg text-muted-foreground">
          {t("subtitle")}
        </p>
        {/* The legend has been moved from here */}
      </div>

      <motion.div
        data-active={isActive}
        className={cn(
          "group rounded-xl p-6 md:p-8 overflow-hidden transition-all duration-300",
          "data-[active=true]:bg-foreground"
        )}
        animate={{ scale: isActive ? 1.02 : 1 }}
        transition={{ duration: 0.15 }}
      >
        <SkillsGrid skills={skills} />
      </motion.div>

      {/* NEW: The legend is now placed here, underneath the skills grid */}
      <div className="mt-8">
        <ProficiencyLegend />
      </div>
    </section>
  );
}
</file>

<file path="src/components/ui/alert.tsx">
// src/components/ui/alert.tsx
import * as React from "react";
import { cva, type VariantProps } from "class-variance-authority";

import { cn } from "@/lib/utils";

const alertVariants = cva(
  "relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",
  {
    variants: {
      variant: {
        default: "bg-background text-foreground",
        destructive:
          "border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
);

const Alert = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>
>(({ className, variant, ...props }, ref) => (
  <div
    ref={ref}
    role="alert"
    className={cn(alertVariants({ variant }), className)}
    {...props}
  />
));
Alert.displayName = "Alert";

const AlertTitle = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLHeadingElement>
>(({ className, ...props }, ref) => (
  <h5
    ref={ref}
    className={cn("mb-1 font-medium leading-none tracking-tight", className)}
    {...props}
  />
));
AlertTitle.displayName = "AlertTitle";

const AlertDescription = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    className={cn("text-sm [&_p]:leading-relaxed", className)}
    {...props}
  />
));
AlertDescription.displayName = "AlertDescription";

export { Alert, AlertTitle, AlertDescription };
</file>

<file path="src/components/ui/aspect-ratio.tsx">
"use client"

import * as AspectRatioPrimitive from "@radix-ui/react-aspect-ratio"

const AspectRatio = AspectRatioPrimitive.Root

export { AspectRatio }
</file>

<file path="src/components/ui/badge.tsx">
// src/components/ui/badge.tsx

import * as React from "react";
import { cva, type VariantProps } from "class-variance-authority";

import { cn } from "@/lib/utils";

const badgeVariants = cva(
  "inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",
  {
    variants: {
      variant: {
        default:
          "border-transparent bg-primary text-primary-foreground hover:bg-primary/80",
        secondary:
          "border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",
        destructive:
          "border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",
        outline: "border-foreground bg-transparent text-foreground",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
);

export interface BadgeProps
  extends React.HTMLAttributes<HTMLDivElement>,
    VariantProps<typeof badgeVariants> {}

function Badge({ className, variant, ...props }: BadgeProps) {
  return (
    <div className={cn(badgeVariants({ variant }), className)} {...props} />
  );
}

export { Badge, badgeVariants };
</file>

<file path="src/components/ui/card.tsx">
import * as React from "react";

import { cn } from "@/lib/utils";

const Card = React.forwardRef<
  HTMLDivElement,
  React.HTMLAttributes<HTMLDivElement>
>(({ className, ...props }, ref) => (
  <div
    ref={ref}
    // HIER FINDET DIE ANPASSUNG STATT
    className={cn(
      "rounded-lg border-2 border-foreground bg-card text-card-foreground shadow-md transition-shadow duration-300 hover:shadow-xl",
      className
    )}
    {...props}
  />
));
Card.displayName = "Card";

function CardHeader({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-header"
      className={cn(
        "@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",
        className
      )}
      {...props}
    />
  );
}

function CardTitle({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-title"
      className={cn("leading-none font-semibold", className)}
      {...props}
    />
  );
}

function CardDescription({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-description"
      className={cn("text-muted-foreground text-sm", className)}
      {...props}
    />
  );
}

function CardAction({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-action"
      className={cn(
        "col-start-2 row-span-2 row-start-1 self-start justify-self-end",
        className
      )}
      {...props}
    />
  );
}

function CardContent({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-content"
      className={cn("px-6", className)}
      {...props}
    />
  );
}

function CardFooter({ className, ...props }: React.ComponentProps<"div">) {
  return (
    <div
      data-slot="card-footer"
      className={cn("flex items-center px-6 [.border-t]:pt-6", className)}
      {...props}
    />
  );
}

export {
  Card,
  CardHeader,
  CardFooter,
  CardTitle,
  CardAction,
  CardDescription,
  CardContent,
};
</file>

<file path="src/components/ui/checkbox.tsx">
// src/components/ui/checkbox.tsx
"use client";

import * as React from "react";
import * as CheckboxPrimitive from "@radix-ui/react-checkbox";
import { Check } from "lucide-react";

import { cn } from "@/lib/utils";

const Checkbox = React.forwardRef<
  React.ElementRef<typeof CheckboxPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>
>(({ className, ...props }, ref) => (
  <CheckboxPrimitive.Root
    ref={ref}
    className={cn(
      "grid place-content-center peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",
      className
    )}
    {...props}
  >
    <CheckboxPrimitive.Indicator
      className={cn("grid place-content-center text-current")}
    >
      <Check className="h-4 w-4" />
    </CheckboxPrimitive.Indicator>
  </CheckboxPrimitive.Root>
));
Checkbox.displayName = CheckboxPrimitive.Root.displayName;

export { Checkbox };
</file>

<file path="src/components/ui/collapsible.tsx">
// src/components/ui/collapsible.tsx
"use client";

import * as React from "react";
import * as CollapsiblePrimitive from "@radix-ui/react-collapsible";
import { cn } from "@/lib/utils";

const Collapsible = CollapsiblePrimitive.Root;

const CollapsibleTrigger = CollapsiblePrimitive.Trigger;

const CollapsibleContent = React.forwardRef<
  React.ElementRef<typeof CollapsiblePrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof CollapsiblePrimitive.Content>
>(({ className, ...props }, ref) => (
  <CollapsiblePrimitive.Content
    ref={ref}
    className={cn(
      "overflow-hidden transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",
      className
    )}
    {...props}
  />
));
CollapsibleContent.displayName = "CollapsibleContent";

export { Collapsible, CollapsibleTrigger, CollapsibleContent };
</file>

<file path="src/components/ui/dropdown-menu.tsx">
"use client"

import * as React from "react"
import * as DropdownMenuPrimitive from "@radix-ui/react-dropdown-menu"
import { CheckIcon, ChevronRightIcon, CircleIcon } from "lucide-react"

import { cn } from "@/lib/utils"

function DropdownMenu({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Root>) {
  return <DropdownMenuPrimitive.Root data-slot="dropdown-menu" {...props} />
}

function DropdownMenuPortal({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Portal>) {
  return (
    <DropdownMenuPrimitive.Portal data-slot="dropdown-menu-portal" {...props} />
  )
}

function DropdownMenuTrigger({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Trigger>) {
  return (
    <DropdownMenuPrimitive.Trigger
      data-slot="dropdown-menu-trigger"
      {...props}
    />
  )
}

function DropdownMenuContent({
  className,
  sideOffset = 4,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Content>) {
  return (
    <DropdownMenuPrimitive.Portal>
      <DropdownMenuPrimitive.Content
        data-slot="dropdown-menu-content"
        sideOffset={sideOffset}
        className={cn(
          "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",
          className
        )}
        {...props}
      />
    </DropdownMenuPrimitive.Portal>
  )
}

function DropdownMenuGroup({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Group>) {
  return (
    <DropdownMenuPrimitive.Group data-slot="dropdown-menu-group" {...props} />
  )
}

function DropdownMenuItem({
  className,
  inset,
  variant = "default",
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Item> & {
  inset?: boolean
  variant?: "default" | "destructive"
}) {
  return (
    <DropdownMenuPrimitive.Item
      data-slot="dropdown-menu-item"
      data-inset={inset}
      data-variant={variant}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      {...props}
    />
  )
}

function DropdownMenuCheckboxItem({
  className,
  children,
  checked,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.CheckboxItem>) {
  return (
    <DropdownMenuPrimitive.CheckboxItem
      data-slot="dropdown-menu-checkbox-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      checked={checked}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <DropdownMenuPrimitive.ItemIndicator>
          <CheckIcon className="size-4" />
        </DropdownMenuPrimitive.ItemIndicator>
      </span>
      {children}
    </DropdownMenuPrimitive.CheckboxItem>
  )
}

function DropdownMenuRadioGroup({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.RadioGroup>) {
  return (
    <DropdownMenuPrimitive.RadioGroup
      data-slot="dropdown-menu-radio-group"
      {...props}
    />
  )
}

function DropdownMenuRadioItem({
  className,
  children,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.RadioItem>) {
  return (
    <DropdownMenuPrimitive.RadioItem
      data-slot="dropdown-menu-radio-item"
      className={cn(
        "focus:bg-accent focus:text-accent-foreground relative flex cursor-default items-center gap-2 rounded-sm py-1.5 pr-2 pl-8 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",
        className
      )}
      {...props}
    >
      <span className="pointer-events-none absolute left-2 flex size-3.5 items-center justify-center">
        <DropdownMenuPrimitive.ItemIndicator>
          <CircleIcon className="size-2 fill-current" />
        </DropdownMenuPrimitive.ItemIndicator>
      </span>
      {children}
    </DropdownMenuPrimitive.RadioItem>
  )
}

function DropdownMenuLabel({
  className,
  inset,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Label> & {
  inset?: boolean
}) {
  return (
    <DropdownMenuPrimitive.Label
      data-slot="dropdown-menu-label"
      data-inset={inset}
      className={cn(
        "px-2 py-1.5 text-sm font-medium data-[inset]:pl-8",
        className
      )}
      {...props}
    />
  )
}

function DropdownMenuSeparator({
  className,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Separator>) {
  return (
    <DropdownMenuPrimitive.Separator
      data-slot="dropdown-menu-separator"
      className={cn("bg-border -mx-1 my-1 h-px", className)}
      {...props}
    />
  )
}

function DropdownMenuShortcut({
  className,
  ...props
}: React.ComponentProps<"span">) {
  return (
    <span
      data-slot="dropdown-menu-shortcut"
      className={cn(
        "text-muted-foreground ml-auto text-xs tracking-widest",
        className
      )}
      {...props}
    />
  )
}

function DropdownMenuSub({
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.Sub>) {
  return <DropdownMenuPrimitive.Sub data-slot="dropdown-menu-sub" {...props} />
}

function DropdownMenuSubTrigger({
  className,
  inset,
  children,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.SubTrigger> & {
  inset?: boolean
}) {
  return (
    <DropdownMenuPrimitive.SubTrigger
      data-slot="dropdown-menu-sub-trigger"
      data-inset={inset}
      className={cn(
        "focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground flex cursor-default items-center rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[inset]:pl-8",
        className
      )}
      {...props}
    >
      {children}
      <ChevronRightIcon className="ml-auto size-4" />
    </DropdownMenuPrimitive.SubTrigger>
  )
}

function DropdownMenuSubContent({
  className,
  ...props
}: React.ComponentProps<typeof DropdownMenuPrimitive.SubContent>) {
  return (
    <DropdownMenuPrimitive.SubContent
      data-slot="dropdown-menu-sub-content"
      className={cn(
        "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-hidden rounded-md border p-1 shadow-lg",
        className
      )}
      {...props}
    />
  )
}

export {
  DropdownMenu,
  DropdownMenuPortal,
  DropdownMenuTrigger,
  DropdownMenuContent,
  DropdownMenuGroup,
  DropdownMenuLabel,
  DropdownMenuItem,
  DropdownMenuCheckboxItem,
  DropdownMenuRadioGroup,
  DropdownMenuRadioItem,
  DropdownMenuSeparator,
  DropdownMenuShortcut,
  DropdownMenuSub,
  DropdownMenuSubTrigger,
  DropdownMenuSubContent,
}
</file>

<file path="src/components/ui/input.tsx">
import * as React from "react"

import { cn } from "@/lib/utils"

const Input = React.forwardRef<HTMLInputElement, React.ComponentProps<"input">>(
  ({ className, type, ...props }, ref) => {
    return (
      <input
        type={type}
        className={cn(
          "flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
          className
        )}
        ref={ref}
        {...props}
      />
    )
  }
)
Input.displayName = "Input"

export { Input }
</file>

<file path="src/components/ui/label.tsx">
"use client"

import * as React from "react"
import * as LabelPrimitive from "@radix-ui/react-label"
import { cva, type VariantProps } from "class-variance-authority"

import { cn } from "@/lib/utils"

const labelVariants = cva(
  "text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"
)

const Label = React.forwardRef<
  React.ElementRef<typeof LabelPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &
    VariantProps<typeof labelVariants>
>(({ className, ...props }, ref) => (
  <LabelPrimitive.Root
    ref={ref}
    className={cn(labelVariants(), className)}
    {...props}
  />
))
Label.displayName = LabelPrimitive.Root.displayName

export { Label }
</file>

<file path="src/components/ui/navigation-menu.tsx">
import * as React from "react"
import * as NavigationMenuPrimitive from "@radix-ui/react-navigation-menu"
import { cva } from "class-variance-authority"
import { ChevronDown } from "lucide-react"

import { cn } from "@/lib/utils"

const NavigationMenu = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>
>(({ className, children, ...props }, ref) => (
  <NavigationMenuPrimitive.Root
    ref={ref}
    className={cn(
      "relative z-10 flex max-w-max flex-1 items-center justify-center",
      className
    )}
    {...props}
  >
    {children}
    <NavigationMenuViewport />
  </NavigationMenuPrimitive.Root>
))
NavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName

const NavigationMenuList = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>
>(({ className, ...props }, ref) => (
  <NavigationMenuPrimitive.List
    ref={ref}
    className={cn(
      "group flex flex-1 list-none items-center justify-center space-x-1",
      className
    )}
    {...props}
  />
))
NavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName

const NavigationMenuItem = NavigationMenuPrimitive.Item

const navigationMenuTriggerStyle = cva(
  "group inline-flex h-9 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent"
)

const NavigationMenuTrigger = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>
>(({ className, children, ...props }, ref) => (
  <NavigationMenuPrimitive.Trigger
    ref={ref}
    className={cn(navigationMenuTriggerStyle(), "group", className)}
    {...props}
  >
    {children}{" "}
    <ChevronDown
      className="relative top-[1px] ml-1 h-3 w-3 transition duration-300 group-data-[state=open]:rotate-180"
      aria-hidden="true"
    />
  </NavigationMenuPrimitive.Trigger>
))
NavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName

const NavigationMenuContent = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>
>(({ className, ...props }, ref) => (
  <NavigationMenuPrimitive.Content
    ref={ref}
    className={cn(
      "left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto ",
      className
    )}
    {...props}
  />
))
NavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName

const NavigationMenuLink = NavigationMenuPrimitive.Link

const NavigationMenuViewport = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>
>(({ className, ...props }, ref) => (
  <div className={cn("absolute left-0 top-full flex justify-center")}>
    <NavigationMenuPrimitive.Viewport
      className={cn(
        "origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]",
        className
      )}
      ref={ref}
      {...props}
    />
  </div>
))
NavigationMenuViewport.displayName =
  NavigationMenuPrimitive.Viewport.displayName

const NavigationMenuIndicator = React.forwardRef<
  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,
  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>
>(({ className, ...props }, ref) => (
  <NavigationMenuPrimitive.Indicator
    ref={ref}
    className={cn(
      "top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in",
      className
    )}
    {...props}
  >
    <div className="relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md" />
  </NavigationMenuPrimitive.Indicator>
))
NavigationMenuIndicator.displayName =
  NavigationMenuPrimitive.Indicator.displayName

export {
  navigationMenuTriggerStyle,
  NavigationMenu,
  NavigationMenuList,
  NavigationMenuItem,
  NavigationMenuContent,
  NavigationMenuTrigger,
  NavigationMenuLink,
  NavigationMenuIndicator,
  NavigationMenuViewport,
}
</file>

<file path="src/components/ui/popover.tsx">
// src/components/ui/popover.tsx
"use client";

import * as React from "react";
import * as PopoverPrimitive from "@radix-ui/react-popover";

import { cn } from "@/lib/utils";

const Popover = PopoverPrimitive.Root;

const PopoverTrigger = PopoverPrimitive.Trigger;

const PopoverContent = React.forwardRef<
  React.ElementRef<typeof PopoverPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>
>(({ className, align = "center", sideOffset = 4, ...props }, ref) => (
  <PopoverPrimitive.Portal>
    <PopoverPrimitive.Content
      ref={ref}
      align={align}
      sideOffset={sideOffset}
      className={cn(
        "z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",
        className
      )}
      {...props}
    />
  </PopoverPrimitive.Portal>
));
PopoverContent.displayName = PopoverPrimitive.Content.displayName;

export { Popover, PopoverTrigger, PopoverContent };
</file>

<file path="src/components/ui/separator.tsx">
"use client"

import * as React from "react"
import * as SeparatorPrimitive from "@radix-ui/react-separator"

import { cn } from "@/lib/utils"

const Separator = React.forwardRef<
  React.ElementRef<typeof SeparatorPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>
>(
  (
    { className, orientation = "horizontal", decorative = true, ...props },
    ref
  ) => (
    <SeparatorPrimitive.Root
      ref={ref}
      decorative={decorative}
      orientation={orientation}
      className={cn(
        "shrink-0 bg-border",
        orientation === "horizontal" ? "h-[1px] w-full" : "h-full w-[1px]",
        className
      )}
      {...props}
    />
  )
)
Separator.displayName = SeparatorPrimitive.Root.displayName

export { Separator }
</file>

<file path="src/components/ui/slider.tsx">
"use client"

import * as React from "react"
import * as SliderPrimitive from "@radix-ui/react-slider"

import { cn } from "@/lib/utils"

const Slider = React.forwardRef<
  React.ElementRef<typeof SliderPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>
>(({ className, ...props }, ref) => (
  <SliderPrimitive.Root
    ref={ref}
    className={cn(
      "relative flex w-full touch-none select-none items-center",
      className
    )}
    {...props}
  >
    <SliderPrimitive.Track className="relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20">
      <SliderPrimitive.Range className="absolute h-full bg-primary" />
    </SliderPrimitive.Track>
    <SliderPrimitive.Thumb className="block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50" />
  </SliderPrimitive.Root>
))
Slider.displayName = SliderPrimitive.Root.displayName

export { Slider }
</file>

<file path="src/components/ui/switch.tsx">
"use client"

import * as React from "react"
import * as SwitchPrimitives from "@radix-ui/react-switch"

import { cn } from "@/lib/utils"

const Switch = React.forwardRef<
  React.ElementRef<typeof SwitchPrimitives.Root>,
  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>
>(({ className, ...props }, ref) => (
  <SwitchPrimitives.Root
    className={cn(
      "peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",
      className
    )}
    {...props}
    ref={ref}
  >
    <SwitchPrimitives.Thumb
      className={cn(
        "pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0"
      )}
    />
  </SwitchPrimitives.Root>
))
Switch.displayName = SwitchPrimitives.Root.displayName

export { Switch }
</file>

<file path="src/components/ui/tabs.tsx">
"use client";

import * as React from "react";
import * as TabsPrimitive from "@radix-ui/react-tabs";

import { cn } from "@/lib/utils";

const Tabs = TabsPrimitive.Root;

const TabsList = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.List>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.List
    ref={ref}
    className={cn(
      "inline-flex h-auto items-center justify-center p-0 text-muted-foreground",
      className
    )}
    {...props}
  />
));
TabsList.displayName = TabsPrimitive.List.displayName;

const TabsTrigger = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.Trigger>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.Trigger
    ref={ref}
    className={cn(
      "inline-flex items-center justify-center whitespace-nowrap px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",
      // --- THIS IS THE FIX ---
      // The `-mb-px` has been removed.
      "border-b-2 border-transparent",
      "data-[state=active]:text-foreground data-[state=active]:border-foreground",
      className
    )}
    {...props}
  />
));
TabsTrigger.displayName = TabsPrimitive.Trigger.displayName;

const TabsContent = React.forwardRef<
  React.ElementRef<typeof TabsPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>
>(({ className, ...props }, ref) => (
  <TabsPrimitive.Content
    ref={ref}
    className={cn(
      "mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",
      className
    )}
    {...props}
  />
));
TabsContent.displayName = TabsPrimitive.Content.displayName;

export { Tabs, TabsList, TabsTrigger, TabsContent };
</file>

<file path="src/components/ui/textarea.tsx">
import * as React from "react"

import { cn } from "@/lib/utils"

const Textarea = React.forwardRef<
  HTMLTextAreaElement,
  React.ComponentProps<"textarea">
>(({ className, ...props }, ref) => {
  return (
    <textarea
      className={cn(
        "flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
        className
      )}
      ref={ref}
      {...props}
    />
  )
})
Textarea.displayName = "Textarea"

export { Textarea }
</file>

<file path="src/components/AnimatedGrid.tsx">
// src/components/AnimatedGrid.tsx
"use client";

import { motion } from "framer-motion";

const gridVariants = {
  hidden: { opacity: 0 },
  visible: {
    opacity: 1,
    transition: {
      staggerChildren: 0.1, // LÃ¤sst die Kinder nacheinander erscheinen
    },
  },
};

const itemVariants = {
  hidden: { y: 20, opacity: 0 },
  visible: {
    y: 0,
    opacity: 1,
    transition: {
      duration: 0.5,
    },
  },
};

// Diese Komponente umhÃ¼llt das Gitter
export function AnimatedGrid({ children }: { children: React.ReactNode }) {
  return (
    <motion.div
      className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"
      variants={gridVariants}
      initial="hidden"
      animate="visible"
    >
      {children}
    </motion.div>
  );
}

// Diese Komponente umhÃ¼llt jedes einzelne Element im Gitter
export function AnimatedGridItem({ children }: { children: React.ReactNode }) {
  return (
    <motion.div
      variants={itemVariants}
      whileHover={{ y: -5, transition: { duration: 0.2 } }}
    >
      {children}
    </motion.div>
  );
}
</file>

<file path="src/components/ScrollIndicator.tsx">
// File: frontend/src/components/ScrollIndicator.tsx
"use client";

import { useRef } from "react";
import { motion, useScroll, useTransform } from "framer-motion";
import { ArrowDown } from "lucide-react";

interface ScrollIndicatorProps {
  href: string;
}

export function ScrollIndicator({ href }: ScrollIndicatorProps) {
  const ref = useRef<HTMLAnchorElement>(null);

  const { scrollYProgress } = useScroll({
    target: ref,
    offset: ["start end", "end start"],
  });

  // --- THIS IS THE FIX ---
  // We've adjusted the mapping to be much more aggressive.
  const opacity = useTransform(
    scrollYProgress,
    // Input range (scroll progress):
    [
      0, // When it first enters the screen
      0.25, // Stays fully visible until it's 25% up the screen
      0.5, // Completely faded out by the time it reaches the middle
      1, // Stays faded out
    ],
    // Output range (opacity):
    [1, 1, 0, 0]
  );
  // -----------------------

  return (
    <motion.a
      ref={ref}
      href={href}
      aria-label="Scroll to next section"
      className="flex justify-center"
      style={{ opacity }}
    >
      <motion.div
        className="rounded-full border border-muted-foreground/50 p-1.5"
        animate={{ y: [0, 6, 0] }}
        transition={{
          duration: 2,
          repeat: Infinity,
          repeatType: "loop",
          ease: "easeInOut",
        }}
      >
        <ArrowDown className="h-5 w-5 text-muted-foreground" />
      </motion.div>
    </motion.a>
  );
}
</file>

<file path="src/components/SkillIcon.tsx">
"use client";

import { getMediaUrl } from "@/lib/payload-helpers";
import { useEffect, useState } from "react";
import Image from "next/image";

interface SkillIconProps {
  className?: string;
  iconClassName?: string | null;
  svgIconUrl?: string | null;
  altText?: string | null;
}

// This component fetches SVG content and renders it inline for styling.
export function SkillIcon({
  className,
  iconClassName,
  svgIconUrl,
  altText,
}: SkillIconProps) {
  const [svgContent, setSvgContent] = useState<string | null>(null);

  useEffect(() => {
    if (svgIconUrl) {
      const fullUrl = getMediaUrl(svgIconUrl);
      if (fullUrl) {
        // Fetch the raw SVG content from the URL
        fetch(fullUrl)
          .then((res) => res.text())
          .then((text) => {
            // Basic sanitization to remove scripts, just in case
            const sanitized = text.replace(
              /<script\b[^>]*>[\s\S]*?<\/script\b[^>]*>/gi,
              ""
            );
            setSvgContent(sanitized);
          })
          .catch(console.error);
      }
    }
  }, [svgIconUrl]);

  // If a Devicon class is provided, render the <i> tag
  if (iconClassName) {
    return <i className={`${className} ${iconClassName}`} />;
  }

  // If we have fetched SVG content, render it inline
  if (svgContent) {
    return (
      <div
        className={className}
        dangerouslySetInnerHTML={{ __html: svgContent }}
      />
    );
  }

  // If an SVG URL is provided but not yet loaded, show a placeholder or an Image fallback.
  // Using Next/Image here is a good fallback for non-SVG files or loading states.
  if (svgIconUrl) {
    const fullUrl = getMediaUrl(svgIconUrl);
    return fullUrl ? (
      <Image
        src={fullUrl}
        alt={altText || "Skill icon"}
        width={20}
        height={20}
        className={className}
      />
    ) : null;
  }

  // If no icon is provided at all, render an empty div to maintain layout
  return <div className={className} />;
}
</file>

<file path="src/components/Theme-Provider.tsx">
"use client";

import * as React from "react";
// 1. THE FIX IS HERE: We import both the component AND its type from the main package.
import {
  ThemeProvider as NextThemesProvider,
  type ThemeProviderProps,
} from "next-themes";

export function ThemeProvider({ children, ...props }: ThemeProviderProps) {
  return <NextThemesProvider {...props}>{children}</NextThemesProvider>;
}
</file>

<file path="src/data/resume.json">
{
  "basics": {
    "name": "Joel Dettinger",
    "headline": "Master's Student in Computer Science",
    "email": "dettinger.joel@gmail.com",
    "location": "08904 L'Hospitalet de Llobregat, Spain",
    "url": {
      "label": "",
      "href": "https://codeby.joeldettinger.de"
    },
    "customFields": [],
    "picture": {
      "url": "http://localhost:9000/default/cmhwk812x0000c8ldcxvg0kx2/pictures/bx99ohszkij2rn5axhjlyio5.jpg",
      "size": 200,
      "aspectRatio": 1,
      "borderRadius": 9999,
      "effects": {
        "hidden": false,
        "border": true,
        "grayscale": false
      }
    }
  },
  "sections": {
    "summary": {
      "name": "Summary",
      "columns": 1,
      "separateLinks": true,
      "visible": true,
      "id": "summary",
      "content": "<p>I am a German master's student in computer science at Vrije University and the University of Amsterdam. I am currently completing an academic exchange at the Autonomous University of Barcelona. I have experience in project management, DevOps, infrastructure as code, and AI, and I specialize in mobile and web development.</p>"
    },
    "awards": {
      "name": "Awards",
      "columns": 1,
      "separateLinks": true,
      "visible": true,
      "id": "awards",
      "items": []
    },
    "certifications": {
      "name": "Certifications",
      "columns": 1,
      "separateLinks": true,
      "visible": true,
      "id": "certifications",
      "items": []
    },
    "education": {
      "name": "Education",
      "columns": 1,
      "separateLinks": true,
      "visible": true,
      "id": "education",
      "items": [
        {
          "id": "fx3lypkefwy8m68bcw1egysb",
          "visible": true,
          "institution": "University of Amsterdam & Vrije University Amsterdam",
          "studyType": "Master of Science",
          "area": "Computer Science (Joint Degree)",
          "score": "8.1 GPA",
          "date": "September, 2024 â€“ Present",
          "summary": "",
          "url": {
            "href": "https://www.uva.nl"
          }
        },
        {
          "id": "uzdfy1790xqzzn3cwfdt87og",
          "visible": true,
          "institution": "Autonomous University of Barcelona",
          "studyType": "Academic Exchange",
          "area": "Modelling for Science",
          "score": "",
          "date": "September, 2024 - Present",
          "summary": "",
          "url": {
            "href": "https://www.uab.cat"
          }
        },
        {
          "id": "z1s656m79acl1pw55hjei4c8",
          "visible": true,
          "institution": "Media University",
          "studyType": "Bachelor of Science",
          "area": "Mobile Media",
          "score": "1.6 (9 GPA)",
          "date": "March, 2019 â€“ August, 2023",
          "summary": "",
          "url": {
            "href": "https://www.hdm-stuttgart.de"
          }
        },
        {
          "id": "qb4rsvbx500t4q728phnd20e",
          "visible": true,
          "institution": "University of the West of Scotland",
          "studyType": "Academic Exchange",
          "area": "Web & Mobile Development",
          "score": "",
          "date": "August, 2021 â€“ December, 2021",
          "summary": "",
          "url": {
            "href": "https://www.uws.ac.uk"
          }
        }
      ]
    },
    "experience": {
      "name": "Experience",
      "columns": 1,
      "separateLinks": true,
      "visible": true,
      "id": "experience",
      "items": [
        {
          "id": "v61g0ytaa3ap8fbitzoy0lxz",
          "visible": true,
          "company": "MHP Management and IT Consulting",
          "position": "Thesis Student",
          "location": "Ludwigsburg (DE)",
          "date": "March, 2023 â€“ August, 2023",
          "summary": "<p><em>Bachelor Thesis: Infrastructure recovery with Terraform (IaC) and CI/CD.</em></p>",
          "url": {
            "href": "https://www.mhp.com"
          }
        },
        {
          "id": "gwjn6nvfxi01w241txhlf1tg",
          "visible": true,
          "company": "Capgemini",
          "position": "Working Student",
          "location": "Stuttgart (DE)",
          "date": "April, 2022 â€“ September, 2022",
          "summary": "<p><em>Frontend Development with AngularJS, UI Design, and MongoDB database management.</em></p>",
          "url": {
            "href": "https://www.capgemini.com"
          }
        },
        {
          "id": "wtmes6zm9b701ph60y7pwv41",
          "visible": true,
          "company": "MHP Management and IT Consulting",
          "position": "Intern",
          "location": "Ludwigsburg (DE)",
          "date": "March, 2021 â€“ August, 2021",
          "summary": "<p><em>Frontend development, GraphQL concept implementation, Azure Platform.</em></p>",
          "url": {
            "href": "https://www.mhp.com"
          }
        }
      ]
    },
    "volunteer": {
      "name": "Volunteering",
      "columns": 1,
      "separateLinks": true,
      "visible": false,
      "id": "volunteer",
      "items": [
        {
          "id": "p17dyvedy8ed7bg61w6eu4yc",
          "visible": true,
          "organization": "Media University",
          "position": "Volunteer Buddy Program",
          "location": "",
          "date": "2020-10-01 - 2021-02-01",
          "summary": "Support for exchange students with registration, banking, housing, and activities.",
          "url": {
            "label": "",
            "href": ""
          }
        }
      ]
    },
    "interests": {
      "name": "Interests",
      "columns": 1,
      "separateLinks": true,
      "visible": false,
      "id": "interests",
      "items": [
        {
          "id": "qq81bwos0407x0njx4qxoqci",
          "visible": true,
          "name": "Road Cycling",
          "keywords": []
        },
        {
          "id": "z6lsj77lulamoyw7rdvu082x",
          "visible": true,
          "name": "Climbing",
          "keywords": []
        },
        {
          "id": "aqhyyldji8zpwkbjvz215v8d",
          "visible": true,
          "name": "Photography",
          "keywords": []
        }
      ]
    },
    "languages": {
      "name": "Languages",
      "columns": 1,
      "separateLinks": true,
      "visible": false,
      "id": "languages",
      "items": [
        {
          "id": "h6kv2bq1c1he9ozsgnrv4vqz",
          "visible": true,
          "name": "English",
          "description": "Proficient (C1/C2)",
          "level": 5
        },
        {
          "id": "e9kfdhzw531hq0vz0yrqzkvj",
          "visible": true,
          "name": "Spanish",
          "description": "Basic/Independent (A2/B1)",
          "level": 2
        }
      ]
    },
    "profiles": {
      "name": "Profiles",
      "columns": 1,
      "separateLinks": true,
      "visible": true,
      "id": "profiles",
      "items": [
        {
          "id": "a619bvaogcf4qg0p7v4jpsnt",
          "visible": true,
          "network": "LinkedIn",
          "username": "joeldettinger",
          "icon": "linkedin",
          "url": {
            "label": "",
            "href": "https://www.linkedin.com/in/joeldettinger"
          }
        },
        {
          "id": "pv415d9waiub9soory41gncl",
          "visible": true,
          "network": "GitHub",
          "username": "dettinjo",
          "icon": "github",
          "url": {
            "label": "Portfolio",
            "href": "https://github.com/dettinjo"
          }
        }
      ]
    },
    "projects": {
      "name": "Projects",
      "columns": 1,
      "separateLinks": true,
      "visible": true,
      "id": "projects",
      "items": []
    },
    "publications": {
      "name": "Publications",
      "columns": 1,
      "separateLinks": true,
      "visible": true,
      "id": "publications",
      "items": []
    },
    "references": {
      "name": "References",
      "columns": 1,
      "separateLinks": true,
      "visible": true,
      "id": "references",
      "items": []
    },
    "skills": {
      "name": "Skills",
      "columns": 1,
      "separateLinks": true,
      "visible": true,
      "id": "skills",
      "items": [
        {
          "id": "hivo8a2kqvvfemolc0se5djf",
          "visible": true,
          "name": "Frontend",
          "description": "",
          "level": 4,
          "keywords": [
            "Angular",
            "Framer Motion",
            "Next.js",
            "React",
            "Tailwind CSS",
            "TypeScript"
          ]
        },
        {
          "id": "pulx7631ag4ryf777tbgjm24",
          "visible": true,
          "name": "Mobile",
          "description": "",
          "level": 3,
          "keywords": ["Android Jetpacks", "Core Data", "Kotlin", "Swift"]
        },
        {
          "id": "zzmee963mdcm0mzq39ufi6cl",
          "visible": true,
          "name": "Backend",
          "description": "",
          "level": 3,
          "keywords": [
            "PHP",
            "Express.js",
            "Node.js",
            "MySQL",
            "PostgreSQL",
            "MongoDB",
            "Python",
            "Bash",
            "GraphQL",
            "REST"
          ]
        },
        {
          "id": "rsjpyllckjzxcvcym084pddc",
          "visible": true,
          "name": "DevOps",
          "description": "",
          "level": 2,
          "keywords": [
            "CI/CD (Gitlab CI)",
            "Git",
            "Docker",
            "Terraform",
            "Nginx",
            "Microsoft Azure",
            "Kubernetes"
          ]
        },
        {
          "id": "kc37zigvasb492d13g7yasvj",
          "visible": true,
          "name": "AI & Data Science",
          "description": "",
          "level": 2,
          "keywords": [
            "Pandas",
            "MathLab",
            "R",
            "PyTorch",
            "spaCy",
            "Meta Llama",
            "Hugging Face Transformers"
          ]
        }
      ]
    },
    "custom": {}
  },
  "metadata": {
    "template": "glalie",
    "layout": [
      [
        [
          "profiles",
          "summary",
          "experience",
          "education",
          "projects",
          "volunteer",
          "references"
        ],
        [
          "skills",
          "certifications",
          "awards",
          "publications",
          "languages",
          "interests"
        ]
      ]
    ],
    "css": {
      "value": "* {\n\toutline: 1px solid #000;\n\toutline-offset: 4px;\n}",
      "visible": false
    },
    "page": {
      "margin": 30,
      "format": "a4",
      "options": {
        "breakLine": true,
        "pageNumbers": false
      }
    },
    "theme": {
      "background": "#202A35",
      "text": "#ffffff",
      "primary": "#ffffff"
    },
    "typography": {
      "font": {
        "family": "Arial",
        "subset": "greek",
        "variants": ["regular"],
        "size": 14.5
      },
      "lineHeight": 1.2,
      "hideIcons": false,
      "underlineLinks": false
    },
    "notes": ""
  }
}
</file>

<file path="src/hooks/useResumeDownload.ts">
"use client";

import { useCallback } from "react";

export function useResumeDownload() {
  const downloadResume = useCallback(() => {
    const iframe = document.createElement("iframe");
    iframe.style.display = "none";
    iframe.src = "/resume?print=true";
    document.body.appendChild(iframe);

    // Clean up the iframe after a reasonable amount of time
    // The printing itself is handled by the page inside the iframe
    setTimeout(() => {
      document.body.removeChild(iframe);
    }, 5000); // 5 seconds should be enough for the print dialog to appear and the print to start
  }, []);

  return { downloadResume };
}
</file>

<file path="src/i18n/navigation.ts">
import { createNavigation } from 'next-intl/navigation';
import { routing } from './routing';

export const { Link, redirect, usePathname, useRouter, getPathname } =
  createNavigation(routing);
</file>

<file path="src/lib/utils.ts">
import { clsx, type ClassValue } from "clsx"
import { twMerge } from "tailwind-merge"

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs))
}
</file>

<file path="src/types/resume.ts">
// src/types/resume.ts

export interface ResumeProfile {
  network: string;
  username: string;
  url: { href: string };
}

export interface ResumeItem {
  id: string;
  visible: boolean;
  institution?: string;
  company?: string;
  studyType?: string;
  area?: string;
  position?: string;
  date?: string;
  summary?: string;
  score?: string;
  url?: { href: string };
  keywords?: string[];
  name?: string;
  level?: number;
  description?: string;
  network?: string;
  username?: string;
}

export interface ResumeSection {
  name: string;
  visible: boolean;
  items: ResumeItem[];
}

export interface ResumeData {
  basics: {
    name: string;
    headline: string;
    email: string;
    phone?: string;
    location: string;
    url: { href: string };
    picture: { url: string };
  };
  sections: {
    summary: { content: string };
    education: ResumeSection;
    experience: ResumeSection;
    skills: ResumeSection;
    languages: ResumeSection;
    profiles: ResumeSection;
    // Add others if needed (awards, etc.)
  };
}
</file>

<file path="components.json">
{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "new-york",
  "rsc": true,
  "tsx": true,
  "tailwind": {
    "config": "tailwind.config.js",
    "css": "src/app/globals.css",
    "baseColor": "zinc",
    "cssVariables": true,
    "prefix": ""
  },
  "iconLibrary": "lucide",
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils",
    "ui": "@/components/ui",
    "lib": "@/lib",
    "hooks": "@/hooks"
  },
  "registries": {}
}
</file>

<file path="postcss.config.js">
module.exports = {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
}
</file>

<file path="src/app/[locale]/[slug]/page.tsx">
import { notFound } from "next/navigation";
import { getTranslations, getFormatter } from "next-intl/server";
import { Link } from "@/i18n/navigation";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { ArrowLeft, ExternalLink, Github } from "lucide-react";
import { ProjectGallery } from "@/components/ProjectGallery";
import { Metadata } from "next";
import { WithContext, SoftwareApplication, BreadcrumbList } from "schema-dts";
import {
  fetchSoftwareProjectBySlug,
  fetchAllProjectSlugs,
  getTechDetailsMap,
} from "@/lib/payload";
import { getMediaUrl } from "@/lib/payload-helpers";
import { cn } from "@/lib/utils";
import { LongTextRenderer } from "@/components/LongTextRenderer";
import { AlternateLinksProvider } from "@/context/AlternateLinksProvider";
import { SoftwareHeader } from "@/components/layout/SoftwareHeader";
import { Footer } from "@/components/layout/Footer";

export async function generateStaticParams() {
  const projects = await fetchAllProjectSlugs();
  return projects.map((project) => ({ slug: project.slug }));
}

// UPDATED: 'params' prop is now correctly typed as a Promise.
type Props = {
  params: Promise<{ slug: string; locale: string }>;
};

export async function generateMetadata({ params }: Props): Promise<Metadata> {
  // UPDATED: Await the promise to safely access slug and locale.
  const { slug, locale } = await params;
  const project = await fetchSoftwareProjectBySlug(slug, locale);
  if (!project) return { title: "Project Not Found" };

  const { title, description, coverImage, localizations } = project;
  const imageUrl = getMediaUrl(coverImage);
  const softwareDomain = process.env.NEXT_PUBLIC_SOFTWARE_DOMAIN;

  const languages: Record<string, string> = {};
  if (softwareDomain) {
    languages[locale] = `https://${softwareDomain}${
      locale === "de" ? "/de" : ""
    }/${slug}`;
    localizations?.forEach((loc) => {
      languages[loc.locale] = `https://${softwareDomain}${
        loc.locale === "de" ? "/de" : ""
      }/${loc.slug}`;
    });
  }

  return {
    title: title,
    description: description,
    openGraph: {
      title,
      description,
      images: imageUrl ? [{ url: imageUrl, alt: `Preview for ${title}` }] : [],
      type: "article",
      locale: locale,
    },
    alternates: {
      canonical: softwareDomain
        ? `https://${softwareDomain}${locale === "de" ? "/de" : ""}/${slug}`
        : undefined,
      languages: languages,
    },
  };
}

// UPDATED: The component now takes 'Props' and awaits 'params'.
export default async function ProjectDetailPage({ params }: Props) {
  // UPDATED: Await the promise to safely access slug and locale.
  const { slug, locale } = await params;

  const [project, techDetailsMap] = await Promise.all([
    fetchSoftwareProjectBySlug(slug, locale),
    getTechDetailsMap(),
  ]);

  if (!project) {
    notFound();
  }

  const alternateSlugs: Record<string, string> = {};
  if (project.localizations) {
    for (const localization of project.localizations) {
      alternateSlugs[localization.locale] = `/${localization.slug}`;
    }
  }

  const t = await getTranslations("software.ProjectDetailsPage");
  const format = await getFormatter({ locale: locale });

  const {
    title,
    description,
    longDescription,
    projectType,
    developedAt,
    liveUrl,
    repoUrl,
    tags,
    coverImage,
    gallery,
  } = project;

  const tagBaseClasses =
    "inline-flex items-center rounded-full border px-2 py-0.5 text-xs font-semibold transition-colors focus:outline-none";

  const jsonLd: WithContext<SoftwareApplication> = {
    "@context": "https://schema.org",
    "@type": "SoftwareApplication",
    name: title,
    applicationCategory: projectType,
    description: description,
    author: {
      "@type": "Person",
      name: process.env.NEXT_PUBLIC_FULL_NAME || "Developer",
    },
  };

  const softwareDomain = process.env.NEXT_PUBLIC_SOFTWARE_DOMAIN;

  const breadcrumbJsonLd: WithContext<BreadcrumbList> = {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    itemListElement: [
      {
        "@type": "ListItem",
        position: 1,
        name: "Home",
        item: `https://${softwareDomain}`,
      },
      {
        "@type": "ListItem",
        position: 2,
        name: title,
      },
    ],
  };

  const hasLinks = liveUrl || repoUrl;

  const hasDedicatedGallery = gallery && gallery.length > 1;
  const coverImageSizeKB = coverImage?.size ?? 999;
  const isIcon = !hasDedicatedGallery && coverImageSizeKB < 20;
  const showGallery = !isIcon;

  const galleryImages = showGallery
    ? ((gallery && gallery.length > 0
        ? gallery.map((img) => getMediaUrl(img))
        : [getMediaUrl(coverImage)]
      ).filter(Boolean) as string[])
    : [];

  let formattedDate = null;
  if (developedAt) {
    const date = new Date(developedAt);
    formattedDate = format.dateTime(date, { year: "numeric", month: "long" });
  }

  return (
    <AlternateLinksProvider value={{ alternateSlugs }}>
      <div className="relative flex min-h-dvh flex-col bg-background">
        <SoftwareHeader showNavLinks={false} />
        <main className="flex-1">
          <article className="max-w-6xl mx-auto py-12 px-6">
            <script
              type="application/ld+json"
              dangerouslySetInnerHTML={{ __html: JSON.stringify(jsonLd) }}
            />
            <script
              type="application/ld+json"
              dangerouslySetInnerHTML={{
                __html: JSON.stringify(breadcrumbJsonLd),
              }}
            />
            <Button asChild variant="ghost" className="-ml-4 mb-8">
              <Link href="/">
                <ArrowLeft className="mr-2 h-4 w-4" />
                {t("back_button")}
              </Link>
            </Button>
            <header>
              <p className="text-sm font-semibold text-muted-foreground tracking-wider uppercase">
                {projectType}
              </p>
              <h1 className="mt-2 text-4xl md:text-5xl font-bold tracking-tight">
                {title}
              </h1>
            </header>

            {showGallery && (
              <div className="mt-8">
                <ProjectGallery
                  images={galleryImages}
                  altPrefix={title}
                  variant="inverted"
                />
              </div>
            )}

            <div className="grid grid-cols-1 md:grid-cols-3 gap-12 mt-16">
              <div className="md:col-span-2">
                <h2 className="text-2xl font-semibold border-b-2 border-foreground pb-2">
                  {t("about_title")}
                </h2>
                <div className="mt-4">
                  <LongTextRenderer content={longDescription as string | null | undefined} />
                </div>
              </div>

              <aside className="space-y-8 md:sticky md:top-24 md:self-start">
                <Card className="p-6 bg-foreground text-background">
                  <CardHeader className="p-0">
                    <CardTitle className="text-lg text-background">
                      {t("details_title")}
                    </CardTitle>
                  </CardHeader>
                  <CardContent className="p-0 mt-6 space-y-6">
                    {formattedDate && (
                      <div>
                        <h3 className="font-semibold text-sm mb-2">
                          {t("developed_in_label")}
                        </h3>
                        <p className="text-sm text-background/70">
                          {formattedDate}
                        </p>
                      </div>
                    )}
                    <div>
                      <h3 className="font-semibold text-sm mb-2">
                        {t("tech_title")}
                      </h3>
                      <div className="flex flex-wrap gap-2">
                        {(tags || []).map((tag) => {
                          const cleanTag = tag.trim().toLowerCase();
                          const techDetails = techDetailsMap[cleanTag];
                          const iconClassName = techDetails?.iconClassName;

                          if (techDetails?.url) {
                            return (
                              <a
                                key={tag}
                                href={techDetails.url}
                                target="_blank"
                                rel="noopener noreferrer"
                                className={cn(
                                  tagBaseClasses,
                                  "border-background text-background hover:bg-background hover:text-foreground"
                                )}
                              >
                                {iconClassName && (
                                  <i
                                    className={`${iconClassName} text-base mr-1.5`}
                                  ></i>
                                )}
                                <span>{tag}</span>
                              </a>
                            );
                          }

                          return (
                            <Badge
                              key={tag}
                              variant="outline"
                              className="gap-1.5 px-2 py-1 border-background/30 text-background hover:bg-background/10"
                            >
                              {iconClassName && (
                                <i className={`${iconClassName} text-base`}></i>
                              )}
                              <span>{tag}</span>
                            </Badge>
                          );
                        })}
                      </div>
                    </div>
                    {hasLinks && (
                      <div>
                        <h3 className="font-semibold text-sm mb-2">
                          {t("links_title")}
                        </h3>
                        <div className="flex flex-col gap-2">
                          {liveUrl && (
                            <Button asChild variant="inverted">
                              <a
                                href={liveUrl}
                                target="_blank"
                                rel="noopener noreferrer"
                              >
                                {t("live_demo_button")}
                                <ExternalLink className="ml-2 h-4 w-4" />
                              </a>
                            </Button>
                          )}
                          {repoUrl && (
                            <Button asChild variant="inverted">
                              <a
                                href={repoUrl}
                                target="_blank"
                                rel="noopener noreferrer"
                              >
                                <Github className="mr-2 h-4 w-4" />
                                {t("source_code_button")}
                              </a>
                            </Button>
                          )}
                        </div>
                      </div>
                    )}
                  </CardContent>
                </Card>
              </aside>
            </div>
          </article>
        </main>
        <Footer />
      </div>
    </AlternateLinksProvider>
  );
}
</file>

<file path="src/app/[locale]/resume/page.tsx">
import { Metadata } from "next";

import { useTranslations } from "next-intl";
import {
  Globe,
  Mail,
  MapPin,
  Phone,
  Linkedin,
  Github,
} from "lucide-react";
import { UtilityHeader } from "@/components/layout/UtilityHeader";
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar";
import { ResumeEntry } from "@/components/resume/ResumeItem";
import { PrintButton } from "@/components/resume/PrintButton";
import { ProficiencyBar } from "@/components/ProficiencyBar";
import resumeData from "@/data/resume.json";
import { ResumeData } from "@/types/resume";
import { ResumeAutoPrint } from "@/components/resume/ResumeAutoPrint";

const data = resumeData as unknown as ResumeData;
const avatarPath = "/images/profile.webp";

export async function generateMetadata(): Promise<Metadata> {
  return {
    title: `Resume - ${data.basics.name}`,
  };
}

export default function ResumePage() {
  const t = useTranslations("ResumePage");
  const { basics, sections } = data;

  // Get LinkedIn and GitHub profiles
  const linkedinProfile = sections.profiles?.items?.find(
    (profile) => profile.network?.toLowerCase() === "linkedin"
  );
  const githubProfile = sections.profiles?.items?.find(
    (profile) => profile.network?.toLowerCase() === "github"
  );

  return (
    // Outer page background remains dark (bg-background/90)
    <div className="min-h-screen bg-background/90 print:p-0 print:!bg-white print:min-h-0">
      <ResumeAutoPrint />
      <div className="print:hidden">
        <UtilityHeader />
      </div>
      
      <div className="py-12 print:py-0">
        {/* Floating Download Button - Hidden in Print */}
        <div className="fixed bottom-8 right-8 z-50 print:hidden">
          <PrintButton
            // Label for the download button
            label={t("downloadPdf")}
            filename={t("resumeFilename")}
          />
        </div>

      {/* Main Page Container (A4 sized card) */}
      <main
        className="w-auto md:w-[210mm] mx-4 md:mx-auto border-0 md:border-2 border-foreground p-0 md:p-6 shadow-xl print:!shadow-none print:border-0 print:p-0 rounded-xl overflow-hidden isolate bg-zinc-950 dark:bg-white print:!w-full print:min-h-screen print:rounded-none"
      >
        <div className="grid grid-cols-1 md:grid-cols-[300px_1fr] print:grid-cols-[300px_1fr] min-h-[297mm] print:min-h-0">
          {/* MOBILE HEADER: Visible only on mobile */}
          <div className="md:hidden p-8 pb-8 text-zinc-100 dark:text-zinc-900">
            <h1 className="text-5xl font-extrabold tracking-tight mb-2 mt-0 leading-none">
              {basics.name}
            </h1>
            <p className="text-xl font-medium opacity-80 whitespace-nowrap">
              {basics.headline}
            </p>
          </div>

          {/* LEFT COLUMN: Sidebar Container */}
          <aside className="print:p-0">
            {/* Floating Card Wrapper */}
            <div className="bg-white text-zinc-900 p-6 md:p-12 flex flex-col gap-8 print:!flex print:m-6 print:p-8 print:rounded-xl print:h-[calc(100%-3rem)] dark:bg-zinc-900 dark:text-zinc-100 h-full rounded-xl mx-8 md:mx-0">
            {/* 1. Personal Details (Avatar & Contact) */}
            <div className="flex flex-col items-center gap-8 md:gap-12">
              <Avatar
                // Avatar background set to white to fill the circle
                className="h-48 w-48 lg:h-56 lg:w-56 group transition-all duration-500 ease-in-out bg-zinc-900 border-4 border-zinc-900 shadow-sm dark:bg-white dark:border-white"
              >
                <AvatarImage
                  src={avatarPath}
                  alt="Profile picture of me"
                  className="object-cover object-top scale-[1.2] origin-bottom translate-y-4 transition-transform duration-500 ease-in-out"
                />
                <AvatarFallback>{basics.name[0]}</AvatarFallback>
              </Avatar>

              <section className="w-full">
                <h3 className="text-lg font-bold mb-3 uppercase tracking-wider text-primary border-b pb-1 border-zinc-200 dark:border-zinc-700">
                  {t("contact")}
                </h3>
              <div className="space-y-3 text-sm w-full text-left">
                {/* Contact Details: Text set to white/light for dark card */}
                <a
                  href={`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(
                    basics.location
                  )}`}
                  target="_blank"
                  className="flex items-center gap-2 text-zinc-900 hover:text-primary transition-colors justify-start dark:text-zinc-100 dark:hover:text-primary relative print:z-10 print:text-zinc-900"
                >
                  <MapPin className="h-4 w-4 shrink-0" />
                  <span>{basics.location}</span>
                </a>

                {basics.email && (
                  <a
                    href={`mailto:${basics.email}`}
                    className="flex items-center gap-2 text-zinc-900 hover:text-primary transition-colors justify-start dark:text-zinc-100 dark:hover:text-primary relative print:z-10 print:text-zinc-900"
                  >
                    <Mail className="h-4 w-4 shrink-0" />
                    <span className="tracking-tighter whitespace-nowrap">{basics.email}</span>
                  </a>
                )}

                {basics.phone && (
                  <a
                    href={`tel:${basics.phone.replace(/[\s()+-]/g, "")}`}
                    className="flex items-center gap-2 text-zinc-900 hover:text-primary transition-colors justify-start dark:text-zinc-100 dark:hover:text-primary relative print:z-10 print:text-zinc-900"
                  >
                    <Phone className="h-4 w-4 shrink-0" />
                    <span>{basics.phone}</span>
                  </a>
                )}

                {basics.url.href && (
                  <a
                    href={basics.url.href}
                    target="_blank"
                    className="flex items-center gap-2 text-zinc-900 hover:text-primary transition-colors justify-start dark:text-zinc-100 dark:hover:text-primary relative print:z-10 print:text-zinc-900"
                  >
                    <Globe className="h-4 w-4 shrink-0" />
                    <span>Portfolio</span>
                  </a>
                )}

                {linkedinProfile?.url?.href && (
                  <a
                    href={linkedinProfile.url.href}
                    target="_blank"
                    className="flex items-center gap-2 text-zinc-900 hover:text-primary transition-colors justify-start dark:text-zinc-100 dark:hover:text-primary relative print:z-10 print:text-zinc-900"
                  >
                    <Linkedin className="h-4 w-4 shrink-0" />
                    <span>LinkedIn</span>
                  </a>
                )}

                {githubProfile?.url?.href && (
                  <a
                    href={githubProfile.url.href}
                    target="_blank"
                    className="flex items-center gap-2 text-zinc-900 hover:text-primary transition-colors justify-start dark:text-zinc-100 dark:hover:text-primary relative print:z-10 print:text-zinc-900"
                  >
                    <Github className="h-4 w-4 shrink-0" />
                    <span>GitHub</span>
                  </a>
                )}
              </div>
              </section>
            </div>

            {/* 2. Skills */}
            <section>
              <h3 className="text-lg font-bold mb-3 uppercase tracking-wider text-primary border-b pb-1 border-zinc-200 dark:border-zinc-700">
                {t("skills")}
              </h3>
              <div className="flex flex-col gap-4">
                {data.sections.skills.items.map((skill) => (
                  <div key={skill.id}>
                    <div className="flex items-center justify-between">
                      <h4 className="font-semibold text-sm text-zinc-900 dark:text-zinc-100">
                        {skill.name}
                      </h4>
                      {skill.level !== undefined && (
                        <ProficiencyBar
                          level={skill.level}
                          className="bg-zinc-200 [&>div]:bg-zinc-900 dark:bg-white/20 dark:[&>div]:bg-white"
                        />
                      )}
                    </div>
                  </div>
                ))}
              </div>
            </section>

            {/* 3. Languages */}
            <section>
              <h3 className="text-lg font-bold mb-3 uppercase tracking-wider text-primary border-b pb-1 border-zinc-200 dark:border-zinc-700">
                {t("languages")}
              </h3>
              <div className="flex flex-col gap-4">
                {data.sections.languages.items.map((lang) => (
                  <div key={lang.id}>
                    <div className="flex items-center justify-between">
                      <div className="font-medium text-zinc-900 dark:text-zinc-100">{lang.name}</div>
                      {lang.level !== undefined && (
                        <ProficiencyBar
                          level={lang.level}
                          className="bg-zinc-200 [&>div]:bg-zinc-900 dark:bg-white/20 dark:[&>div]:bg-white"
                        />
                      )}
                    </div>
                  </div>
                ))}
              </div>
            </section>
            </div>
          </aside>

          {/* RIGHT COLUMN: Main Content (White Background) */}
          <div
            className="bg-zinc-950 px-8 pb-8 pt-8 md:px-12 md:pb-12 md:pt-12 print:px-8 print:pb-8 print:pt-6 dark:bg-white text-zinc-100 dark:text-zinc-900 h-full rounded-xl"
          >
            {/* Header: Name & Headline - Hidden on Mobile */}
            <div className="mb-2 hidden md:block print:block">
              {/* Text uses explicit dark colors for white background */}
              <h1 className="text-5xl font-extrabold tracking-tight mb-2 mt-0 leading-none">
                {basics.name}
              </h1>
              <p className="text-xl font-medium opacity-80 whitespace-nowrap">
                {basics.headline}
              </p>
            </div>

            {/* Experience */}
            <section className="mb-2">
              <h2 className="text-xl font-bold mb-3 uppercase tracking-wider border-b pb-1 border-zinc-200 dark:border-zinc-700 max-w-md">
                {t("experience")}
              </h2>
              <div className="space-y-4">
                {data.sections.experience.items.map((item) => (
                  <ResumeEntry key={item.id} item={item} type="work" />
                ))}
              </div>
            </section>

            {/* Education */}
            <section>
              <h2 className="text-xl font-bold mb-3 uppercase tracking-wider border-b pb-1 border-zinc-200 dark:border-zinc-700 max-w-md">
                {t("education")}
              </h2>
              <div className="space-y-4">
                {data.sections.education.items.map((item) => (
                  <ResumeEntry key={item.id} item={item} type="education" />
                ))}
              </div>
            </section>
          </div>
          {/* End of RIGHT COLUMN */}
        </div>
        {/* End of Grid Div */}
      </main>
      </div>
      {/* End of Main Card Container */}
    </div>
  );
}
</file>

<file path="src/app/robots.ts">
import { MetadataRoute } from "next";

export default function robots(): MetadataRoute.Robots {
  const softwareDomain = process.env.NEXT_PUBLIC_SOFTWARE_DOMAIN || "";

  return {
    rules: [
      {
        userAgent: "*",
        allow: "/",
      },
    ],
    sitemap: [`https://${softwareDomain}/sitemap.xml`],
  };
}
</file>

<file path="src/components/layout/ThemeToggle.tsx">
"use client";

import * as React from "react";
import { Moon, Sun } from "lucide-react";
import { useTheme } from "next-themes";
import { Button } from "@/components/ui/button";

export function ThemeToggle() {
  const { theme, setTheme } = useTheme();

  const toggleTheme = () => {
    setTheme(theme === "dark" ? "light" : "dark");
  };

  return (
    // --- THIS IS THE FIX ---
    // Change variant="outline" to variant="ghost"
    <Button variant="ghost" size="icon" onClick={toggleTheme}>
      <Sun className="h-[1.2rem] w-[1.2rem] rotate-0 scale-100 transition-all dark:-rotate-90 dark:scale-0" />
      <Moon className="absolute h-[1.2rem] w-[1.2rem] rotate-90 scale-0 transition-all dark:rotate-0 dark:scale-100" />
      <span className="sr-only">Toggle theme</span>
    </Button>
  );
}
</file>

<file path="src/components/sections/SkillsGrid.tsx">
// src/components/sections/software/SkillsGrid.tsx
"use client";

import { motion } from "framer-motion";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { SkillIcon } from "@/components/SkillIcon";
import { Separator } from "@/components/ui/separator";
import { ProficiencyBar } from "@/components/ProficiencyBar";

// --- Interfaces remain the same ---
interface Skill {
  name: string;
  iconClassName: string | null;
  level: number;
  url: string;
  svgIcon?: { url: string; alternativeText?: string } | null;
}
interface SkillCategory {
  category: string;
  skills: Skill[];
}
interface SkillsGridProps {
  skills: SkillCategory[];
}

export function SkillsGrid({ skills }: SkillsGridProps) {
  if (!skills || skills.length === 0) {
    return (
      <p className="text-center text-muted-foreground">
        No skills are currently available.
      </p>
    );
  }

  return (
    <div className="flex flex-wrap justify-center gap-8">
      {skills.map((category: SkillCategory) => (
        <div
          key={category.category}
          className="w-full sm:w-[calc(50%-1rem)] lg:w-[calc(33.333%-1.34rem)] xl:w-[calc(20%-1.6rem)]"
        >
          <Card className="h-full border-0 shadow-none bg-transparent hover:shadow-none flex flex-col items-center">
            <CardHeader className="flex justify-center items-center px-6 pt-6 pb-3">
              <CardTitle className="text-2xl text-center transition-colors duration-300 group-data-[active=true]:text-background">
                {category.category}
              </CardTitle>
            </CardHeader>
            <Separator className="w-2/4 mx-auto group-data-[active=true]:bg-background/20" />
            <CardContent className="w-full p-4 pt-3 flex justify-center">
              {/* --- FIX 1: Add gap-2, remove at xl --- */}
              <div className="inline-grid grid-cols-2 gap-2 xl:gap-0">
                {category.skills.map((skill: Skill) => (
                  <div
                    key={skill.name}
                    /* --- FIX 2: Remove fixed h-16 w-16 --- */
                    className="relative group/skill flex items-center justify-center 
                               xl:h-16 xl:w-16"
                  >
                    <motion.a
                      href={skill.url}
                      target="_blank"
                      rel="noopener noreferrer"
                      layout
                      transition={{
                        layout: {
                          type: "spring",
                          stiffness: 260,
                          damping: 15,
                          mass: 0.5,
                        },
                      }}
                      /* --- FIX 3: Add w-full, but size to xl --- */
                      className="flex h-full w-full cursor-pointer items-center justify-center rounded-lg p-2 transition-colors duration-200 
                                 hover:bg-foreground group-data-[active=true]:hover:bg-background
                                 xl:h-16 xl:w-16 xl:p-0 xl:hover:bg-transparent xl:group-data-[active=true]:hover:bg-transparent
                                 xl:group-hover/skill:absolute xl:group-hover/skill:z-10 xl:group-hover/skill:h-auto xl:group-hover/skill:w-auto 
                                 xl:group-hover/skill:p-3 xl:group-hover/skill:shadow-lg
                                 xl:group-hover/skill:bg-foreground xl:group-data-[active=true]:group-hover/skill:bg-background"
                    >
                      <div className="flex w-full flex-col items-center gap-1.5">
                        <SkillIcon
                          iconClassName={skill.iconClassName}
                          svgIconUrl={skill.svgIcon?.url}
                          altText={skill.name}
                          className="h-8 w-8 flex shrink-0 items-center justify-center text-2xl text-foreground transition-colors duration-200 
                                     group-hover/skill:text-background
                                     group-data-[active=true]:text-background 
                                     group-data-[active=true]:group-hover/skill:text-foreground
                                     xl:group-hover/skill:text-background 
                                     group-data-[active=true]:xl:group-hover/skill:text-foreground 
                                     [&>svg]:h-7 [&>svg]:w-7"
                        />
                        <div
                          className="flex w-full flex-col items-center gap-1
                                        xl:hidden xl:group-hover/skill:flex"
                        >
                          <span
                            /* --- FIX 4: Allow text to wrap --- */
                            className="whitespace-normal block text-center text-xs font-semibold text-foreground 
                                       group-data-[active=true]:text-background
                                       group-hover/skill:text-background
                                       group-data-[active=true]:group-hover/skill:text-foreground
                                       xl:whitespace-nowrap xl:text-background 
                                       xl:group-data-[active=true]:text-foreground"
                          >
                            {skill.name}
                          </span>
                          <ProficiencyBar level={skill.level} />
                        </div>
                      </div>
                    </motion.a>
                  </div>
                ))}
              </div>
            </CardContent>
          </Card>
        </div>
      ))}
    </div>
  );
}
</file>

<file path="src/components/ui/avatar.tsx">
"use client";

import * as React from "react";
import * as AvatarPrimitive from "@radix-ui/react-avatar";
import { User } from "lucide-react"; // 1. Import the icon

import { cn } from "@/lib/utils";

const Avatar = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Root
    ref={ref}
    className={cn(
      "relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",
      className
    )}
    {...props}
  />
));
Avatar.displayName = AvatarPrimitive.Root.displayName;

const AvatarImage = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Image>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Image
    ref={ref}
    className={cn("aspect-square h-full w-full", className)}
    {...props}
  />
));
AvatarImage.displayName = AvatarPrimitive.Image.displayName;

// --- THIS IS THE DEFINITIVE FIX ---
const AvatarFallback = React.forwardRef<
  React.ElementRef<typeof AvatarPrimitive.Fallback>,
  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>
>(({ className, ...props }, ref) => (
  <AvatarPrimitive.Fallback
    ref={ref}
    className={cn(
      // 2. Set the background to the main page background color
      //    and the icon color to the main page text color.
      "flex h-full w-full items-center justify-center rounded-full bg-background text-foreground",
      className
    )}
    {...props}
  >
    {/* 3. Add the User icon, sized proportionally */}
    <User className="h-3/5 w-3/5" />
  </AvatarPrimitive.Fallback>
));
AvatarFallback.displayName = AvatarPrimitive.Fallback.displayName;

export { Avatar, AvatarImage, AvatarFallback };
</file>

<file path="src/components/ui/button.tsx">
import * as React from "react";
import { Slot } from "@radix-ui/react-slot";
import { cva, type VariantProps } from "class-variance-authority";

import { cn } from "@/lib/utils";

const buttonVariants = cva(
  "inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-semibold ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",
  {
    variants: {
      variant: {
        default:
          "border-2 border-foreground bg-transparent text-foreground shadow-sm hover:bg-foreground hover:text-background",
        // --- THIS IS THE NEW VARIANT ---
        inverted:
          "border-2 border-background bg-transparent text-background shadow-sm hover:bg-background hover:text-foreground",
        // ---------------------------------
        destructive:
          "bg-destructive text-destructive-foreground hover:bg-destructive/90",
        outline:
          "border border-input bg-background hover:bg-accent hover:text-accent-foreground",
        secondary:
          "border border-foreground/50 bg-transparent text-foreground/80 hover:bg-foreground/10",
        ghost: "hover:bg-accent hover:text-accent-foreground",
        link: "text-primary underline-offset-4 hover:underline",
      },
      size: {
        default: "h-9 px-4 py-2 has-[>svg]:px-3",
        sm: "h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",
        lg: "h-10 rounded-md px-6 has-[>svg]:px-4",
        icon: "size-9",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
);

function Button({
  className,
  variant,
  size,
  asChild = false,
  ...props
}: React.ComponentProps<"button"> &
  VariantProps<typeof buttonVariants> & {
    asChild?: boolean;
  }) {
  const Comp = asChild ? Slot : "button";

  return (
    <Comp
      data-slot="button"
      className={cn(buttonVariants({ variant, size, className }))}
      {...props}
    />
  );
}

export { Button, buttonVariants };
</file>

<file path="src/components/ui/radio-group.tsx">
// src/components/ui/radio-group.tsx
"use client";

import * as React from "react";
import * as RadioGroupPrimitive from "@radix-ui/react-radio-group";
import { Circle } from "lucide-react";

import { cn } from "@/lib/utils";

const RadioGroup = React.forwardRef<
  React.ElementRef<typeof RadioGroupPrimitive.Root>,
  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>
>(({ className, ...props }, ref) => {
  return (
    <RadioGroupPrimitive.Root
      className={cn("grid gap-2", className)}
      {...props}
      ref={ref}
    />
  );
});
RadioGroup.displayName = RadioGroupPrimitive.Root.displayName;

const RadioGroupItem = React.forwardRef<
  React.ElementRef<typeof RadioGroupPrimitive.Item>,
  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>
>(({ className, ...props }, ref) => {
  return (
    <RadioGroupPrimitive.Item
      ref={ref}
      className={cn(
        "aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",
        className
      )}
      {...props}
    >
      <RadioGroupPrimitive.Indicator className="flex items-center justify-center">
        <Circle className="h-2.5 w-2.5 fill-current text-current" />
      </RadioGroupPrimitive.Indicator>
    </RadioGroupPrimitive.Item>
  );
});
RadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName;

export { RadioGroup, RadioGroupItem };
</file>

<file path="src/components/ui/sheet.tsx">
"use client";

import * as React from "react";
import * as SheetPrimitive from "@radix-ui/react-dialog";
import { cva, type VariantProps } from "class-variance-authority";
import { X } from "lucide-react";

import { cn } from "@/lib/utils";

const Sheet = SheetPrimitive.Root;
const SheetTrigger = SheetPrimitive.Trigger;
const SheetClose = SheetPrimitive.Close;
const SheetPortal = SheetPrimitive.Portal;
const SheetOverlay = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Overlay
    className={cn(
      "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    )}
    {...props}
    ref={ref}
  />
));
SheetOverlay.displayName = SheetPrimitive.Overlay.displayName;

const sheetVariants = cva(
  "fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500 data-[state=open]:animate-in data-[state=closed]:animate-out",
  {
    variants: {
      side: {
        top: "inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",
        bottom:
          "inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",
        left: "inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",
        right:
          "inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm",
      },
    },
    defaultVariants: {
      side: "right",
    },
  }
);

// --- THIS IS THE FIX (PART 1) ---
// Add the new prop to the interface
interface SheetContentProps
  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,
    VariantProps<typeof sheetVariants> {
  showCloseButton?: boolean;
}

const SheetContent = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Content>,
  SheetContentProps
>(
  (
    { side = "right", className, children, showCloseButton = true, ...props },
    ref
  ) => (
    <SheetPortal>
      <SheetOverlay />
      <SheetPrimitive.Content
        ref={ref}
        className={cn(sheetVariants({ side }), className)}
        {...props}
      >
        {children}
        {/* Conditionally render the default close button */}
        {showCloseButton && (
          <SheetPrimitive.Close className="absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary">
            <X className="h-4 w-4" />
            <span className="sr-only">Close</span>
          </SheetPrimitive.Close>
        )}
      </SheetPrimitive.Content>
    </SheetPortal>
  )
);
SheetContent.displayName = SheetPrimitive.Content.displayName;

const SheetHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col space-y-2 text-center sm:text-left",
      className
    )}
    {...props}
  />
);
SheetHeader.displayName = "SheetHeader";

const SheetFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
      className
    )}
    {...props}
  />
);
SheetFooter.displayName = "SheetFooter";

const SheetTitle = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Title
    ref={ref}
    className={cn("text-lg font-semibold text-foreground", className)}
    {...props}
  />
));
SheetTitle.displayName = SheetPrimitive.Title.displayName;

const SheetDescription = React.forwardRef<
  React.ElementRef<typeof SheetPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>
>(({ className, ...props }, ref) => (
  <SheetPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
));
SheetDescription.displayName = SheetPrimitive.Description.displayName;

export {
  Sheet,
  SheetPortal,
  SheetOverlay,
  SheetTrigger,
  SheetClose,
  SheetContent,
  SheetHeader,
  SheetFooter,
  SheetTitle,
  SheetDescription,
};
</file>

<file path="src/components/ui/visually-hidden.tsx">
// File: frontend/src/components/ui/visually-hidden.tsx
import * as VisuallyHiddenPrimitive from "@radix-ui/react-visually-hidden";

const VisuallyHidden = VisuallyHiddenPrimitive.Root;

export { VisuallyHidden };
</file>

<file path="src/components/ProficiencyBar.tsx">
// src/components/ProficiencyBar.tsx
"use client";

import { cn } from "@/lib/utils";

interface ProficiencyBarProps {
  level: number;
  maxLevel?: number;
  className?: string;
}

export function ProficiencyBar({
  level,
  maxLevel = 5,
  className,
}: ProficiencyBarProps) {
  const percentage = (level / maxLevel) * 100;

  return (
    <div
      className={cn(
        "h-1.5 w-16 rounded-full transition-colors duration-200",
        // --- THIS IS THE FIX (Track) ---
        // Default State
        "bg-foreground/20",
        // Active State
        "group-data-[active=true]:bg-background/30",
        // Default + Hover State
        "group-hover/skill:bg-background/20",
        // Active + Hover State
        "group-data-[active=true]:group-hover/skill:bg-foreground/30",
        // -----------------------------
        className
      )}
      aria-label={`Proficiency: ${level} out of ${maxLevel}`}
    >
      <div
        className={cn(
          "h-full rounded-full transition-colors duration-200",
          // --- THIS IS THE FIX (Fill) ---
          // Default State
          "bg-foreground",
          // Active State
          "group-data-[active=true]:bg-background",
          // Default + Hover State
          "group-hover/skill:bg-background",
          // Active + Hover State
          "group-data-[active=true]:group-hover/skill:bg-foreground"
          // ----------------------------
        )}
        style={{ width: `${percentage}%` }}
      />
    </div>
  );
}
</file>

<file path="src/context/AlternateLinksProvider.tsx">
"use client";

import { createContext, useContext, ReactNode } from "react";

type AlternateLinksContextType = {
  alternateSlugs: Record<string, string> | null;
};

const AlternateLinksContext = createContext<AlternateLinksContextType>({
  alternateSlugs: null,
});

export function useAlternateLinks() {
  return useContext(AlternateLinksContext);
}

export function AlternateLinksProvider({
  children,
  value,
}: {
  children: ReactNode;
  value: AlternateLinksContextType;
}) {
  return (
    <AlternateLinksContext.Provider value={value}>
      {children}
    </AlternateLinksContext.Provider>
  );
}
</file>

<file path="src/i18n/routing.ts">
import { defineRouting } from "next-intl/routing";

export const routing = defineRouting({
  locales: ["en", "de"] as const,
  defaultLocale: "en",

  // --- THIS IS THE FIX ---
  // Change 'never' to 'as-needed'.
  // This will use "/" for 'en' (default) and "/de" for 'de'.
  localePrefix: "as-needed",
});

export type Locale = (typeof routing.locales)[number];

export function isValidLocale(value: string): value is Locale {
  return (routing.locales as readonly string[]).includes(value);
}
</file>

<file path=".env.example">
# =================================================================
# == Environment Variables Template for Personal Portfolio       ==
# =================================================================
#
# INSTRUCTIONS:
# 1. Copy this file and rename it to `.env.local`
# 2. Fill in your own values for each variable below.
# 3. Restart your development server for the changes to take effect.
#
# NOTE: The .env.local file is ignored by Git and should NEVER be committed.

# --- Backend API ---
# The full URL to your Strapi backend.
# For local development, this is typically http://localhost:1337
NEXT_PUBLIC_STRAPI_API_URL="http://localhost:1337"


# --- Personal Information (for Imprint & Privacy Policy) ---
NEXT_PUBLIC_FULL_NAME="Your Full Name"
NEXT_PUBLIC_EMAIL_ADDRESS="your.email@example.com"
NEXT_PUBLIC_PHONE_NUMBER="[Your Phone Number (optional)]"
NEXT_PUBLIC_STREET_ADDRESS="Your Street 123"
NEXT_PUBLIC_CITY_ADDRESS="12345 Your City"


# --- Social Media Usernames ---
# Just the username, not the full URL.
NEXT_PUBLIC_GITHUB_USERNAME="your-github-username"
NEXT_PUBLIC_LINKEDIN_USERNAME="your-linkedin-username"
NEXT_PUBLIC_INSTAGRAM_USERNAME="your-instagram-username"


# --- External Service IDs ---
# The unique ID from your Formspree form URL (the part after /f/).
NEXT_PUBLIC_FORMSPREE_ID="your_formspree_id"

# --- Domain Configuration (for SEO and Production Links) ---
# Your subdomain for the software portfolio.
NEXT_PUBLIC_SOFTWARE_DOMAIN="code.your-domain.com"
</file>

<file path="eslint.config.mjs">
import { dirname } from "path";
import { fileURLToPath } from "url";
import { FlatCompat } from "@eslint/eslintrc";

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

const compat = new FlatCompat({
  baseDirectory: __dirname,
});

const eslintConfig = [
  ...compat.extends("next/core-web-vitals", "next/typescript"),
  {
    ignores: [
      "node_modules/**",
      ".next/**",
      "out/**",
      "build/**",
      "next-env.d.ts",
    ],
  },
];

export default eslintConfig;
</file>

<file path="i18n.ts">
import { notFound } from "next/navigation";
import { getRequestConfig } from "next-intl/server";

const locales = ["en", "de"];

export default getRequestConfig(async ({ locale }) => {
  const baseLocale = locale as any;
  if (!locales.includes(baseLocale)) {
    notFound();
  }
  return {
    locale: baseLocale,
    messages: {
      ...(await import(`./messages/${baseLocale}/common.json`)).default,
      software: (await import(`./messages/${baseLocale}/software.json`))
        .default,
    },
  };
});
</file>

<file path="tailwind.config.js">
// tailwind.config.js

/** @type {import('tailwindcss').Config} */
module.exports = {
  darkMode: ["class"],
  content: [
    "./pages/**/*.{ts,tsx}",
    "./components/**/*.{ts,tsx}",
    "./app/**/*.{ts,tsx}",
    "./src/**/*.{ts,tsx}",
  ],
  theme: {
    container: {
      center: true,
      padding: "2rem",
      screens: {
        "2xl": "1400px",
      },
    },
    extend: {
      colors: {
        border: "hsl(var(--border))",
        input: "hsl(var(--input))",
        ring: "hsl(var(--ring))",
        background: "hsl(var(--background))",
        foreground: "hsl(var(--foreground))",
        primary: {
          DEFAULT: "hsl(var(--primary))",
          foreground: "hsl(var(--primary-foreground))",
        },
        secondary: {
          DEFAULT: "hsl(var(--secondary))",
          foreground: "hsl(var(--secondary-foreground))",
        },
        muted: {
          DEFAULT: "hsl(var(--muted))",
          foreground: "hsl(var(--muted-foreground))",
        },
        accent: {
          DEFAULT: "hsl(var(--accent))",
          foreground: "hsl(var(--accent-foreground))",
        },
        destructive: {
          DEFAULT: "hsl(var(--destructive))",
          foreground: "hsl(var(--destructive-foreground))",
        },
        card: {
          DEFAULT: "hsl(var(--card))",
          foreground: "hsl(var(--card-foreground))",
        },
        popover: {
          DEFAULT: "hsl(var(--popover))",
          foreground: "hsl(var(--popover-foreground))",
        },
      },
      borderRadius: {
        lg: "var(--radius)",
        md: "calc(var(--radius) - 2px)",
        sm: "calc(var(--radius) - 4px)",
      },
      keyframes: {
        "accordion-down": {
          from: { height: "0" },
          to: { height: "var(--radix-accordion-content-height)" },
        },
        "accordion-up": {
          from: { height: "var(--radix-accordion-content-height)" },
          to: { height: "0" },
        },
      },
      animation: {
        "accordion-down": "accordion-down 0.2s ease-out",
        "accordion-up": "accordion-up 0.2s ease-out",
      },
    },
  },
  plugins: [require("tailwindcss-animate"), require("@tailwindcss/typography")],
};
</file>

<file path="tsconfig.json">
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./src/*"],
      "@payload-config": ["./payload.config.ts"]
    }
  },
  "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
  "exclude": ["node_modules", "strapi"]
}
</file>

<file path="src/components/layout/MobileHeader.tsx">
"use client";

import React from "react";
import {
  Sheet,
  SheetContent,
  SheetClose,
  SheetTrigger,
  SheetHeader,
  SheetTitle,
} from "@/components/ui/sheet";
import { VisuallyHidden } from "@/components/ui/visually-hidden";
import { Button } from "@/components/ui/button";
import { Menu, X } from "lucide-react";

interface NavLink {
  href: string;
  label: string;
}

interface MobileNavProps {
  navLinks?: NavLink[];
  children: React.ReactNode;
}

export function MobileNav({ navLinks, children }: MobileNavProps) {
  return (
    <Sheet>
      <SheetTrigger asChild>
        <Button variant="ghost" size="icon" className="md:hidden">
          <Menu className="h-6 w-6" />
          <span className="sr-only">Open navigation menu</span>
        </Button>
      </SheetTrigger>
      <SheetContent side="right" showCloseButton={false}>
        <VisuallyHidden asChild>
          <SheetHeader>
            <SheetTitle>Mobile Navigation Menu</SheetTitle>
          </SheetHeader>
        </VisuallyHidden>
        <div className="flex h-full flex-col justify-end items-end p-0">
          <SheetClose asChild>
            <Button
              variant="ghost"
              size="icon"
              className="absolute top-4 right-4"
              aria-label="Close menu"
            >
              <X className="h-6 w-6" />
            </Button>
          </SheetClose>
          <div className="flex flex-col items-end gap-8">
            {navLinks && navLinks.length > 0 && (
              <nav className="grid gap-6 text-lg font-medium text-right">
                {navLinks.map((link) => (
                  <SheetClose asChild key={link.href}>
                    <a
                      href={link.href}
                      className="text-muted-foreground transition-colors hover:text-foreground"
                    >
                      {link.label}
                    </a>
                  </SheetClose>
                ))}
              </nav>
            )}

            <div className="flex items-center gap-2">{children}</div>
          </div>
        </div>
      </SheetContent>
    </Sheet>
  );
}
</file>

<file path="src/components/layout/UtilityHeader.tsx">
"use client";

import { ThemeToggle } from "./ThemeToggle";
import { LanguageToggle } from "./LanguageToggle";
import { Link } from "@/i18n/navigation";
import { Terminal } from "lucide-react";

export function UtilityHeader() {
  return (
    <header className="sticky top-0 z-50 w-full border-b bg-background">
      <nav className="container mx-auto flex h-14 items-center justify-between">
        <Link
          href="/"
          aria-label="ZurÃ¼ck zur Startseite"
          className="transition-opacity hover:opacity-80"
        >
          <Terminal className="h-6 w-6" />
        </Link>
        <div className="flex items-center gap-2">
          <LanguageToggle />
          <ThemeToggle />
        </div>
      </nav>
    </header>
  );
}
</file>

<file path="src/components/ui/BackToTopButton.tsx">
// src/components/ui/BackToTopButton.tsx
"use client";

import { useEffect, useState } from "react";
import { motion, AnimatePresence } from "framer-motion";
import { ArrowUp } from "lucide-react";

export function BackToTopButton() {
  const [isVisible, setIsVisible] = useState(false);

  const scrollToTop = () => {
    window.scrollTo({
      top: 0,
      behavior: "smooth",
    });
  };

  useEffect(() => {
    const toggleVisibility = () => {
      const totalPageHeight = document.documentElement.scrollHeight;
      const currentScrollBottom = window.pageYOffset + window.innerHeight;
      const bottomThreshold = 300;
      if (currentScrollBottom >= totalPageHeight - bottomThreshold) {
        setIsVisible(true);
      } else {
        setIsVisible(false);
      }
    };

    window.addEventListener("scroll", toggleVisibility);
    toggleVisibility(); // Check visibility on initial load

    return () => {
      window.removeEventListener("scroll", toggleVisibility);
    };
  }, []);

  return (
    <AnimatePresence>
      {isVisible && (
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          exit={{ opacity: 0, y: 20 }}
          transition={{ duration: 0.3 }}
          className="fixed bottom-6 left-1/2 -translate-x-1/2 z-50"
        >
          <button
            onClick={scrollToTop}
            aria-label="Back to Top"
            className="flex justify-center"
          >
            <motion.div
              className="rounded-full border border-muted-foreground/50 p-1.5 transition-colors hover:border-muted-foreground"
              animate={{ y: [0, 6, 0] }} // Bouncing animation
              transition={{
                duration: 2,
                repeat: Infinity,
                repeatType: "loop",
                ease: "easeInOut",
              }}
            >
              <ArrowUp className="h-5 w-5 text-muted-foreground" />
            </motion.div>
          </button>
        </motion.div>
      )}
    </AnimatePresence>
  );
}
</file>

<file path="src/components/ui/dialog.tsx">
"use client";

import * as React from "react";
import * as DialogPrimitive from "@radix-ui/react-dialog";
import { X } from "lucide-react";

import { cn } from "@/lib/utils";

const Dialog = DialogPrimitive.Root;
const DialogTrigger = DialogPrimitive.Trigger;
const DialogPortal = DialogPrimitive.Portal;
const DialogClose = DialogPrimitive.Close;

const DialogOverlay = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Overlay>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Overlay
    ref={ref}
    className={cn(
      "fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
      className
    )}
    {...props}
  />
));
DialogOverlay.displayName = DialogPrimitive.Overlay.displayName;

interface DialogContentProps
  extends React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content> {
  showCloseButton?: boolean;
}

const DialogContent = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Content>,
  DialogContentProps
>(({ className, children, showCloseButton = true, ...props }, ref) => (
  <DialogPortal>
    <DialogOverlay />
    <DialogPrimitive.Content
      ref={ref}
      className={cn(
        "fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",
        className
      )}
      {...props}
    >
      {children}
      {showCloseButton && (
        <DialogPrimitive.Close className="absolute right-4 top-4 flex h-8 w-8 items-center justify-center rounded-md opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary">
          <X className="h-6 w-6" />
          <span className="sr-only">Close</span>
        </DialogPrimitive.Close>
      )}
    </DialogPrimitive.Content>
  </DialogPortal>
));

DialogContent.displayName = DialogPrimitive.Content.displayName;

// ... (rest of the file remains the same)
const DialogHeader = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col space-y-1.5 text-center sm:text-left",
      className
    )}
    {...props}
  />
);
DialogHeader.displayName = "DialogHeader";

const DialogFooter = ({
  className,
  ...props
}: React.HTMLAttributes<HTMLDivElement>) => (
  <div
    className={cn(
      "flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",
      className
    )}
    {...props}
  />
);
DialogFooter.displayName = "DialogFooter";

const DialogTitle = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Title>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Title
    ref={ref}
    className={cn(
      "text-lg font-semibold leading-none tracking-tight",
      className
    )}
    {...props}
  />
));
DialogTitle.displayName = DialogPrimitive.Title.displayName;

const DialogDescription = React.forwardRef<
  React.ElementRef<typeof DialogPrimitive.Description>,
  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>
>(({ className, ...props }, ref) => (
  <DialogPrimitive.Description
    ref={ref}
    className={cn("text-sm text-muted-foreground", className)}
    {...props}
  />
));
DialogDescription.displayName = DialogPrimitive.Description.displayName;

export {
  Dialog,
  DialogTrigger,
  DialogContent,
  DialogHeader,
  DialogFooter,
  DialogTitle,
  DialogDescription,
  DialogPortal,
  DialogOverlay,
  DialogClose,
};
</file>

<file path="src/components/AnimatedGreeting.tsx">
"use client";

import { motion, useMotionValue, useTransform, animate } from "framer-motion";
import { useEffect } from "react";
import { useTranslations } from "next-intl";

export function AnimatedGreeting() {
  const t = useTranslations("software.SoftwareHeroSection");

  const fullName = process.env.NEXT_PUBLIC_FULL_NAME || "";
  const firstName = fullName.split(" ")[0];
  const greetingText = t("greeting", { name: firstName });

  const count = useMotionValue(0);
  const rounded = useTransform(count, (latest) => Math.round(latest));
  const displayText = useTransform(rounded, (latest) =>
    greetingText.slice(0, latest)
  );

  useEffect(() => {
    const controls = animate(count, greetingText.length, {
      type: "tween",
      duration: 2.5,
      ease: "linear",
      delay: 0.5,
    });
    return controls.stop;
  }, [greetingText.length, count]);

  return (
    <h1 className="text-4xl font-bold tracking-tight lg:text-6xl font-mono">
      <motion.span>{displayText}</motion.span>

      {/* --- THE FIX IS HERE --- */}
      <motion.div
        className="ml-1 inline-block h-10 w-4 bg-foreground align-bottom"
        // We use a keyframes array for opacity and times to control the blink
        animate={{ opacity: [1, 1, 0, 0, 1] }}
        transition={{
          duration: 1.2,
          repeat: Infinity,
          times: [0, 0.5, 0.5, 1, 1], // Stays visible for 50%, invisible for 50%
        }}
      />
    </h1>
  );
}
</file>

<file path="src/components/GalleryLightbox.tsx">
"use client";

import { useState, useEffect, useCallback } from "react";
import {
  Dialog,
  DialogContent,
  DialogTrigger,
  DialogTitle,
  DialogClose,
} from "@/components/ui/dialog";
import { VisuallyHidden } from "@/components/ui/visually-hidden";
import Image from "next/image";
import { Button } from "@/components/ui/button";
import { ArrowLeft, ArrowRight, X } from "lucide-react";
import { useTranslations } from "next-intl"; // Import the hook

interface Album {
  images: string[];
  title: string;
}

interface GalleryLightboxProps {
  allAlbums: Album[];
  startAlbumIndex?: number;
  startPhotoIndex?: number;
  children: React.ReactNode;
}

export function GalleryLightbox({
  allAlbums,
  startAlbumIndex = 0,
  startPhotoIndex = 0,
  children,
}: GalleryLightboxProps) {
  // --- DEFINITIVE FIX: Use the common namespace ---
  const t = useTranslations("GalleryLightbox");

  const [currentAlbumIndex, setCurrentAlbumIndex] = useState(startAlbumIndex);
  const [currentPhotoIndex, setCurrentPhotoIndex] = useState(startPhotoIndex);
  const [isOpen, setIsOpen] = useState(false);

  const currentAlbum = allAlbums[currentAlbumIndex];
  const currentImage = currentAlbum.images[currentPhotoIndex];

  const goToNext = useCallback(() => {
    const isLastPhotoInAlbum =
      currentPhotoIndex >= currentAlbum.images.length - 1;
    const isLastAlbum = currentAlbumIndex >= allAlbums.length - 1;

    if (!isLastPhotoInAlbum) {
      setCurrentPhotoIndex((prev) => prev + 1);
    } else if (!isLastAlbum) {
      setCurrentAlbumIndex((prev) => prev + 1);
      setCurrentPhotoIndex(0);
    } else {
      setCurrentAlbumIndex(0);
      setCurrentPhotoIndex(0);
    }
  }, [
    currentAlbumIndex,
    currentPhotoIndex,
    allAlbums,
    currentAlbum.images.length,
  ]);

  const goToPrevious = useCallback(() => {
    const isFirstPhotoInAlbum = currentPhotoIndex === 0;
    const isFirstAlbum = currentAlbumIndex === 0;

    if (!isFirstPhotoInAlbum) {
      setCurrentPhotoIndex((prev) => prev - 1);
    } else if (!isFirstAlbum) {
      const prevAlbumIndex = currentAlbumIndex - 1;
      const prevAlbum = allAlbums[prevAlbumIndex];
      setCurrentAlbumIndex(prevAlbumIndex);
      setCurrentPhotoIndex(prevAlbum.images.length - 1);
    } else {
      const lastAlbumIndex = allAlbums.length - 1;
      const lastAlbum = allAlbums[lastAlbumIndex];
      setCurrentAlbumIndex(lastAlbumIndex);
      setCurrentPhotoIndex(lastAlbum.images.length - 1);
    }
  }, [currentAlbumIndex, currentPhotoIndex, allAlbums]);

  useEffect(() => {
    if (isOpen) {
      const handleKeyDown = (event: KeyboardEvent) => {
        if (event.key === "ArrowRight") goToNext();
        if (event.key === "ArrowLeft") goToPrevious();
      };
      window.addEventListener("keydown", handleKeyDown);
      return () => window.removeEventListener("keydown", handleKeyDown);
    }
  }, [isOpen, goToNext, goToPrevious]);

  const stopPropagation = (e: React.MouseEvent) => e.stopPropagation();

  return (
    <Dialog
      open={isOpen}
      onOpenChange={(open) => {
        setIsOpen(open);
        if (open) {
          setCurrentAlbumIndex(startAlbumIndex);
          setCurrentPhotoIndex(startPhotoIndex);
        } else {
          setTimeout(() => {
            if (document.activeElement instanceof HTMLElement) {
              document.activeElement.blur();
            }
          }, 0);
        }
      }}
    >
      <DialogTrigger asChild>{children}</DialogTrigger>
      <DialogContent
        onOpenAutoFocus={(e) => e.preventDefault()}
        onCloseAutoFocus={(e) => e.preventDefault()}
        className="bg-black/80 backdrop-blur-sm border-none shadow-none w-screen h-screen max-w-full p-0 flex items-center justify-center"
      >
        <VisuallyHidden asChild>
          <DialogTitle>
            {t("dialogTitle", {
              prefix: currentAlbum.title,
              index: currentPhotoIndex + 1,
            })}
          </DialogTitle>
        </VisuallyHidden>

        <Button
          variant="ghost"
          size="icon"
          onClick={(e) => {
            stopPropagation(e);
            goToPrevious();
          }}
          className="absolute left-2 md:left-4 top-1/2 -translate-y-1/2 z-50 text-white hover:bg-white/20 hover:text-white h-12 w-12 rounded-full"
          aria-label={t("previousImage")}
        >
          <ArrowLeft className="h-8 w-8" />
        </Button>

        <div className="relative w-full h-full max-w-[90vw] max-h-[85vh]">
          <Image
            src={currentImage}
            alt={t("imageAlt", {
              prefix: currentAlbum.title,
              index: currentPhotoIndex + 1,
            })}
            fill
            sizes="100vw"
            className="object-contain"
            key={currentImage}
          />
        </div>

        <Button
          variant="ghost"
          size="icon"
          onClick={(e) => {
            stopPropagation(e);
            goToNext();
          }}
          className="absolute right-2 md:right-4 top-1/2 -translate-y-1/2 z-50 text-white hover:bg-white/20 hover:text-white h-12 w-12 rounded-full"
          aria-label={t("nextImage")}
        >
          <ArrowRight className="h-8 w-8" />
        </Button>

        <div className="absolute bottom-4 left-1/2 -translate-x-1/2 z-50 rounded-full bg-black/50 text-white text-sm px-3 py-1.5 pointer-events-none text-center">
          <div className="font-semibold">{currentAlbum.title}</div>
          <div className="text-xs opacity-80">
            {currentPhotoIndex + 1} / {currentAlbum.images.length}
          </div>
        </div>

        <DialogClose asChild>
          <Button
            variant="ghost"
            size="icon"
            aria-label={t("close")}
            onClick={stopPropagation}
            className="absolute top-2 right-2 md:top-4 md:right-4 z-50 text-white hover:bg-white/20 hover:text-white h-12 w-12 rounded-full"
          >
            <X className="h-8 w-8" />
          </Button>
        </DialogClose>
      </DialogContent>
    </Dialog>
  );
}
</file>

<file path="src/components/LongTextRenderer.tsx">
"use client";

import ReactMarkdown from "react-markdown";
import { type ExtraProps } from "react-markdown";

interface LongTextRendererProps {
  content: string | null | undefined;
}

// --- THIS IS THE DEFINITIVE FIX ---
// We create a custom component to render inline code (`...`) blocks.
// This gives us full control over the styling and ensures no extra characters are added.
const CodeComponent = ({
  children,
  className,
  ...props
}: React.ClassAttributes<HTMLElement> &
  React.HTMLAttributes<HTMLElement> &
  ExtraProps) => {
  // react-markdown adds a `language-*` class for fenced code blocks (```).
  // Inline code has no className. We only want to style the inline code.
  const isInlineCode = !className;

  if (isInlineCode) {
    // These are the classes that Tailwind's `@tailwindcss/typography` (prose)
    // applies to inline code. By setting them explicitly, we guarantee the
    // correct appearance without any unwanted artifacts like visible backticks.
    return (
      <code
        className="relative rounded bg-muted px-[0.3rem] py-[0.2rem] font-mono text-sm font-semibold"
        {...props}
      >
        {children}
      </code>
    );
  }

  // For larger, fenced code blocks, we let them render normally for now.
  return (
    <code className={className} {...props}>
      {children}
    </code>
  );
};

export function LongTextRenderer({ content }: LongTextRendererProps) {
  if (!content) {
    return null;
  }

  return (
    // The `prose` class is still valuable for styling headings, lists, links, etc.
    <div className="prose prose-neutral dark:prose-invert max-w-none text-muted-foreground">
      <ReactMarkdown
        components={{
          // We tell ReactMarkdown to use our custom component for all `code` elements.
          code: CodeComponent,
        }}
      >
        {content}
      </ReactMarkdown>
    </div>
  );
}
</file>

<file path="src/components/ProficiencyDots.tsx">
"use client";

interface ProficiencyDotsProps {
  level: number;
  maxLevel?: number;
}

export function ProficiencyDots({ level, maxLevel = 5 }: ProficiencyDotsProps) {
  return (
    <div
      className="flex items-center gap-1"
      aria-label={`Proficiency: ${level} out of ${maxLevel}`}
    >
      {Array.from({ length: maxLevel }, (_, index) => {
        const dotLevel = index + 1;
        const isFilled = dotLevel <= level;

        return (
          <span
            key={dotLevel}
            className={`
              h-2 w-2 rounded-full transition-colors duration-200
              ${
                isFilled
                  ? "bg-foreground group-hover/item:bg-background group-data-[active=true]:bg-background group-data-[active=true]:group-hover/item:bg-foreground"
                  : "bg-muted group-hover/item:bg-background/30 group-data-[active=true]:bg-background/30 group-data-[active=true]:group-hover/item:bg-foreground/30"
              }
            `}
          />
        );
      })}
    </div>
  );
}
</file>

<file path="src/i18n/request.ts">
import { cookies, headers } from "next/headers";
import { getRequestConfig } from "next-intl/server";
import { isValidLocale, routing } from "./routing";

export default getRequestConfig(async () => {
  let locale = (await cookies()).get("NEXT_LOCALE")?.value;
  if (!locale) {
    const acceptLanguage = (await headers()).get("accept-language");
    if (acceptLanguage) {
      const primaryLanguage = acceptLanguage.split(",")[0].split("-")[0];
      if (isValidLocale(primaryLanguage)) {
        locale = primaryLanguage;
      }
    }
  }
  if (!locale || !isValidLocale(locale)) {
    locale = routing.defaultLocale;
  }

  return {
    locale,
    messages: {
      ...(await import(`../../messages/${locale}/common.json`)).default,
      software: (await import(`../../messages/${locale}/software.json`))
        .default,
    },
  };
});
</file>

<file path="src/app/sitemap.ts">
// src/app/sitemap.ts
import { MetadataRoute } from "next";
import { fetchAllProjectSlugs } from "@/lib/payload";

export default async function sitemap(): Promise<MetadataRoute.Sitemap> {
  const softwareDomain = process.env.NEXT_PUBLIC_SOFTWARE_DOMAIN;

  // --- FETCH DYNAMIC SLUGS FOR BOTH LOCALES ---
  const [enProjectSlugs, deProjectSlugs] = await Promise.all([
    fetchAllProjectSlugs("en"),
    fetchAllProjectSlugs("de"),
  ]);

  // --- MAP SLUGS TO SITEMAP ENTRIES ---
  const enSoftwareProjectPages = enProjectSlugs.map(({ slug }) => ({
    url: `https://${softwareDomain}/${slug}`,
    lastModified: new Date(),
  }));

  const deSoftwareProjectPages = deProjectSlugs.map(({ slug }) => ({
    url: `https://${softwareDomain}/de/${slug}`,
    lastModified: new Date(),
  }));

  // --- DEFINE STATIC AND TOP-LEVEL PAGES FOR BOTH LOCALES ---
  const staticEnRoutes = [
    { url: `https://${softwareDomain}`, priority: 1.0 },
    { url: `https://${softwareDomain}/imprint`, priority: 0.5 },
    { url: `https://${softwareDomain}/privacy_policy`, priority: 0.5 },
  ];

  const staticDeRoutes = [
    { url: `https://${softwareDomain}/de`, priority: 1.0 },
    { url: `https://${softwareDomain}/de/imprint`, priority: 0.5 },
    { url: `https://${softwareDomain}/de/privacy_policy`, priority: 0.5 },
  ];

  return [
    ...staticEnRoutes,
    ...staticDeRoutes,
    ...enSoftwareProjectPages,
    ...deSoftwareProjectPages,
  ];
}
</file>

<file path="src/components/sections/HeroSection.tsx">
// src/components/sections/software/HeroSection.tsx
"use client";

import { useRef, useState } from "react";
import { Button } from "@/components/ui/button";
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar";
import {
  motion,
  useScroll,
  useTransform,
  useMotionValueEvent,
} from "framer-motion";
import { useTranslations } from "next-intl";
import { AnimatedGreeting } from "@/components/AnimatedGreeting";
import { ArrowDown } from "lucide-react";
import { cn } from "@/lib/utils";
import { Link } from "@/i18n/navigation";

export function HeroSection() {
  const t = useTranslations("software.SoftwareHeroSection");
  const avatarSrc = "/images/avatar.webp";
  const heroRef = useRef<HTMLElement>(null);
  const [isAvatarActive, setIsAvatarActive] = useState(true);

  const { scrollYProgress } = useScroll({
    target: heroRef,
    offset: ["start start", "end start"],
  });

  useMotionValueEvent(scrollYProgress, "change", (latest) => {
    setIsAvatarActive(latest < 0.5);
  });

  const { scrollY } = useScroll();
  const arrowOpacity = useTransform(scrollY, [0, 150, 300], [1, 1, 0]);

  return (
    <section
      ref={heroRef}
      id="hero"
      className="relative flex min-h-screen items-center justify-center"
    >
      <div className="max-w-6xl mx-auto px-6 flex flex-col-reverse items-center gap-12 text-center lg:grid lg:grid-cols-2 lg:text-left">
        <motion.div
          initial={{ opacity: 0, x: -50 }}
          animate={{ opacity: 1, x: 0 }}
          transition={{ duration: 0.5 }}
          className="flex flex-col items-center lg:items-start"
        >
          <AnimatedGreeting />
          <p className="mt-6 text-lg leading-8 text-muted-foreground">
            {t("intro")}
          </p>
          <div className="mt-8 flex items-center justify-center gap-4 lg:justify-start">
            <Button asChild>
              <Link href="#projekte">{t("button_projects")}</Link>
            </Button>
            <Button 
              asChild 
              variant="outline" 
              className="hover:bg-foreground hover:text-background transition-colors"
            >
              <Link href="/resume">{t("button_resume")}</Link>
            </Button>
          </div>
        </motion.div>

        <motion.div
          className="flex justify-center lg:justify-end"
          initial={{ opacity: 0, scale: 0.8 }}
          animate={{
            opacity: 1,
            scale: isAvatarActive ? 1.05 : 1,
          }}
          transition={{
            duration: 0.5,
            ease: "easeInOut",
          }}
        >
          <Avatar
            data-active={isAvatarActive}
            className={cn(
              "h-56 w-56 border-4 lg:size-[418px] group",
              "transition-all duration-500 ease-in-out",
              "bg-transparent border-muted-foreground",
              "data-[active=true]:bg-foreground",
              "data-[active=true]:border-foreground"
            )}
          >
            <AvatarImage
              src={avatarSrc}
              alt="Profile picture of me"
              className={cn(
                "object-cover object-top scale-[1.2] origin-bottom transition-transform duration-500 ease-in-out",
                "group-data-[active=true]:scale-[1.3]",
                "group-data-[active=true]:translate-y-4"
              )}
            />
            <AvatarFallback>My Picture</AvatarFallback>
          </Avatar>
        </motion.div>
      </div>

      <motion.a
        href="#projekte"
        aria-label="Scroll to projects section"
        className="fixed bottom-10 left-1/2 -translate-x-1/2"
        style={{ opacity: arrowOpacity }}
        initial={{ opacity: 0 }}
        animate={{ opacity: 1 }}
        transition={{ duration: 0.5, delay: 2.5 }}
      >
        <motion.div
          className="rounded-full border border-muted-foreground/50 p-1.5 transition-colors hover:border-muted-foreground"
          animate={{ y: [0, 6, 0] }}
          transition={{
            duration: 2,
            repeat: Infinity,
            repeatType: "loop",
            ease: "easeInOut",
          }}
        >
          <ArrowDown className="h-5 w-5 text-muted-foreground" />
        </motion.div>
      </motion.a>
    </section>
  );
}
</file>

<file path="src/components/ProficiencyLegend.tsx">
// src/components/ProficiencyLegend.tsx
"use client";

import { useTranslations } from "next-intl";
import { ProficiencyBar } from "./ProficiencyBar";

export function ProficiencyLegend() {
  const t = useTranslations("software.SoftwareSkillsSection");

  return (
    <div className="flex items-center justify-center gap-3 text-sm text-muted-foreground">
      <span>{t("legend_beginner")}</span>
      {/* We apply override styles here to make the bar visible on the page background */}
      <div className="[&>div]:bg-muted [&>div>div]:bg-foreground">
        <ProficiencyBar level={5} />
      </div>
      <span>{t("legend_expert")}</span>
    </div>
  );
}
</file>

<file path="messages/en/software.json">
{
  "SoftwareHeader": {
    "projects": "Projects",
    "skills": "Skills",
    "resume": "Resume",
    "contact": "Contact"
  },
  "SoftwareHeroSection": {
    "greeting": "Hi, I'm {name}",
    "intro": "A Full-Stack Developer with a passion for designing and building robust, scalable, and user-friendly web applications.",
    "button_projects": "See my Work",
    "button_resume": "View Resume"
  },
  "ResumeCTASection": {
    "title": "Want to see my Resume?",
    "description": "Get a detailed overview of my experience, education, and skills. You can view it online or download it as a PDF.",
    "viewResume": "View Resume",
    "downloadPdf": "Download PDF"
  },
  "SoftwareProjectsSection": {
    "title": "Projects",
    "subtitle": "An insight into my problem-solving skills and technical execution.",
    "button_details": "View Details"
  },
  "SoftwareSkillsSection": {
    "title": "Technologies & Skills",
    "subtitle": "My toolkit for developing modern, robust, and scalable software solutions.",
    "category_frontend": "Frontend",
    "category_backend": "Backend",
    "category_devops": "DevOps & Tools",
    "legend_beginner": "Familiar",
    "legend_expert": "Expert"
  },
  "SoftwareContactSection": {
    "title": "Get in Touch",
    "subtitle": "Have a project in mind or just want to connect? I'm always open to a good conversation.",
    "form_name": "Name",
    "form_name_placeholder": "Your Name",
    "form_email": "Email",
    "form_email_placeholder": "your@email.com",
    "form_message": "Message",
    "form_message_placeholder": "Your message...",
    "form_submit": "Send Message",
    "form_submitting": "Submitting...",
    "socials_text": "Or find me on:",
    "success_title": "Thank You!",
    "success_message": "Your message has been sent successfully. I'll get back to you soon.",
    "error_message": "Something went wrong. Please try again."
  },
  "ProjectDetailsPage": {
    "back_button": "Back to Projects",
    "about_title": "About this Project",
    "details_title": "Details",
    "tech_title": "Technologies Used",
    "links_title": "Project Links",
    "live_demo_button": "Live Demo",
    "source_code_button": "Source Code",
    "not_available": "Not Available",
    "developed_in_label": "Developed in"
  },
   "SoftwarePageSEO": {
    "siteName": "Code by {name}",
    "description": "Explore a collection of my software development projects showcasing my skills in modern web technologies."
  },
    "ProjectGallery": {
    "thumbnailAlt": "{prefix} - Screenshot {index}",
    "scrollLeft": "Scroll left",
    "scrollRight": "Scroll right"
  }
}
</file>

<file path="src/app/[locale]/imprint/page.tsx">
import { getTranslations } from "next-intl/server";
import { Metadata } from "next"; // 1. Metadaten-Typ importieren

// 2. Diese Funktion fÃ¼r dynamische Metadaten hinzufÃ¼gen
export async function generateMetadata(): Promise<Metadata> {
  const t = await getTranslations("ImprintPage");

  return {
    title: t("title"),
  };
}

export default async function Imprintage() {
  const t = await getTranslations("ImprintPage");

  const values = {
    name: process.env.NEXT_PUBLIC_FULL_NAME || "",
    street: process.env.NEXT_PUBLIC_STREET_ADDRESS || "",
    city: process.env.NEXT_PUBLIC_CITY_ADDRESS || "",
    phone: process.env.NEXT_PUBLIC_PHONE_NUMBER || "[Not specified]",
    email: process.env.NEXT_PUBLIC_EMAIL_ADDRESS || "",
  };

  // 2. Build the content arrays by calling `t()` for each line and passing the values
  const section1Content = [
    t("section1_content.name", values),
    t("section1_content.street", values),
    t("section1_content.city", values),
    t("section1_content.country"), // This line has no variable
  ];

  const section2Content = [
    t("section2_content.phone", values),
    t("section2_content.email", values),
  ];

  const section3Content = [
    t("section3_content.name", values),
    t("section3_content.address", values),
  ];

  const ContentBlock = ({
    title,
    content,
  }: {
    title: string;
    content: string[];
  }) => (
    <div className="space-y-1">
      <h2 className="text-xl font-semibold">{title}</h2>
      {content.map((line, index) => (
        <p key={index}>{line}</p>
      ))}
    </div>
  );

  return (
    <div className="container mx-auto max-w-4xl py-16 px-4">
      <h1 className="text-4xl font-bold border-b-2 border-foreground pb-4">
        {t("title")}
      </h1>
      <div className="mt-8 space-y-8 text-muted-foreground">
        <ContentBlock title={t("section1_title")} content={section1Content} />
        <ContentBlock title={t("section2_title")} content={section2Content} />
        <ContentBlock title={t("section3_title")} content={section3Content} />
        <div>
          <h2 className="text-2xl font-semibold">{t("disclaimer_title")}</h2>
          <div className="mt-4 space-y-4">
            <div>
              <h3 className="text-lg font-semibold">
                {t("disclaimer_links_title")}
              </h3>
              <p>{t("disclaimer_links_content")}</p>
            </div>
            <div>
              <h3 className="text-lg font-semibold">
                {t("disclaimer_copyright_title")}
              </h3>
              <p>{t("disclaimer_copyright_content")}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/app/[locale]/privacy_policy/page.tsx">
// src/app/[locale]/privacy_policy/page.tsx

import { getTranslations } from "next-intl/server";
import { Metadata } from "next";

export async function generateMetadata(): Promise<Metadata> {
  const t = await getTranslations("PrivacyPage");

  return {
    title: t("title"),
  };
}

export default async function PrivacyPolicyPage() {
  const t = await getTranslations("PrivacyPage");

  const values = {
    name: process.env.NEXT_PUBLIC_FULL_NAME || "",
    street: process.env.NEXT_PUBLIC_STREET_ADDRESS || "",
    city: process.env.NEXT_PUBLIC_CITY_ADDRESS || "",
    email: process.env.NEXT_PUBLIC_EMAIL_ADDRESS || "",
  };

  const section2Content = [
    t("section2_content.name", values),
    t("section2_content.street", values),
    t("section2_content.city", values),
    t("section2_content.email", values),
  ];

  return (
    <div className="container mx-auto max-w-4xl py-16 px-4">
      <h1 className="text-4xl font-bold border-b-2 border-foreground pb-4">
        {t("title")}
      </h1>
      <div className="mt-8 space-y-8 text-muted-foreground">
        <div className="space-y-2">
          <h2 className="text-2xl font-semibold">{t("section1_title")}</h2>
          <p>{t("section1_content")}</p>
        </div>
        <div className="space-y-1">
          <h2 className="text-2xl font-semibold">{t("section2_title")}</h2>
          {section2Content.map((line: string, index: number) => (
            <p key={index}>{line}</p>
          ))}
        </div>
        <div>
          <h2 className="text-2xl font-semibold">{t("section3_title")}</h2>
          <div className="mt-4 space-y-4">
            <div>
              <h3 className="text-lg font-semibold">
                {t("section3_hosting_title")}
              </h3>
              <p>{t("section3_hosting_content")}</p>
            </div>
            <div>
              <h3 className="text-lg font-semibold">
                {t("section3_analytics_title")}
              </h3>
              <p>{t("section3_analytics_content")}</p>
            </div>
            <div>
              <h3 className="text-lg font-semibold">
                {t("section3_contact_title")}
              </h3>
              <p>{t("section3_contact_content")}</p>
            </div>
          </div>
        </div>
        <div className="space-y-2">
          <h2 className="text-2xl font-semibold">{t("section4_title")}</h2>
          <p>{t("section4_content")}</p>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/components/ProjectGallery.tsx">
"use client";

import { useRef, useState, useEffect, useCallback } from "react";
import Image from "next/image";
import { GalleryLightbox } from "@/components/GalleryLightbox";
import { Button } from "@/components/ui/button";
import { ArrowLeft, ArrowRight, ZoomIn } from "lucide-react";
import { useTranslations } from "next-intl";
import { cn } from "@/lib/utils";

// UPDATED: Added an optional 'variant' prop
interface ProjectGalleryProps {
  images: string[];
  altPrefix: string;
  variant?: "default" | "inverted";
}

export function ProjectGallery({
  images,
  altPrefix,
  variant = "default",
}: ProjectGalleryProps) {
  const t = useTranslations("software.ProjectGallery");

  const galleryRef = useRef<HTMLDivElement>(null);
  const [showLeftArrow, setShowLeftArrow] = useState(false);
  const [showRightArrow, setShowRightArrow] = useState(false);

  const albumForLightbox = [{ title: altPrefix, images: images }];

  const checkArrows = useCallback(() => {
    const gallery = galleryRef.current;
    if (!gallery) return;

    const { scrollLeft, scrollWidth, clientWidth } = gallery;
    setShowLeftArrow(scrollLeft > 1);
    const isAtEnd = scrollWidth - scrollLeft - clientWidth < 1;
    setShowRightArrow(!isAtEnd && images.length > 1);
  }, [images.length]);

  useEffect(() => {
    const gallery = galleryRef.current;
    if (gallery) {
      checkArrows();
      gallery.addEventListener("scroll", checkArrows, { passive: true });
      window.addEventListener("resize", checkArrows);
      return () => {
        gallery.removeEventListener("scroll", checkArrows);
        window.removeEventListener("resize", checkArrows);
      };
    }
  }, [checkArrows]);

  const scrollRight = () => {
    galleryRef.current?.scrollBy({
      left: galleryRef.current.clientWidth * 0.8,
      behavior: "smooth",
    });
  };

  const scrollLeft = () => {
    galleryRef.current?.scrollBy({
      left: -galleryRef.current.clientWidth * 0.8,
      behavior: "smooth",
    });
  };

  return (
    <div className="relative group">
      {/* UPDATED: Added conditional background and border colors */}
      <div
        className={cn(
          "overflow-hidden border-2 rounded-lg shadow-md",
          variant === "inverted"
            ? "bg-foreground border-background"
            : "border-foreground"
        )}
      >
        <div
          ref={galleryRef}
          className="flex overflow-x-auto overflow-y-hidden snap-x snap-mandatory scroll-smooth scrollbar-thin scrollbar-thumb-muted-foreground/50 scrollbar-track-transparent gap-0"
        >
          {images.map((imgSrc, index) => (
            <GalleryLightbox
              key={index}
              allAlbums={albumForLightbox}
              startAlbumIndex={0}
              startPhotoIndex={index}
            >
              <div className="group/image relative aspect-video w-full flex-shrink-0 snap-center cursor-pointer p-8">
                <div className="relative w-full h-full">
                  <Image
                    src={imgSrc}
                    alt={t("thumbnailAlt", {
                      index: index + 1,
                      prefix: altPrefix,
                    })}
                    fill
                    sizes="(max-width: 768px) 100vw, (max-width: 1024px) 75vw, 896px"
                    className="object-contain transition-transform duration-300 group-hover/image:scale-105"
                    priority={index === 0}
                  />
                </div>
                <div className="absolute inset-0 bg-black/40 flex items-center justify-center opacity-0 group-hover/image:opacity-100 transition-opacity duration-300">
                  <ZoomIn className="h-10 w-10 text-white" />
                </div>
              </div>
            </GalleryLightbox>
          ))}
        </div>
      </div>

      <Button
        variant="ghost"
        size="icon"
        onClick={scrollLeft}
        aria-label={t("scrollLeft")}
        // UPDATED: Added conditional styling for inverted arrows
        className={cn(
          "absolute top-1/2 -translate-y-1/2 left-4 z-10 h-10 w-10 rounded-full backdrop-blur-sm transition-opacity",
          variant === "inverted"
            ? "bg-foreground/80 hover:bg-foreground/90 text-background"
            : "bg-background/80 hover:bg-background/90 text-foreground",
          showLeftArrow ? "opacity-100" : "opacity-0 pointer-events-none"
        )}
      >
        <ArrowLeft className="h-6 w-6" />
      </Button>

      <Button
        variant="ghost"
        size="icon"
        onClick={scrollRight}
        aria-label={t("scrollRight")}
        // UPDATED: Added conditional styling for inverted arrows
        className={cn(
          "absolute top-1/2 -translate-y-1/2 right-4 z-10 h-10 w-10 rounded-full backdrop-blur-sm transition-opacity",
          variant === "inverted"
            ? "bg-foreground/80 hover:bg-foreground/90 text-background"
            : "bg-background/80 hover:bg-background/90 text-foreground",
          showRightArrow ? "opacity-100" : "opacity-0 pointer-events-none"
        )}
      >
        <ArrowRight className="h-6 w-6" />
      </Button>
    </div>
  );
}
</file>

<file path=".gitignore">
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.*
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/versions

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*
.pnpm-debug.log*

# Environment Variables
# Ignore all local environment files that contain sensitive secrets.
.env*

# But DO NOT ignore the example template file. The '!' negates the rule.
# This file should always be committed to the repository.
!.env.example

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts
.repomix-output.xml
</file>

<file path="messages/de/software.json">
{
  "SoftwareHeader": {
    "projects": "Projekte",
    "skills": "Skills",
    "resume": "Lebenslauf",
    "contact": "Kontakt"
  },
  "SoftwareHeroSection": {
    "greeting": "Hi, ich bin {name}",
    "intro": "Ein Full-Stack Entwickler mit einer Leidenschaft fÃ¼r die Gestaltung und Realisierung von robusten, skalierbaren und benutzerfreundlichen Webanwendungen.",
    "button_projects": "Schau dir meine Arbeit an",
    "button_resume": "Lebenslauf ansehen"
  },
  "ResumeCTASection": {
    "title": "MÃ¶chtest du meinen Lebenslauf sehen?",
    "description": "Erhalte einen detaillierten Ãœberblick Ã¼ber meine Erfahrungen, Ausbildung und FÃ¤higkeiten. Du kannst ihn online ansehen oder als PDF herunterladen.",
    "viewResume": "Lebenslauf ansehen",
    "downloadPdf": "PDF herunterladen"
  },
  "SoftwareProjectsSection": {
    "title": "Projekte",
    "subtitle": "Ein Einblick in meine ProblemlÃ¶sungsfÃ¤higkeiten und meine technische Umsetzung.",
    "button_details": "Details ansehen"
  },
  "SoftwareSkillsSection": {
    "title": "Technologien & Kompetenzen",
    "subtitle": "Mein Werkzeugkasten fÃ¼r die Entwicklung moderner, robuster und skalierbarer SoftwarelÃ¶sungen.",
    "category_frontend": "Frontend",
    "category_backend": "Backend",
    "category_devops": "DevOps & Tools",
    "legend_beginner": "Grundlagen",
    "legend_expert": "Experte"
  },
  "SoftwareContactSection": {
    "title": "Kontakt aufnehmen",
    "subtitle": "Hast du ein Projekt im Sinn oder mÃ¶chtest du dich vernetzen? Ich freue mich darauf, von dir zu hÃ¶ren.",
    "form_name": "Name",
    "form_name_placeholder": "Ihr Name",
    "form_email": "E-Mail",
    "form_email_placeholder": "ihre@email.com",
    "form_message": "Nachricht",
    "form_message_placeholder": "Ihre Nachricht...",
    "form_submit": "Nachricht senden",
    "form_submitting": "Sende...",
    "socials_text": "Oder finde mich hier:",
    "success_title": "Vielen Dank!",
    "success_message": "Ihre Nachricht wurde erfolgreich gesendet. Ich melde mich in KÃ¼rze.",
    "error_message": "Etwas ist schiefgelaufen. Bitte versuchen es erneut."
  },
    "ProjectDetailsPage": {
    "back_button": "ZurÃ¼ck zu den Projekten",
    "about_title": "Ãœber dieses Projekt",
    "details_title": "Details",
    "tech_title": "Verwendete Technologien",
    "links_title": "Projekt-Links",
    "live_demo_button": "Live-Demo",
    "source_code_button": "Quellcode",
    "not_available": "Nicht verfÃ¼gbar",
    "developed_in_label": "Entwickelt im"
  },
   "SoftwarePageSEO": {
    "siteName": "Code von {name}",
    "description": "Entdecken eine Sammlung meiner Softwareentwicklungsprojekte, die meine FÃ¤higkeiten in modernen Web-Technologien demonstrieren."
  },
  "ProjectGallery": {
    "thumbnailAlt": "{prefix} - Screenshot {index}",
    "scrollLeft": "Nach links scrollen",
    "scrollRight": "Nach rechts scrollen"
  }
}
</file>

<file path="src/app/globals.css">
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  :root {
    --background: 240 10% 98%;
    --foreground: 240 10% 10%;
    
    --card: 240 10% 98%;
    --card-foreground: 240 10% 10%;

    --popover: 240 10% 98%;
    --popover-foreground: 240 10% 10%;

    --primary: 240 10% 10%;
    --primary-foreground: 240 10% 98%;

    --secondary: 240 5% 90%;
    --secondary-foreground: 240 10% 10%;
    
    --muted: 240 5% 90%;
    --muted-foreground: 240 5% 45%;

    --accent: 240 5% 90%;
    --accent-foreground: 240 10% 10%;

    --destructive: 0 84.2% 60.2%;
    --destructive-foreground: 240 10% 98%;

    --border: 240 10% 85%;
    --input: 240 10% 85%;
    --ring: 240 10% 10%;
    
    --radius: 0.75rem;
  }

  .dark {
    /* --- THIS IS THE DEFINITIVE FIX --- */
    --background: 240 5.9% 10%;
    --foreground: 240 10% 98%;
    
    /* Update card and popover for consistency */
    --card: 240 5.9% 10%;
    --card-foreground: 240 10% 98%;

    --popover: 240 5.9% 10%;
    --popover-foreground: 240 10% 98%;

    --primary: 240 10% 98%;
    --primary-foreground: 240 10% 10%;

    --secondary: 240 5% 20%;
    --secondary-foreground: 240 10% 98%;

    --muted: 240 5% 20%;
    --muted-foreground: 240 5% 65%;

    --accent: 240 5% 20%;
    --accent-foreground: 240 10% 98%;

    --destructive: 0 62.8% 30.6%;
    --destructive-foreground: 240 10% 98%;

    --border: 240 5% 30%;
    --input: 240 5% 30%;
    --ring: 240 10% 98%;
  }
}

@layer base {
  * {
    @apply border-border;
  }
  
  html {
    scroll-behavior: smooth;
  }
  
  body {
    @apply bg-background text-foreground;
  }
  .prose code::before,
  .prose code::after {
    content: none !important;
  }
}

@layer utilities {
  @media print {
    /* Hide headers, footers, and other non-resume elements */
    header, footer, nav {
      display: none !important;
    }

    @page {
      size: A4;
      margin: 0;
    }

    /* Reset body margins */
    html, body {
      margin: 0;
      padding: 0;
      background: white !important;
      color: black;
    }

    /* Force background colors (for badges, avatars) to print */
    * {
      -webkit-print-color-adjust: exact !important;
      print-color-adjust: exact !important;
    }
  }
}

[class^="devicon-"] path,
[class^="devicon-"] polygon,
[class^="devicon-"] rect,
[class^="devicon-"] circle,
[class^="devicon-"] line {
  fill: currentColor !important;
}
</file>

<file path="middleware.ts">
import createMiddleware from "next-intl/middleware";
import { routing } from "./src/i18n/routing";

// Use the standard next-intl middleware
export default createMiddleware({
  locales: routing.locales,
  defaultLocale: routing.defaultLocale,
  localePrefix: routing.localePrefix,
});

export const config = {
  // Match all paths except for:
  // - api (API routes)
  // - _next (Next.js internals)
  // - _vercel (Vercel internals)
  // - admin (Payload admin UI)
  // - images (Your static images folder)
  // - favicon* (Favicons)
  // - files with extensions (e.g. .png, .jpg, .css, .js)
  matcher: ["/((?!api|_next|_vercel|admin|images|favicon*|.*\\..*).*)"],
};
</file>

<file path="next.config.ts">
import { NextConfig } from "next";
import { withPayload } from '@payloadcms/next/withPayload'
import createNextIntlPlugin from "next-intl/plugin";

const withNextIntl = createNextIntlPlugin();

/** @type {import('next').NextConfig} */
const nextConfig: NextConfig = {
  images: {
    remotePatterns: [
      // --- THIS IS THE FIX ---
      // We are adding a new rule to allow images from your local Strapi instance.
      {
        protocol: "http",
        hostname: "localhost",
        port: "1337",
        pathname: "/uploads/**", // Be specific to the uploads folder
      },
      {
        protocol: "https",
        hostname: "active-confidence-ee4dbe67cf.media.strapiapp.com",
      },
    ],
  },
};

export default withPayload(withNextIntl(nextConfig));
</file>

<file path="messages/de/common.json">
{
  "Footer": {
    "made_with": "Mit",
    "by_me": "von mir entwickelt",
    "imprint": "Impressum",
    "privacy": "Datenschutz"
  },
  "HomePageSEO": {
    "title": "Code von {name}",
    "description": "Entdecken eine Sammlung meiner Softwareentwicklungsprojekte, die meine FÃ¤higkeiten in modernen Web-Technologien demonstrieren."
  },
  "GalleryLightbox": {
    "dialogTitle": "{prefix} - Bild {index}",
    "imageAlt": "{prefix} - Bild {index}",
    "previousImage": "Voriges Bild",
    "nextImage": "NÃ¤chstes Bild",
    "close": "Gallerie schlieÃŸen"
  },
  "ImprintPage": {
    "title": "Impressum",
    "section1_title": "Angaben gemÃ¤ÃŸ Â§ 5 TMG",
    "section1_content": {
      "name": "{name}",
      "street": "{street}",
      "city": "{city}",
      "country": "Deutschland"
    },
    "section2_title": "Kontakt",
    "section2_content": {
      "phone": "Telefon: {phone}",
      "email": "E-Mail: {email}"
    },
    "section3_title": "Verantwortlich fÃ¼r den Inhalt nach Â§ 18 Abs. 2 MStV",
    "section3_content": {
      "name": "{name}",
      "address": "{street}, {city}"
    },
    "disclaimer_title": "Haftungsausschluss",
    "disclaimer_links_title": "Haftung fÃ¼r Links",
    "disclaimer_links_content": "Unser Angebot enthÃ¤lt Links zu externen Websites Dritter, auf deren Inhalte wir keinen Einfluss haben. Deshalb kÃ¶nnen wir fÃ¼r diese fremden Inhalte auch keine GewÃ¤hr Ã¼bernehmen. FÃ¼r die Inhalte der verlinkten Seiten ist stets der jeweilige Anbieter oder Betreiber der Seiten verantwortlich.",
    "disclaimer_copyright_title": "Urheberrecht",
    "disclaimer_copyright_content": "Die durch die Seitenbetreiber erstellten Inhalte und Werke auf diesen Seiten unterliegen dem deutschen Urheberrecht. Die VervielfÃ¤ltigung, Bearbeitung, Verbreitung und jede Art der Verwertung auÃŸerhalb der Grenzen des Urheberrechtes bedÃ¼rfen der schriftlichen Zustimmung des jeweiligen Autors bzw. Erstellers."
  },
  "PrivacyPage": {
    "title": "DatenschutzerklÃ¤rung",
    "section1_title": "1. Datenschutz auf einen Blick",
    "section1_content": "Diese DatenschutzerklÃ¤rung informiert Sie Ã¼ber die Art, den Umfang und den Zweck der Verarbeitung von personenbezogenen Daten auf unserer Website.",
    "section2_title": "Verantwortliche Stelle",
    "section2_content": {
      "name": "{name}",
      "street": "{street}",
      "city": "{city}",
      "email": "E-Mail: {email}"
    },
    "section3_title": "2. Datenerfassung auf dieser Website",
    "section3_hosting_title": "Hosting und Server-Log-Dateien",
    "section3_hosting_content": "Unsere Website wird bei Vercel Inc., 340 S Lemon Ave #4133, Walnut, CA 91789, USA, gehostet. Vercel erhebt bei jedem Zugriff auf die Website automatisch Informationen in sogenannten Server-Log-Dateien. Diese Daten werden nicht mit anderen Datenquellen zusammengefÃ¼hrt. Die Erfassung dieser Daten erfolgt auf Grundlage von Art. 6 Abs. 1 lit. f DSGVO.",
    "section3_analytics_title": "Analyse durch Vercel Analytics & Speed Insights",
    "section3_analytics_content": "Wir nutzen die Dienste Vercel Analytics und Speed Insights von unserem Hoster Vercel Inc. Diese Dienste sind datenschutzfreundlich konzipiert, erheben keine personenbezogenen Daten, die eine Identifizierung des Nutzers ermÃ¶glichen und verwenden keine Cookies. Die Rechtsgrundlage ist unser berechtigtes Interesse (Art. 6 Abs. 1 lit. f DSGVO) an der Analyse und Optimierung unserer Website.",
    "section3_contact_title": "Kontaktformular via Formspree",
    "section3_contact_content": "Wenn Sie unser Kontaktformular nutzen, werden Ihre Angaben zur Bearbeitung Ihrer Anfrage an den Dienstleister Formspree, Inc., 1201 Orange St, Ste 600, Wilmington, DE 19801, USA, Ã¼bermittelt und dort verarbeitet. Die Verarbeitung dieser Daten erfolgt auf Grundlage Ihrer Einwilligung (Art. 6 Abs. 1 lit. a DSGVO).",
    "section4_title": "3. Ihre Rechte als Betroffener",
    "section4_content": "Sie haben im Rahmen der geltenden gesetzlichen Bestimmungen jederzeit das Recht auf unentgeltliche Auskunft Ã¼ber Ihre gespeicherten personenbezogenen Daten, deren Herkunft und EmpfÃ¤nger und den Zweck der Datenverarbeitung und ggf. ein Recht auf Berichtigung oder LÃ¶schung dieser Daten."
  },
  "ResumePage": {
    "downloadPdf": "PDF herunterladen",
    "resumeFilename": "Lebenslauf_Joel_Dettinger",
    "home": "Startseite",
    "summary": "Zusammenfassung",
    "experience": "Berufserfahrung",
    "education": "Ausbildung",
    "skills": "FÃ¤higkeiten",
    "languages": "Sprachen",
    "contact": "Kontakt"
  }
}
</file>

<file path="messages/en/common.json">
{
  "Footer": {
    "made_with": "Made with",
    "by_me": "by me",
    "imprint": "Imprint",
    "privacy": "Privacy Policy"
  },
  "HomePageSEO": {
    "title": "Code by {name}",
    "description": "Explore a collection of my software development projects showcasing my skills in modern web technologies."
  },
  "GalleryLightbox": {
    "dialogTitle": "{prefix} - Image {index}",
    "imageAlt": "{prefix} - Image {index}",
    "previousImage": "Previous image",
    "nextImage": "Next image",
    "close": "Close Gallery"
  },
  "ImprintPage": {
    "title": "Imprint",
    "section1_title": "Information pursuant to Â§ 5 TMG",
    "section1_content": {
      "name": "{name}",
      "street": "{street}",
      "city": "{city}",
      "country": "Germany"
    },
    "section2_title": "Contact",
    "section2_content": {
      "phone": "Phone: {phone}",
      "email": "Email: {email}"
    },
    "section3_title": "Person responsible for content pursuant to Â§ 18 Abs. 2 MStV",
    "section3_content": {
      "name": "{name}",
      "address": "{street}, {city}"
    },
    "disclaimer_title": "Disclaimer",
    "disclaimer_links_title": "Liability for Links",
    "disclaimer_links_content": "Our site contains links to external third-party websites, over whose content we have no influence. Therefore, we cannot assume any liability for this external content. The respective provider or operator of the pages is always responsible for the content of the linked pages.",
    "disclaimer_copyright_title": "Copyright",
    "disclaimer_copyright_content": "The content and works created by the site operators on these pages are subject to German copyright law. The reproduction, processing, distribution, and any kind of exploitation outside the limits of copyright require the written consent of the respective author or creator."
  },
  "PrivacyPage": {
    "title": "Privacy Policy",
    "section1_title": "1. Data Protection at a Glance",
    "section1_content": "This privacy policy informs you about the nature, scope, and purpose of the processing of personal data on our website.",
    "section2_title": "Data Controller",
    "section2_content": {
      "name": "{name}",
      "street": "{street}",
      "city": "{city}",
      "email": "Email: {email}"
    },
    "section3_title": "2. Data Collection on This Website",
    "section3_hosting_title": "Hosting and Server Log Files",
    "section3_hosting_content": "Our website is hosted by Vercel Inc., 340 S Lemon Ave #4133, Walnut, CA 91789, USA. Vercel automatically collects information in server log files each time the website is accessed. This data is not merged with other data sources. The basis for this data processing is Art. 6(1)(f) GDPR.",
    "section3_analytics_title": "Analytics by Vercel Analytics & Speed Insights",
    "section3_analytics_content": "We use the services Vercel Analytics and Speed Insights from our host, Vercel Inc. These services are designed to be privacy-friendly, do not collect personal data that would allow for user identification, and do not use cookies. The legal basis is our legitimate interest (Art. 6(1)(f) GDPR) in the analysis and optimization of our website.",
    "section3_contact_title": "Contact Form via Formspree",
    "section3_contact_content": "When you use our contact form, your provided information is transmitted to and processed by the service provider Formspree, Inc., 1201 Orange St, Ste 600, Wilmington, DE 19801, USA, to handle your request. The processing of this data is based on your consent (Art. 6(1)(a) GDPR).",
    "section4_title": "3. Your Rights as a Data Subject",
    "section4_content": "Within the framework of the applicable legal provisions, you have the right at any time to free information about your stored personal data, its origin and recipients, and the purpose of the data processing, and, if applicable, a right to correction or deletion of this data."
  },
  "ResumePage": {
    "downloadPdf": "Download PDF",
    "resumeFilename": "Resume_Joel_Dettinger",
    "home": "Home",
    "summary": "Summary",
    "experience": "Experience",
    "education": "Education",
    "skills": "Skills",
    "languages": "Languages",
    "contact": "Contact"
  }
}
</file>

<file path="src/app/[locale]/layout.tsx">
import React from "react";
import { NextIntlClientProvider } from "next-intl";
import {
  getMessages,
  getTranslations,
  setRequestLocale,
} from "next-intl/server";
import { routing, isValidLocale } from "@/i18n/routing";
import { notFound } from "next/navigation";
import { Metadata } from "next";

// Imports from old src/app/layout.tsx
import "../globals.css";
import "devicon/devicon.min.css";
import { Inter } from "next/font/google";
import { cn } from "@/lib/utils";
import { ThemeProvider } from "@/components/Theme-Provider";
import { Analytics } from "@vercel/analytics/react";
import { SpeedInsights } from "@vercel/speed-insights/next";

const inter = Inter({ subsets: ["latin"] });

export function generateStaticParams() {
  return routing.locales.map((locale) => ({ locale }));
}

export async function generateMetadata({
  params,
}: {
  params: Promise<{ locale: string }>;
}): Promise<Metadata> {
  const { locale } = await params;
  const t = await getTranslations({ locale, namespace: "HomePageSEO" });
  const fullName = process.env.NEXT_PUBLIC_FULL_NAME || "Portfolio";
  const firstName = fullName.split(" ")[0];

  const softwareDomain = process.env.NEXT_PUBLIC_SOFTWARE_DOMAIN || "";

  return {
    title: t("title", { name: firstName }),
    description: t("description", { name: firstName }),
    icons: {
      icon: "/favicon.ico",
      shortcut: { url: "/favicon.ico", type: "image/x-icon" },
      apple: { url: "/favicon-light.svg", type: "image/svg+xml" },
      other: [
        {
          rel: "icon",
          url: "/favicon-light.svg",
          media: "(prefers-color-scheme: light)",
          type: "image/svg+xml",
        },
        {
          rel: "icon",
          url: "/favicon-dark.svg",
          media: "(prefers-color-scheme: dark)",
          type: "image/svg+xml",
        },
      ],
    },
    alternates: {
      canonical: `https://${softwareDomain}`,
      languages: {
        en: `https://${softwareDomain}`,
        de: `https://${softwareDomain}/de`,
        "x-default": `https://${softwareDomain}`,
      },
    },
  };
}

export default async function RootLocaleLayout({
  children,
  params,
}: {
  children: React.ReactNode;
  params: Promise<{ locale: string }>;
}) {
  const { locale } = await params;

  if (!isValidLocale(locale)) {
    notFound();
  }
  setRequestLocale(locale);

  const messages = await getMessages();

  return (
    // --- THIS IS THE FIX ---
    // Changed suppressHydWarning to suppressHydrationWarning
    <html lang={locale} suppressHydrationWarning>
      <body
        className={cn(
          "min-h-screen bg-background font-sans antialiased",
          inter.className
        )}
      >
        <ThemeProvider attribute="class" defaultTheme="system" enableSystem>
          <NextIntlClientProvider locale={locale} messages={messages}>
            {children}
          </NextIntlClientProvider>
        </ThemeProvider>
        <Analytics />
        <SpeedInsights />
      </body>
    </html>
  );
}
</file>

<file path="Readme.md">
<a id="readme-top"></a>

[![Issues][issues-shield]][issues-url]
[![MIT License][license-shield]][license-url]

<br />
<div align="center">
  <a href="#">
    <img src="public/favicon-dark.svg" alt="Logo" width="80" height="80">
  </a>

<h3 align="center">Software Portfolio | Next.js & Strapi</h3>

  <p align="center">
    A personal portfolio showcasing software development projects, built with Next.js and a Strapi Headless CMS.
    <br />
    <a href="#about-the-project"><strong>Explore the Features Â»</strong></a>
    <br />
    <br />
    <a href="https://{process.env.NEXT_PUBLIC_SOFTWARE_DOMAIN}">View Demo</a>
    Â·
    <a href="https://github.com/dettinjo/portfolio_frontend/issues/new?labels=bug&template=bug-report---.md">Report Bug</a>
    Â·
    <a href="https://github.com/dettinjo/portfolio_frontend/issues/new?labels=enhancement&template=feature-request---.md">Request Feature</a>
  </p>
</div>

<details>
  <summary>Table of Contents</summary>
  <ol>
    <li>
      <a href="#about-the-project">About The Project</a>
      <ul>
        <li><a href="#built-with">Built With</a></li>
      </ul>
    </li>
    <li>
      <a href="#getting-started">Getting Started</a>
      <ul>
        <li><a href="#prerequisites">Prerequisites</a></li>
        <li><a href="#backend-setup-strapi">Backend Setup (Strapi)</a></li>
        <li><a href="#frontend-setup-nextjs">Frontend Setup (Next.js)</a></li>
      </ul>
    </li>
    <li><a href="#license">License</a></li>
    <li><a href="#contact">Contact</a></li>
    <li><a href="#acknowledgments">Acknowledgments</a></li>
  </ol>
</details>

## About The Project

This repository contains the frontend for a full-stack personal software portfolio. All content, from project details to skill lists, is managed through a flexible Strapi Headless CMS, allowing for easy updates without redeploying the frontend.

Here's why this architecture is effective:
* **Headless & Dynamic:** Built with Strapi, all project data is fetched at build-time (SSG) or request-time (SSR/ISR) for excellent performance and maintainability.
* **Modern User Experience:** The site is fully responsive, supports internationalization (EN/DE), and features a dynamic light/dark theme that respects user preferences.
* **Scalable:** Using Next.js provides a robust foundation for Server-Side Rendering, Static Site Generation, and a great developer experience.

<p align="right">(<a href="#readme-top">back to top</a>)</p>

### Built With

This project is built with a modern, decoupled architecture using the latest industry-standard tools.

* [![Next][Next.js]][Next-url]
* [![React][React.js]][React-url]
* [![TypeScript][TypeScript]][TypeScript-url]
* [![Tailwind][TailwindCSS]][Tailwind-url]
* [![Strapi][Strapi.io]][Strapi-url]
* [![Vercel][Vercel]][Vercel-url]

<p align="right">(<a href="#readme-top">back to top</a>)</p>

## Getting Started

To get a local copy up and running, you will need to set up both the backend (Strapi) and this frontend (Next.js) service.

### Prerequisites

Ensure you have the following software installed on your machine.
* [Node.js](https://nodejs.org/) (v18 or higher recommended)
* npm
    ```sh
    npm install npm@latest -g
    ```

### Backend Setup (Strapi)

The backend must be running first. These instructions assume you are running them from the `/backend` directory of the original project monorepo.

1.  Navigate into the `backend` directory.
    ```sh
    cd backend
    ```
2.  Install NPM packages.
    ```sh
    npm install
    ```
3.  Build the Strapi admin panel.
    ```sh
    npm run build
    ```
4.  Start the Strapi development server (runs on `http://localhost:1337`).
    ```sh
    npm run develop
    ```
5.  **Admin Setup & Permissions:** Navigate to `http://localhost:1337/admin` to create your admin account. Then, go to **Settings > Roles > Public** and grant `find` and `findOne` permissions for all your software-related content types (projects, skills, etc.).

### Frontend Setup (Next.js)

These instructions should be run from the root directory of this codebase.

1.  Install NPM packages.
    ```sh
    npm install
    ```
2.  Create an environment file. Copy `.env.example` to a new file named `.env.local` and fill in your variables. At a minimum, you need:
    ```env
    NEXT_PUBLIC_STRAPI_API_URL=http://localhost:1337
    NEXT_PUBLIC_SOFTWARE_DOMAIN=localhost:3000
    ```
3.  Start the Next.js development server (runs on `http://localhost:3000`).
    ```sh
    npm run dev
    ```

<p align="right">(<a href="#readme-top">back to top</a>)</p>

## License

Distributed under the MIT License. See the `LICENSE` file for more information.

<p align="right">(<a href="#readme-top">back to top</a>)</p>

## Contact

Project Link: [https://github.com/dettinjo/portfolio_frontend](https://github.com/dettinjo/portfolio_frontend)

<p align="right">(<a href="#readme-top">back to top</a>)</p>

## Acknowledgments

This project was made possible by these incredible tools and libraries.

* [shadcn/ui](https://ui.shadcn.com/)
* [next-intl](https://next-intl.dev/)
* [Framer Motion](https://www.framer.com/motion/)
* [Lucide React](https://lucide.dev/)
* [Devicon](https://devicon.dev/)
* [Best-README-Template](https://github.com/othneildrew/Best-README-Template)

<p align="right">(<a href="#readme-top">back to top</a>)</p>

[issues-shield]: https://img.shields.io/github/issues/dettinjo/portfolio_frontend.svg?style=for-the-badge
[issues-url]: https://github.com/dettinjo/portfolio_frontend/issues
[license-shield]: https://img.shields.io/github/license/dettinjo/portfolio_frontend.svg?style=for-the-badge
[license-url]: https://github.com/dettinjo/portfolio_frontend/blob/main/LICENSE
[Next.js]: https://img.shields.io/badge/next.js-000000?style=for-the-badge&logo=nextdotjs&logoColor=white
[Next-url]: https://nextjs.org/
[React.js]: https://img.shields.io/badge/React-20232A?style=for-the-badge&logo=react&logoColor=61DAFB
[React-url]: https://reactjs.org/
[TypeScript]: https://img.shields.io/badge/TypeScript-3178C6?style=for-the-badge&logo=typescript&logoColor=white
[TypeScript-url]: https://www.typescriptlang.org/
[TailwindCSS]: https://img.shields.io/badge/Tailwind_CSS-38B2AC?style=for-the-badge&logo=tailwind-css&logoColor=white
[Tailwind-url]: https://tailwindcss.com/
[Strapi.io]: https://img.shields.io/badge/Strapi-2E7EEA?style=for-the-badge&logo=strapi&logoColor=white
[Strapi-url]: https://strapi.io/
[Vercel]: https://img.shields.io/badge/Vercel-000000?style=for-the-badge&logo=vercel&logoColor=white
[Vercel-url]: https://vercel.com/
</file>

<file path="src/components/layout/SoftwareHeader.tsx">
"use client";

import { useState } from "react";
import { useTranslations } from "next-intl";
import { ThemeToggle } from "./ThemeToggle";
import { LanguageToggle } from "./LanguageToggle";
import { Link } from "@/i18n/navigation";
import { MobileNav } from "./MobileHeader";
import { Terminal } from "lucide-react";
import { motion, useScroll, useMotionValueEvent } from "framer-motion";

interface SoftwareHeaderProps {
  showNavLinks?: boolean;
}

export function SoftwareHeader({ showNavLinks = false }: SoftwareHeaderProps) {
  const t = useTranslations("software.SoftwareHeader");

  const { scrollY } = useScroll();
  const [hidden, setHidden] = useState(false);

  useMotionValueEvent(scrollY, "change", (latest) => {
    const previous = scrollY.getPrevious() ?? 0;
    if (latest > previous && latest > 150) {
      setHidden(true);
    } else {
      setHidden(false);
    }
  });

  const navLinks = [
    { href: "#projekte", label: t("projects") },
    { href: "#skills", label: t("skills") },
    { href: "#resume-cta", label: t("resume") },
    { href: "#kontakt", label: t("contact") },
  ];

  return (
    <motion.header
      variants={{
        visible: { y: 0 },
        hidden: { y: "-100%" },
      }}
      animate={hidden ? "hidden" : "visible"}
      transition={{ duration: 0.35, ease: "easeInOut" }}
      className="sticky top-0 z-50 w-full bg-background"
    >
      <nav className="container mx-auto flex h-14 items-center justify-between relative">
        <Link
          href="/"
          className="flex items-center gap-3 font-bold text-lg transition-opacity hover:opacity-80"
        >
          <Terminal className="h-6 w-6" />
        </Link>
        {showNavLinks && (
          <div className="hidden md:flex absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 items-center gap-6 text-sm">
            {navLinks.map((link) => (
              <a
                key={link.href}
                href={link.href}
                className="text-muted-foreground transition-colors hover:text-foreground"
              >
                {link.label}
              </a>
            ))}
          </div>
        )}

        <div className="flex items-center gap-2">
          <div className="hidden md:flex md:items-center md:gap-2">
            <LanguageToggle />
            <ThemeToggle />
          </div>
          <MobileNav navLinks={showNavLinks ? navLinks : undefined}>
            <LanguageToggle />
            <ThemeToggle />
          </MobileNav>
        </div>
      </nav>
    </motion.header>
  );
}
</file>

<file path="src/components/layout/Footer.tsx">
// src/components/layout/Footer.tsx
"use client";

import React from "react";
import { useTranslations } from "next-intl";
import { Heart } from "lucide-react";
// --- THIS IS THE FIX (PART 1) ---
// Import the Link component
import { Link } from "@/i18n/navigation";

export function Footer() {
  const t = useTranslations("Footer");

  return (
    <footer className="border-t">
      <div className="container mx-auto flex flex-col items-center justify-between gap-4 py-6 sm:flex-row">
        <div className="flex items-center gap-2 text-sm text-muted-foreground">
          <span>{t("made_with")}</span>
          <Heart className="h-5 w-5 fill-foreground text-foreground" />
          <span>{t("by_me")}</span>
        </div>

        <div className="flex items-center gap-4 text-sm text-muted-foreground">
          {/* --- THIS IS THE FIX (PART 2) --- */}
          {/* Changed <a> to <Link> */}
          <Link
            href="/imprint"
            className="transition-colors hover:text-foreground"
          >
            {t("imprint")}
          </Link>
          {/* --- THIS IS THE FIX (PART 3) --- */}
          {/* Changed <a> to <Link> */}
          <Link
            href="/privacy_policy"
            className="transition-colors hover:text-foreground"
          >
            {t("privacy")}
          </Link>
        </div>
      </div>
    </footer>
  );
}
</file>

<file path="src/app/[locale]/page.tsx">
import { getTranslations } from "next-intl/server";
import { Metadata } from "next";
import { CollectionPage, WithContext } from "schema-dts";
import { SoftwareHeader } from "@/components/layout/SoftwareHeader";
import { Footer } from "@/components/layout/Footer";
import { ContactSection } from "@/components/sections/ContactSection";
import { HeroSection } from "@/components/sections/HeroSection";
import { ProjectsSection } from "@/components/sections/ProjectsSection";
import { SkillsSection } from "@/components/sections/SkillsSection";
import { ResumeCTASection } from "@/components/sections/ResumeCTASection";
import { ScrollIndicator } from "@/components/ScrollIndicator";
import { BackToTopButton } from "@/components/ui/BackToTopButton";
import { fetchSoftwareProjects, fetchSkillCategories } from "@/lib/payload";

type Props = {
  params: Promise<{ locale: string }>;
};

export async function generateMetadata({ params }: Props): Promise<Metadata> {
  const { locale } = await params;
  const t = await getTranslations({
    locale: locale,
    namespace: "software.SoftwarePageSEO",
  });

  const fullName = process.env.NEXT_PUBLIC_FULL_NAME || "Developer";
  const firstName = fullName.split(" ")[0];
  const siteTitle = t("siteName", { name: firstName });

  const softwareDomain = process.env.NEXT_PUBLIC_SOFTWARE_DOMAIN || "";
  const rootDomain = process.env.NEXT_PUBLIC_ROOT_DOMAIN || "";

  return {
    title: siteTitle,
    description: t("description"),
    openGraph: {
      title: siteTitle,
      description: t("description"),
      url: `https://${softwareDomain}`,
      siteName: siteTitle,
      images: [
        {
          url: `https://${rootDomain}/og-software.png`,
          width: 1200,
          height: 630,
          alt: `An overview of software projects by ${fullName}`,
        },
      ],
      type: "website",
      locale: locale,
    },
    alternates: {
      canonical: `https://${softwareDomain}`,
      languages: {
        en: `https://${softwareDomain}`,
        de: `https://de.${softwareDomain}`,
        "x-default": `https://${softwareDomain}`,
      },
    },
  };
}

export default async function DevPage({ params }: Props) {
  const { locale } = await params;

  const [projectsData, skillsDataForDisplay] = await Promise.all([
    fetchSoftwareProjects(locale),
    fetchSkillCategories(locale),
  ]);

  const t = await getTranslations({
    locale: locale,
    namespace: "software.SoftwareProjectsSection",
  });

  const skillsForDisplay = skillsDataForDisplay
    .filter((cat) => cat && Array.isArray(cat.skills))
    .map((cat) => ({
      category: cat.name,
      skills: [...cat.skills].sort((a, b) => b.level - a.level),
    }));

  const cleanProjectsData = projectsData.filter(Boolean);

  const softwareDomain = process.env.NEXT_PUBLIC_SOFTWARE_DOMAIN || "";

  const jsonLd: WithContext<CollectionPage> = {
    "@context": "https://schema.org",
    "@type": "CollectionPage",
    name: t("title"),
    description: t("subtitle"),
    url: `https://${softwareDomain}`,
    mainEntity: {
      "@type": "ItemList",
      itemListElement: cleanProjectsData.map((project, index) => ({
        "@type": "ListItem",
        position: index + 1,
        name: project.title,
        url: `https://${softwareDomain}/${project.slug}`,
      })),
    },
  };

  return (
    <div className="relative flex min-h-dvh flex-col bg-background">
      <SoftwareHeader showNavLinks={true} />
      <main className="flex-1">
        <script
          type="application/ld+json"
          dangerouslySetInnerHTML={{ __html: JSON.stringify(jsonLd) }}
        />
        <HeroSection />
        <div className="max-w-6xl mx-auto px-6">
          <div className="py-24">
            <ProjectsSection projects={cleanProjectsData} />
          </div>
          <ScrollIndicator href="#skills" />
          <div className="py-24">
            <SkillsSection skills={skillsForDisplay} />
          </div>
          <div className="py-12">
            <ScrollIndicator href="#resume-cta" />
          </div>
          <ResumeCTASection />
          <ScrollIndicator href="#kontakt" />
          <div className="pt-24 pb-64 md:pb-96">
            <ContactSection />
          </div>
        </div>
      </main>
      <Footer />
      <BackToTopButton />
    </div>
  );
}
</file>

<file path="src/components/layout/LanguageToggle.tsx">
// src/components/layout/LanguageToggle.tsx
"use client";

import { useLocale } from "next-intl";
import { Button } from "@/components/ui/button";
import React from "react";
// --- FIX: Import the correct hooks ---
import { usePathname, useRouter } from "@/i18n/navigation";
import { useTransition } from "react";

export function LanguageToggle() {
  const currentLocale = useLocale();
  const router = useRouter();
  const pathname = usePathname();
  const [isPending, startTransition] = useTransition();

  const nextLocale = currentLocale === "de" ? "en" : "de";

  const handleLanguageSwitch = () => {
    startTransition(() => {
      // This will seamlessly switch the locale in the path
      router.replace(pathname, { locale: nextLocale });
    });
  };

  return (
    <Button
      variant="ghost"
      size="icon"
      onClick={handleLanguageSwitch}
      disabled={isPending}
      aria-label={`Switch language to ${nextLocale.toUpperCase()}`}
    >
      <span className="text-sm font-semibold">
        {currentLocale.toUpperCase()}
      </span>
    </Button>
  );
}
</file>

<file path="src/lib/strapi.ts">
// portfolio-frontend/src/lib/strapi.ts
import qs from "qs";
import { cache } from "react";

// --- Interfaces remain the same ---
interface StrapiImage {
  id: number;
  url: string;
  alternativeText: string | null;
  width: number;
  height: number;
  size: number | null;
}
interface StrapiResponseWrapper<T> {
  data: T;
}
export interface Skill {
  id: number;
  name: string;
  iconClassName: string;
  level: number;
  url: string;
  svgIcon?: {
    url: string;
    alternativeText?: string;
  };
}
export interface SkillCategory {
  id: number;
  name: string;
  order: number;
  skills: Skill[];
}
export interface SoftwareProject {
  id: number;
  slug: string;
  title: string;
  description: string;
  longDescription?: string;
  projectType: string;
  developedAt?: string;
  liveUrl?: string;
  repoUrl?: string;
  tags: string[];
  coverImage: StrapiImage | null;
  gallery: StrapiImage[] | null;
  localizations?: Array<{
    id: number;
    slug: string;
    locale: string;
  }>;
}

const STRAPI_URL =
  process.env.NEXT_PUBLIC_STRAPI_API_URL || "http://localhost:1337";

export function getStrapiMedia(url: string | undefined | null): string | null {
  if (!url) {
    return null;
  }
  if (url.startsWith("http")) {
    return url;
  }
  return `${STRAPI_URL}${url}`;
}

async function fetchAPI<T>(
  path: string,
  urlParamsObject = {},
  options = {},
  locale?: string
): Promise<T> {
  try {
    const mergedOptions = {
      headers: { "Content-Type": "application/json" },
      ...options,
    };

    const paramsWithLocale = { ...urlParamsObject, locale };

    const queryString = qs.stringify(paramsWithLocale, {
      encodeValuesOnly: true,
    });
    const requestUrl = `${STRAPI_URL}/api${path}${
      queryString ? `?${queryString}` : ""
    }`;

    const response = await fetch(requestUrl, mergedOptions);
    if (!response.ok) {
      console.error(
        `Error fetching ${requestUrl}: ${response.status} ${response.statusText}`
      );
      throw new Error(`An error occurred please try again`);
    }
    const jsonData = await response.json();
    return (jsonData as StrapiResponseWrapper<T>).data || jsonData;
  } catch (error) {
    console.error(error);
    throw new Error(`An error occurred please try again`);
  }
}

export const getTechDetailsMap = cache(async () => {
  const allSkills = await fetchAPI<Skill[]>("/skills", {
    fields: ["name", "iconClassName", "url"],
    pagination: { pageSize: 250 },
  });
  const techDetailsMap: {
    [key: string]: { iconClassName: string | null; url: string | null };
  } = {};

  if (Array.isArray(allSkills)) {
    for (const skill of allSkills) {
      if (skill.name) {
        techDetailsMap[skill.name.toLowerCase()] = {
          iconClassName: skill.iconClassName || null,
          url: skill.url || null,
        };
      }
    }
  }
  return techDetailsMap;
});

export async function fetchSkillCategories(
  locale?: string
): Promise<SkillCategory[]> {
  return fetchAPI<SkillCategory[]>(
    "/skill-categories",
    {
      populate: {
        skills: {
          populate: {
            svgIcon: {
              fields: ["url", "alternativeText"],
            },
          },
        },
      },
      sort: "order:asc",
    },
    {},
    locale
  );
}

export async function fetchSoftwareProjects(
  locale?: string
): Promise<SoftwareProject[]> {
  return fetchAPI<SoftwareProject[]>(
    "/software-projects",
    {
      populate: {
        coverImage: {
          fields: ["url", "alternativeText", "width", "height", "size"],
        },
        gallery: true,
      },
      sort: "developedAt:desc",
    },
    {},
    locale
  );
}

export async function fetchSoftwareProjectBySlug(
  slug: string,
  locale?: string
): Promise<SoftwareProject | null> {
  const projects = await fetchAPI<SoftwareProject[]>(
    "/software-projects",
    {
      filters: { slug: { $eq: slug } },
      fields: ["*"],
      populate: {
        coverImage: {
          fields: ["url", "alternativeText", "width", "height", "size"],
        },
        gallery: {
          fields: ["url", "alternativeText", "width", "height", "size"],
        },
        localizations: true,
      },
    },
    {},
    locale
  );
  return projects?.[0] || null;
}

export async function fetchAllProjectSlugs(
  locale?: string
): Promise<{ slug: string }[]> {
  const projects = await fetchAPI<{ slug: string }[]>(
    "/software-projects",
    { fields: ["slug"] },
    {},
    locale
  );
  return projects.map((p) => ({ slug: p.slug }));
}

export async function fetchSkills(locale?: string): Promise<SkillCategory[]> {
  return fetchAPI<SkillCategory[]>(
    "/skill-categories",
    {
      populate: { skills: true },
      sort: "order:asc",
    },
    {},
    locale
  );
}
</file>

<file path="package.json">
{

  "name": "my-portfolio",

  "version": "0.1.0",

  "private": true,

  "scripts": {

    "dev": "next dev",

    "build": "next build",

    "start": "next start",

    "payload:importmap": "node --no-experimental-fetch ./node_modules/.bin/payload generate:importmap",

    "lint": "eslint"

  },
  "overrides": {
    "undici": "7.16.0"
  },

  "dependencies": {

    "@payloadcms/db-sqlite": "^3.64.0",

    "@payloadcms/next": "^3.64.0",

    "@payloadcms/richtext-lexical": "^3.64.0",

    "@payloadcms/ui": "^3.64.0",

    "@radix-ui/react-aspect-ratio": "^1.1.7",

    "@radix-ui/react-avatar": "^1.1.10",

    "@radix-ui/react-checkbox": "^1.3.3",

    "@radix-ui/react-collapsible": "^1.1.12",

    "@radix-ui/react-dialog": "^1.1.15",

    "@radix-ui/react-dropdown-menu": "^2.1.16",

    "@radix-ui/react-label": "^2.1.7",

    "@radix-ui/react-navigation-menu": "^1.2.14",

    "@radix-ui/react-popover": "^1.1.15",

    "@radix-ui/react-radio-group": "^1.3.8",

    "@radix-ui/react-separator": "^1.1.7",

    "@radix-ui/react-slider": "^1.3.6",

    "@radix-ui/react-slot": "^1.2.3",

    "@radix-ui/react-switch": "^1.2.6",

    "@radix-ui/react-tabs": "^1.1.13",

    "@radix-ui/react-visually-hidden": "^1.2.3",

    "@types/bcrypt": "^6.0.0",

    "@types/jsonwebtoken": "^9.0.10",

    "@vercel/analytics": "^1.5.0",

    "@vercel/speed-insights": "^1.2.0",

    "bcrypt": "^6.0.0",

    "class-variance-authority": "^0.7.1",

    "clsx": "^2.1.1",

    "devicon": "^2.17.0",

    "framer-motion": "^12.23.12",

    "graphql": "^16.12.0",

    "jsonwebtoken": "^9.0.2",

    "lucide-react": "^0.542.0",

    "next": "^15.5.2",

    "next-intl": "^4.3.6",

    "next-themes": "^0.4.6",

    "otplib": "^12.0.1",

    "payload": "^3.64.0",

    "qrcode": "^1.5.4",

    "qs": "^6.14.0",

    "react": "^19.1.1",

    "react-dom": "^19.1.1",

    "react-markdown": "^10.1.0",

    "sharp": "^0.34.5",

    "tailwind-merge": "^3.3.1",

    "tailwindcss-animate": "^1.0.7"

  },

  "devDependencies": {

    "@eslint/eslintrc": "^3",

    "@tailwindcss/line-clamp": "^0.4.4",

    "@tailwindcss/postcss": "^4",

    "@tailwindcss/typography": "^0.5.19",

    "@types/express": "^5.0.5",

    "@types/node": "^20",

    "@types/qrcode": "^1.5.6",

    "@types/qs": "^6.14.0",

    "@types/react": "^19",

    "@types/react-dom": "^19",

    "autoprefixer": "^10.4.21",

    "eslint": "^9",

    "eslint-config-next": "^15.5.2",

    "husky": "^9.1.7",

    "postcss": "^8.5.6",

    "schema-dts": "^1.1.5",

    "tailwindcss": "^3.4.17",

    "tw-animate-css": "^1.3.8",

    "typescript": "^5"

  }

}
</file>

</files>
